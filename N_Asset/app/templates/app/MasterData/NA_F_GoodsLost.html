{% extends 'app/layout.html' %}

{% block SearchData %}
<li><a href="#" data-tipe="varchar" data-column="goodsname">Goods name</a></li>
<li><a href="#" data-tipe="varchar" data-column="itemcode">Item code</a></li>
<li><a href="#" data-tipe="varchar" data-column="brandname">Brand name</a></li>
<li><a href="#" data-tipe="varchar" data-column="typeapp">Type of goods</a></li>
<li><a href="#" data-tipe="varchar" data-column="serialnumber">Serial number</a></li>
<li><a href="#" data-tipe="varchar" data-column="used_by">Used by</a></li>
<li><a href="#" data-tipe="varchar" data-column="lost_by">Lost by</a></li>
<li><a href="#" data-tipe="varchar" data-column="resp_person">Responsible person</a></li>
<!--<li class="divider"></li>-->
<li><a id="custSearch" href="#">Custom Search</a></li>
<!--<li class="divider"></li>-->
{% endblock %}

{% block javascriptAndUI %}
{% load static %}

<script type="text/javascript" src="../../../static/app/scripts/NAJS.js"></script>
<script type="text/javascript">

    (function () {
        var txtSearchMaster = NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
            btnSearchMaster = NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default');
        window.onunload = function () {
            if (typeof txtSearchMaster.onclick == "function") {
                NA.NAEvent.removeHandler(txtSearchMaster, 'keydown', handlerSearchInput)
            }
            if (typeof btnSearchMaster.onclick == "function") {
                NA.NAEvent.removeHandler(btnSearchMaster, 'click', handlerSearchInput);
            }
        };
        //=================add Dynamic Styles=============================
        NA.common.loadStyles("../../../static/app/content/jquery-ui.min.css", "jqueryUI");
        NA.common.loadStyles("../../../static/app/content/ui.jqgrid.css", "UIJqueryGrid");
        var doc = doc || window.document;
        var DivSearch = doc.querySelector('ul.dropdown-menu.search');//return list Element
        (function (elm) {
            var listElem = elm.children;
            Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array
                if (item.firstChild.nodeValue != 'CustomSearch') {
                    NA.NAEvent.addHandler(item, 'click', function (event) {
                        event.preventDefault();
                        if (item.firstChild.id === 'custSearch') {
                            //=========='show dialog search'==================
                            NA.common.dialog.createSearchDialog(event)
                        }
                        NA.common.getElementID('bySearch').firstChild.nodeValue = item.textContent;
                    });
                }
            });
        })(DivSearch);
    })();   
</script>
<script src="{% static 'app/scripts/jquery-1.11.0.min.js' %}" id="jq_uery"></script>
<script type="text/javascript" src="{% static 'app/scripts/grid.locale-en.js' %}"></script>
<script src="{% static 'app/scripts/jquery.jqGrid.min.js' %}"></script>
<script src="{% static 'app/scripts/jquery-ui.js' %}"></script>
<script
    type="text/javascript">if (typeof $.fn.modal == 'undefined') { NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/bootstrap\.js\"\>\<\/script\>'); }</script>
<script src="../../../static/app/scripts/bootstrap-dialog.js"></script>
<style>
    div#content-0 {
        overflow: hidden;
    }

    div#gbox_NA_Employee_grid,
    div#gview_NA_Employee_grid,
    div#NA_GoodsLost_pager,
    div.ui-jqgrid-titlebar {
        border-radius: 0px
    }
</style>
{% endblock %}

{% block content-0 %}
<table id="NA_GoodsLost_grid" style="overflow:auto"></table>
<div id="NA_GoodsLost_pager" class="scroll" style="text-align:center;"></div>
{% endblock %}

{% block DialogEntry %}
<script type="text/javascript">
    function get_csrf() {
        csrf_token = '{{csrf_token}}'
        return csrf_token
    }
</script>
<script type="text/javascript">
    (function () {
    var win = win || window;
    var status = win.status || window.status;
    var gLost_grid = $("#NA_GoodsLost_grid");
    var txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
        btnSearchMaster = btnSearchMaster || NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default'),
        qs = NA.common.qs, originalData = null;
        qsAll = NA.common.qsAll;
        var NA_Ajax = NA.common.AJAX;
        function LoadData(page) {
            var url = 'getData/?' + win.encodeURIComponent('columnName') + '=' + win.encodeURIComponent(NA.common.SearchData.getColumnKey()) +
                '&' + win.encodeURIComponent('valueKey') + '=' + win.encodeURIComponent(NA.common.SearchData.getValueKey()) +
                '&' + win.encodeURIComponent('dataType') + '=' + win.encodeURIComponent(NA.common.SearchData.getDataType()) +
                '&' + win.encodeURIComponent('criteria') + '=' + win.encodeURIComponent(NA.common.SearchData.getCriteria());
            if (arguments.length > 0) {
                gLost_grid.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
            } else {
                gLost_grid.jqGrid({
                    url: url,
                    datatype: 'json',
                    mtype: 'GET',
                    colNames: ['idapp', 'No', 'Goods', 'Item code', 'Serial Number', 'Last Goods Possition', 'Used by', 'Lost by', 'Responsible Person', 'by reason', 'Descriptions', 'Createddate', 'Createdby'],
                    colModel: [
                        { name: 'idapp', index: 'idapp', width: 65, search: false, editable: false, hidden: true, key: true, editoptions: { dataInit: function (element) { jq(element).attr("readonly", "readonly"); } } },
                        { name: 'no', index: 'no', width: 45, align: 'center' },
                        { name: 'goods', index: 'goodsname', width: 150, editable: true, search: false, sortable: true },
                        //{ name: 'brandname', index: 'brandname', width: 150, editable: true, sortable: true },
                        { name: 'itemcode', index: 'typeapp', width: 80, align: 'left', editable: false, search: false },
                        { name: 'serialnumber', index: 'serialnumber', width: 180, align: 'left', editable: false, search: false },
                        { name: 'fk_fromgoods', index: 'fromgoods', width: 120, align: 'left', editable: false, search: false },
                        { name: 'usedby', index: 'usedby', width: 120, editable: false },
                        { name: 'lostby', index: 'lostby', width: 120, editable: false },
                        { name: 'resp_person', index: 'resp_person', width: 120, editable: false },
                        { name: 'reason', index: 'reason', width: 200, editable: false },
                        { name: 'descriptions', index: 'descriptions', width: 200, editable: true, search: false },
                        {
                            name: 'createddate', index: 'createddate', width: 175, align: 'center', editable: false, search: false,
                            formatter: 'date', formatoptions: { srcformat: 'Y-m-dTH:i:s', newformat: 'd F Y H:i:s' }
                        },//,formatter: "date",formatoptions: { srcformat: "ISO8601Long", newformat: "Y/m/d H:i" }
                        { name: 'createdby', index: 'createdby', width: 115, search: false, editable: false, editoptions: { dataInit: function (element) { jq(element).attr("readonly", "readonly"); } } },
                    ],
                    jsonreader: {
                        repeatitems: false,
                        id: 'idapp',
                        root: 'rows'
                    },
                    pager: $('#NA_GoodsLost_pager'),
                    rowList: [20, 50, 100, 200, 300, 500],
                    rowNum: 5,
                    //loadui: 'disable', // Disable Loading Text
                    cellEdit: false,
                    sortname: 'idapp',
                    sortorder: "desc",
                    viewrecords: true,
                    iconSet: "fontAwesome",
                    hidegrid: true,
                    shrinkToFit: false,
                    caption: 'Nufarm -- Goods Lost',
                    shrinkToFit: false,
                    height: $('div.fltlft').height() - ($('div.fltlft').height() * 0.173),
                    width: 'inherit',
                    ondblClickRow: function (rowId) {
                        var btnOpen = NA.common.doc.querySelector('ul.nav.navbar-nav>li:nth-child(2)>button');
                        if (btnOpen) {
                            btnOpen.click();
                        }
                    }
                });
            }
        };
        var SearchData = NA.common.SearchData;
        SearchData.setDefaultSearchData('goodsname', 'Varchar', 'like');
        LoadData();

        function handlerSearchInput(event) {
            event = NA.NAEvent.getEvent(event);
            if (event.target == txtSearchMaster || event.target == btnSearchMaster || event.target.parentNode == btnSearchMaster ) {
                NA.NAEvent.preventDefault(event);
                var elSearch = NA.common.doc.querySelector('li.dropdown>a#bySearch'),
                    SearchBy = NA.common.doc.querySelector('li.dropdown>a#bySearch').textContent.trim(),
                    SearchInput = qs('input[name=q]');
                if (SearchBy.trim() == 'By') {
                    NA.common.SearchData.setDefaultSearchData('goodsname', 'Varchar', 'like');
                    var curPage = parseInt(gLost_grid.getGridParam('page'));
                    window.document.body.style.cursor = 'wait';
                    NA.common.SearchData.setValue(SearchInput.value);
                    LoadData(curPage);
                }
                else {
                    //submit search
                    submitSearch(event);
                }
                NA.NAEvent.stopPropagation(event);
            }
            window.document.body.style.cursor = '';
        }
        //=======================handler txt & button Search master keyboard event and click================================        
        NA.NAEvent.addHandler(txtSearchMaster, 'keydown', handlerSearchInput);
        NA.NAEvent.addHandler(btnSearchMaster, 'click', handlerSearchInput);

        gLost_grid.on("keyup", "tr", function (e) {
            var rowId = gLost_grid.jqGrid('getGridParam', 'selrow');
            if (e.keyCode == 46) {
                var btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)')
                btnDelete.click();
                //return false;
            }
        });
        gLost_grid.navGrid('#NA_GoodsLost_pager', {
            edit: true,
            add: true,
            del: true,
            search: true,
            refresh: true,
            view: true,
            cloneToTop: false
        });
        NA.common.doc.title = 'Nufarm - Entry Goods Lost';
        var elGrid_lost = qsAll("div#gbox_NA_GoodsLost_grid, div#gview_NA_GoodsLost_grid, div.ui-jqgrid-bdiv, div.ui-jqgrid-hdiv");
        Array.prototype.forEach.call(elGrid_lost, function (elm) {
            elm.style.width = 'inherit'
        });


        //================================ Search by ==============================//


        //================================= End Search by ======================================//
        function submitSearch(event) {
            window.document.body.style.cursor = 'wait';
            if (event)
                NA.NAEvent.preventDefault(event);

            var elementOption = null, columnKey = '', valueKey = '',
                elCriteria = null,//NA.common.doc.querySelector('td.columns select.selectopts.NA-Form-Control option:checked');
                valCriteria = '',//elCriteria.nodeValue;
                elDataType = '';//elementOption.dataset.dataType;
            if (event.target.getAttribute('id') === 'fbox_jqGrid_search' || event.target.getAttribute('id') === 'jqg1') {//fbox_jqGrid_search == button search,jqg1 = txtSearch nya
                elementOption = NA.common.doc.querySelector('td.columns select.NA-Form-Control option:checked');
                columnKey = elementOption.getAttribute('name'), valueKey = NA.common.getElementID('jqg1').value;
                elCriteria = NA.common.doc.querySelector('td.operators select.selectopts.NA-Form-Control option:checked');
                criteria = elCriteria.value;
                switch (criteria) {
                    case "eq": { valCriteria = 'equal'; break; }
                    case "ne": { valCriteria = 'notequal'; break; }
                    case "bw": { valCriteria = 'beginwith'; break; }
                    case "ew": { valCriteria = "endwith"; break; }
                    case "cn": { valCriteria = "like"; break; }
                    case "in": { valCriteria = "in"; break; }
                    case "ni": { valCriteria = "notin"; break; }
                    case "gt": { valCriteria = "greater"; break; }
                    case "le": { valCriteria = "less"; break; }
                    case "leq": { valCriteria = "lessorequal"; break; }
                    case "gtq": { valCriteria = "greaterorequal"; break; }
                    case "bw": { valCriteria = "between"; break; }
                };
                elDataType = elementOption.dataset.tipe;
            }
            else if (event.target == txtSearchMaster || event.target == btnSearchMaster || event.target.parentNode == btnSearchMaster ) {
                //var txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
                var elSearch = null;
                valueKey = txtSearchMaster.value.trim();
                var listElem = NA.common.doc.querySelector('ul.dropdown-menu.search').children;//return list Element
                var textToSearch = NA.common.getElementID('bySearch').firstChild.nodeValue;
                Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array                   
                    if (item.firstChild.textContent === textToSearch) {
                        elSearch = item.firstChild;
                    }
                });
                columnKey = elSearch.dataset.column
                elDataType = elSearch.dataset.tipe;
                valCriteria = 'like'
                if (!elSearch.dataset.column) {
                    switch (elDataType) {
                        case "bigint":
                        case "integer":
                        case "money":
                        case "float":
                        case "decimal":
                        case "boolean":
                        case "datetime": {
                            if (valueKey.toString().indexOf(',') > -1) {
                                criteria = 'in'
                            }
                            criteria = 'equal';
                            break;
                        }
                    };
                }
            }

            NA.common.SearchData.setValue(valueKey);
            NA.common.SearchData.setColumnName(columnKey);
            NA.common.SearchData.setDataType(elDataType)
            NA.common.SearchData.setCriteria(valCriteria);
            window.document.body.style.cursor = 'wait';
            LoadData(1);
            document.body.style.cursor = 'default';
            gLost_grid.jqGrid('setGridParam').trigger("reloadGrid", [{ page: 1 }]);//karena searching harus di set ke page 1
        };

        //function untuk Reset
        function submitReset(event) {
            //reload jqueryGrid
            //check apakah target dari btn reset
            if (event) {
                var target = NA.NAEvent.getTarget(event);
            }
            NA.common.SearchData.setDefaultSearchData('goodsname', 'varchar', 'like');
            NA.common.SearchData.setValue('');
            LoadData(1);
            window.document.body.style.cursor = 'default';
        };
        //========================Function Untuk memanggil Custom Search========================
        window.showDialogCustomSearch = function (event) {
            $('div.containerDialog').load("customFilter/", function (responseTxt, statusTxt, xhr) {
                if (statusTxt == "success") {
                    $(this).html(responseTxt);
                    var dialog = NA.common.doc.querySelector('div.containerDialog');
                    NA.common.getElementID('searchmodfbox').style.display = 'block';
                    var btnClose = NA.common.doc.querySelector('div#searchhdfbo a.ui-jqdialog-titlebar-close.ui-corner-all'),
                        txtSearchCustom = NA.common.getElementID('jqg1');
                    NA.NAEvent.addHandler(btnClose, 'click', function (event) {
                        NA.common.dialog.closeDialog(dialog);
                    });
                    var btnFind = NA.common.getElementID('fbox_jqGrid_search');
                    NA.NAEvent.addHandler(btnFind, 'click', function (event) {
                        submitSearch(event);
                        if (event) {
                            NA.NAEvent.stopPropagation(event);
                        }
                    });
                    var btnReset = NA.common.getElementID('fbox_jqGrid_reset');
                    NA.NAEvent.addHandler(btnReset, 'click', function (event) {
                        submitReset(event);
                        if (event) {
                            NA.NAEvent.stopPropagation(event);
                        }
                    });
                    NA.NAEvent.addHandler(txtSearchCustom, 'keydown', function (event) {
                        event = NA.NAEvent.getEvent(event);
                        if (event.keyCode === 13) {
                            submitSearch(event);
                        }
                        if (event) {
                            NA.NAEvent.stopPropagation(event);
                        }
                    });
                }
            });
        };

        var containerMenu = qs('ul.nav.navbar-nav');
        NA.common.loadStyles("../../../static/app/content/Dialog.css", "DialogEntryStyle");
        NA.common.loadStyles("../../../static/app/content/NA_commonEntry.css", "CommonEntry");

        NA.common.dialog.initDialog(containerMenu, 'Nufarm Entry Goods - Lost');

        var elementMenus = [];
        var menus = NA.common.doc.querySelectorAll('div.sidebar ul.list-sidebar.bg-defoult li ul li a');
        Array.prototype.forEach.call(menus, function (item) {
            if (item.textContent.indexOf("Email Data") > -1) {
                elementMenus.push(item);
            }
        });
        NA.common.dialog.initDialog(null, 'Nufarm Send Email - Master Data', elementMenus);

        function getGridId() {
            return $(gLost_grid).jqGrid('getGridParam', 'selrow')
        }

        function getGridValue(grid, jqgId, column) {
            var col = grid.jqGrid('getCell', jqgId, column);
            return col
        }
        function getValues_Form() {
            var data = {
                fk_goods: qs('input#id_fk_goods').value.trim(),
                //fk_responsible default fk_employee
                //fk_usedby
                itemcode: qs('input#id_itemcode').value.trim(),
                goods: qs('input#id_goods').value.trim(),
                typeApp: qs('input#id_typeApp').value.trim(),
                serialNumber: qs('input#id_serialNumber').value.trim(),
                fk_usedby: qs('input#id_fk_usedby').value || 0,
                fk_responsibleperson: qs('input#id_fk_responsibleperson').value || 0,
                fk_lostby: qs('input#id_fk_lostby').value || 0,
                fk_goods_outwards: qs('input#id_fk_goods_outwards').value || 0,
                fk_goods_lending: qs('input#id_fk_goods_lending').value || 0,
                fk_goods_return: qs('input#id_fk_goods_return').value || 0,
                fk_maintenance: qs('input#id_fk_maintenance').value || 0,
                fk_fromgoods: qs('input#id_fk_fromgoods').value,
                nik_used: qs('input#id_nik_used').value,
                nik_resp: qs('input#id_nik_resp').value,
                nik_lostby: qs('input#id_nik_lostby').value,
                datelost: (function () {
                    var FDate = $('input#id_datelost').val();
                    FDate = $.datepicker.parseDate('dd/mm/yy', FDate);
                    return NA.common.GetServerFormatDate(FDate);
                })(),
                status_goods: qs('select#id_status_goods').value,
                reason: qs('textarea#id_reason').value.trim(),
                descriptions: qs('textarea#id_descriptions').value.trim()
            };
            return data
        }
        var btnDelete = qs('ul.nav.navbar-nav li:nth-child(5)');
        NA.NAEvent.addHandler(btnDelete, 'click', function (event) {
            var get_idapp = getGridId();
            if (getGridId()) {
                NA.NAEvent.preventDefault(event);
                var rowNum = gLost_grid.getGridParam('rowNum'),
                    allRecords = gLost_grid.getGridParam('records'),
                    totalPages = parseInt((allRecords / rowNum) + 1),
                    curPage = gLost_grid.getGridParam('page'),
                    rowId = gLost_grid.jqGrid('getGridParam', 'selrow'),
                    curRecount = gLost_grid.jqGrid('getGridParam', 'reccount');
                return dialogConfirm(NA.common.message.confirmDelete, NA.common.message.confirmInfo,
                    function () {
                        try {
                            //delete data di server                  
                            //$(selector).post(URL,data,function(data,status,xhr),dataType)-->return data type
                            $.ajax({
                                url: 'delete/',
                                method: 'POST',
                                data: {
                                    'csrfmiddlewaretoken': get_csrf(),
                                    'idapp': get_idapp,
                                },
                                success: function (data) {

                                    mustReload = true;
                                    if (parseInt(curRecount) === 1) {
                                        if (totalPages > 1) {
                                            curPage--;
                                        }
                                        else {
                                            mustReload = false;
                                            gLost_grid.delRowData(rowId);
                                        }
                                    }
                                    else if (parseInt(totalPages) === 1) {
                                        mustReload = false;
                                        gLost_grid.delRowData(rowId);
                                    }
                                    else if (parseInt(curRecount) > 1) {
                                        mustReload = false;
                                        gLost_grid.delRowData(rowId);
                                    }
                                    if (mustReload) {
                                        gLost_grid.trigger("reloadGrid", [{ page: curPage }]);
                                    };
                                }
                            })
                        } catch (e) {
                            console.log(e);
                            window.document.body.style.cursor = 'default';

                        }
                    },
                    function () {
                        return false;
                    });
            }
            else {
                document.body.style.cursor = 'default';
                return dialogAlert('Please select data you want to delete', NA.common.message.titleInfo, function () {
                    return false;
                });
            }
        });
        status = status || window.status
        function gLostSubmit() {
            var dialog = qs("div.containerDialog");
            function sendData() {
                var valuesForm = getValues_Form()
                var idapp;
                if (win.status.trim() == 'Edit') {
                    idapp = getGridId();
                } else {
                    idapp = 'none';
                }
                var snData = NA.common.AssignObject({
                    'csrfmiddlewaretoken': get_csrf(),
                    'statusForm': win.status,
                }, valuesForm, { 'idapp': idapp });
                return snData
            }
            $.ajax({
                url: 'ShowEntry/',
                method: 'POST',
                beforeSend: function (jqXHR) {
                    jqXHR.setRequestHeader('X-CSRF-Token', get_csrf())
                },
                data: sendData(),
                success: function (data) {
                    var dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
                    NA.common.dialog.closeDialog(dialog);
                    gLost_grid.trigger('reloadGrid', [{ page: 1 }]);
                    gLost_grid.focus();
                    if (status.trim() == 'Add' || status.trim() == 'Edit') {
                        setTimeout(function () {
                            gLost_grid.setSelection(data['message'], true)
                        }, 1000);
                    }
                }
            });
        };
        function ExecuteHandler(TextElement) {
            var dialog = qs("div.containerDialog");
            var frmEntry = qs('form#gLost_form');
            var emailForm = qs('form#email_data');
            if (frmEntry) {
                switch (TextElement) {
                    case 'OK': {
                        if (!frmEntry.checkValidity()) {
                            //NA.NAEvent.preventDefault(event);                                          
                            var inputbtn = NA.common.getElementID('gLost_submit');
                            inputbtn.click();
                        }
                        else {
                            gLostSubmit();
                        }
                        break;
                    }
                    case 'Cancel':
                    case 'Close': {
                        //check if data has changed with javascrispt
                        initializeForm = NA.common.getElementID('id_initializeForm');
                        if (status === 'Open' || initializeForm.value == '') { NA.common.dialog.closeDialog(dialog); return false; }
                        var valuesForm = getValues_Form();
                        if (NA.common.detectInputChanges(JSON.parse(originalData), valuesForm)) {
                            return dialogConfirm(NA.common.message.dataHasChanged, NA.common.message.confirmInfo,
                                function () {
                                    if (!frmEntry.checkValidity()) {
                                        //NA.NAEvent.preventDefault(event);   
                                        var inputbtn = NA.common.getElementID('gLost_submit');
                                        inputbtn.click();
                                    } else {
                                        gLostSubmit();
                                    }
                                },
                                function () {
                                    NA.common.dialog.closeDialog(dialog);
                                }
                            );

                        } else {
                            NA.common.dialog.closeDialog(dialog);
                        }
                    }
                };
            } else if (emailForm) {
                var emailForm = qs('form#email_data');
                switch (TextElement) {
                    case 'Cancel':
                    case 'Close': {
                        //var initializeEmail = NA.common.getElementID('initializeEmail');
                        var valuesForm = getValues_emailForm();
                        if (NA.common.detectInputChanges(JSON.parse(originalData), valuesForm)) {
                            if (confirm('Data has changed, \nAre you sure to Send mail ?')) {
                                if (!emailForm.checkValidity()) {
                                    //NA.NAEvent.preventDefault(event);   
                                    var inputbtn = NA.common.getElementID('emailData_submit');
                                    inputbtn.click();
                                } else {
                                    qs('div.dialogButtonOKCancel>a.button:nth-child(1)').click()
                                }
                            } else {
                                NA.common.dialog.closeDialog(dialog);
                            }
                        } else {
                            NA.common.dialog.closeDialog(dialog);
                        }
                    }

                }
            }
        };
        function formatDate(theDate) {//date/month/year
            var date = new Date(theDate),
                year = date.getFullYear(),
                month = (date.getMonth() + 1).toString(),
                formatedMonth = (month.length === 1) ? ("0" + month) : month,
                day = date.getDate().toString(),
                formatedDay = (day.length === 1) ? ("0" + day) : day;
            return formatedDay + "/" + formatedMonth + "/" + year //+ " " + formatedHour + ':' + formatedMinute + ':' + formatedSecond;
        };
        function restyleBoostrapDialog() {
            var BSDialogContent = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content');
            BSDialogContent.style.cssText = 'width: 520px; height: 430px;';
            var ContentBody = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-body');
            ContentBody.style.cssText = 'padding:0px;';
            var contentFooter = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-footer');
            contentFooter.style.cssText = 'padding-bottom:0px;padding-top:0px;';
            var mHeader = NA.common.doc.querySelector('div.bootstrap-dialog .modal-header.bootstrap-dialog-draggable');
            mHeader.style.cssText = 'height:30px;padding:0px;';
            var footerButton = NA.common.doc.querySelector('div.bootstrap-dialog-footer-buttons');
            footerButton.style.cssText = 'padding-top:8px;';
        };
        function getGridCellValue(thegrid, CeltoGet) {
            var reccount = thegrid.jqGrid('getGridParam', 'reccount');
            var rowId, rowData, colData;
            if (reccount > 0) {
                rowId = thegrid.jqGrid('getGridParam', 'selrow');
                if (rowId) {
                    rowData = thegrid.getRowData(rowId);
                    colData = rowData[CeltoGet];
                }
            }
            return colData;
        };
        function dialogConfirm(message, title, callTrue, callFalse) {
            return BootstrapDialog.confirm({
                title: title || NA.common.message.titleInfo,
                message: message,
                type: BootstrapDialog.TYPE_WARNING,
                size: BootstrapDialog.SIZE_SMALL,
                animate: false,
                cssClass: 'login-dialog',
                closeByBackdrop: false,
                closeByKeyboard: false,
                closable: false,
                draggable: true,
                btnCancelLabel: 'NO.',
                btnOKLabel: 'Yes.',
                btnOKClass: 'btn-success',
                callback: function (result) {
                    if (result) {
                        if (callTrue) {
                            callTrue();
                        }
                    }
                    else {
                        if (callFalse) {
                            callFalse();
                        }
                    }
                },
                onshown: function (dialogRef) {
                    var divHeader = NA.common.doc.querySelector('div.modal-header:nth-child(1)');
                    divHeader.style.backgroundColor = 'green';
                }
            });
        };

        function dialogAlert(message, title, callback) {
            return BootstrapDialog.alert({
                title: title || NA.common.message.titleInfo,
                message: message,
                size: BootstrapDialog.SIZE_SMALL,
                //animate:false,
                cssClass: 'login-dialog',
                closeByBackdrop: false,
                closeByKeyboard: false,
                type: BootstrapDialog.TYPE_INFO,
                closable: false,
                draggable: true,
                buttonLabel: 'OK',
                callback: function (result) {
                    if (result) {
                        if (callback) {
                            callback();
                        }
                        return true;
                    }
                },
                onshown: function (dialogRef) {
                    var divHeader = NA.common.doc.querySelector('div.modal-header:nth-child(1)');
                    divHeader.style.backgroundColor = 'green';
                }
            });
        };
        window.showDialogEntry = function (event) {//function ini akan di panggil oleh NAJS.common.dialog,setiap menu add/edit/delete,etc di clik 
            //add handler to btnOK untuk mengantisipasi form load gagal
            var win = window
            var target = NA.NAEvent.getTarget(event);
            var hasLoadDialog = false;
            try {
                if (target.innerText === 'Email Data') {
                    var btn_mailExport = qs('div.dialogButtonRightOther a.btn-link:nth-child(2)'),
                        btn_mailPreview = qs('div.dialogButtonRightOther a.btn-link:nth-child(1)');
                    NA.common.NA_setAttr(btn_mailExport, {
                        "style": "cursor: pointer;pointer-events: all;width: auto;margin-right:5px"
                    });
                    btn_mailExport.textContent = 'Export To PDF';
                    NA.common.NA_setAttr(btn_mailPreview, {
                        "style": "cursor: pointer;pointer-events: all;width: auto;"
                    });
                    btn_mailPreview.textContent = 'Preview PDF';
                    var btnToPDF = qs('div.bottomDialogContent a.btn-link:nth-child(1)');
                    //====================================== Display Email Data Dialog =========================================
                    $('div.maindialogContent').load(url_emailData(), function (response, status, xhr) {
                        if (status == "success") {
                            var jspdf = "../../../static/app/scripts/jspdf.js",
                                sfm = "../../../static/app/scripts/standard_fonts_metrics.js",
                                stz = "../../../static/app/scripts/split_text_to_size.js",
                                jspdf_autoTable = "../../../static/app/scripts/jspdf.plugin.autotable.min.js",
                                jqUI = "../../../static/app/scripts/jquery-ui.min.js",
                                autoComp = "../../../static/app/scripts/autocomplete.js",
                                emailDataJS = "../../../static/app/scripts/NA_EmailData.js",
                                content_0 = qs('div#content-0');
                            if (qs('script#jspdf') == null) {
                                NA.common.loadScript(jspdf, content_0, 'jspdf');
                                NA.common.loadScript(sfm, content_0, 'sfm');
                                NA.common.loadScript(stz, content_0, 'stz');
                                NA.common.loadScript(jspdf_autoTable, content_0, 'jspdf_autoTable');
                                NA.common.loadScript(emailDataJS, content_0, 'emailData_scripts');
                            };
                            originalData = getValues_emailForm();
                            var initializeEmail = NA.common.getElementID('initializeEmail');
                            initializeEmail.value = originalData;

                            //=========================================== End Display Email Data Dialog ===========================================
                        }
                    });
                    //if (window.document.body.style.cursor != 'default') { window.document.body.style.cursor = 'default'; }
                    //return false;
                } else if (target.innerText.trim() === 'Add' || target.innerText.trim() === 'Edit' || target.innerText.trim() == 'Open') {
                    var dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
                    if (target.innerText.trim() == 'Edit' || target.innerText.trim() == 'Open') {
                        var idapp = getGridId();
                        if (typeof idapp == 'undefined' || !idapp || idapp == '') {
                            NA.common.dialog.closeDialog(dialog);
                            var message = 'Please select data you want to Edit';
                            if (gLost_grid.getGridParam('records') === 0) {
                                message = 'No Data Found at here'
                            };
                            return dialogAlert(message, NA.common.message.titleInfo, function () {
                                return gLost_grid.trigger('reloadGrid');
                            });
                        }
                    };

                    $('div.maindialogContent').load("ShowEntry/?" + win.encodeURIComponent('idapp') + '=' + win.encodeURIComponent(getGridId()) + '&' + win.encodeURIComponent('statusForm')
                        + '=' + win.encodeURIComponent(target.innerText.trim()), function (responseTxt, statusTxt, xhr) {//load /tampilkan form entry data(ShowEntry hanya contoh nama form)
                            if (responseTxt == 'Lost' && xhr.status == 500) {
                                NA.common.dialog.closeDialog(dialog);
                                return dialogAlert(NA.common.message.dataHasLost, NA.common.message.titleInfo, function () {
                                    return gLost_grid.trigger("reloadGrid");
                                });
                            }
                            if (statusTxt == "success") {  //jika form sudah di load selanjutnya tinggal inisialisasi semua component dan simpang semua ke dalam variable jika perlua
                                //remove attribute disable untuk button OK dan cancel bila statusnya Add
                                switch (status) {
                                    case 'Add':
                                        {
                                            break;
                                        }
                                    case 'Edit':
                                        {
                                            setTimeout(function () {
                                                $('div.dialogButtonOKCancel>a.button').removeAttr("disabled");
                                                var fromgoods = qs('input#id_fk_fromgoods')
                                                //fromgoods.value = getGridCellValue(gLost_grid, 'fk_fromgoods');
                                            }, 100)
                                        }
                                    case 'Open': {
                                        $('div.dialogButtonEntry>a.button').attr("disabled", true);
                                        break;
                                    }
                                };

                                var fk_goods = qs('input#id_fk_goods'),
                                    itemcode = qs('input#id_itemcode'),
                                    goods = qs('input#id_goods'),
                                    btn_fkGoods = qs('button#fk_goods'),
                                    btnfindResp = qs('button#btnfindResp'),
                                    typeApp = qs('input#id_typeApp'),
                                    serialnumber = qs('input#id_serialNumber'),
                                    fk_goods_outwards = qs('input#id_fk_goods_outwards'),
                                    fk_goods_lending = qs('input#id_fk_goods_lending'),
                                    fk_maintenance = qs('input#id_fk_maintenance'),
                                    fk_goods_return = qs('input#id_fk_goods_return'),
                                    fk_usedby = qs('input#id_fk_usedby'),
                                    nik_used = qs('input#id_nik_used'),
                                    empl_used = qs('input#id_empl_used'),

                                    fk_responsibleperson = qs('input#id_fk_responsibleperson'),
                                    nik_resp = qs('input#id_nik_resp'),
                                    empl_resp = qs('input#id_empl_resp'),

                                    fk_lostby = qs('input#id_fk_lostby'),
                                    nik_lostby = qs('input#id_nik_lostby'),
                                    empl_lostby = qs('input#id_empl_lostby'),

                                    btn_fkLostby = qs('button#fk_lostby'),
                                    fk_fromGoods = qs('input[type="hidden"]#id_fk_fromgoods');
                                //simpan original data di initializeForm
                                originalData = JSON.stringify(JSON.parse(NA.common.getElementID('id_initializeForm').value));
                                $('input#id_datelost').datepicker({
                                    dateFormat: 'dd/mm/yy',
                                    changeMonth: true,
                                    changeYear: true,
                                    dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri ', 'Sat'],
                                    showButtonPanel: true,
                                    closeText: "Close",
                                    currentText: 'Now',
                                    minDate: (function (g) {
                                        if (g.status === 'Edit') {
                                            var eloriginalData = JSON.parse(originalData),
                                                hasRef = eloriginalData['hasRefData'];
                                            if (hasRef) { return 1; }
                                            var valDateReq = new Date(eloriginalData.datelost);
                                            return valDateReq;
                                        }
                                    })(win),
                                }); 
                                if (win.status !== 'Add') {
                                    var valDatelost = new Date(NA.common.getElementID('id_datelost').value);
                                    $("#id_datelost").datepicker("setDate", valDatelost);
                                    //format value jadi dd//mm/yyy
                                    $("#id_datelost").val(formatDate(valDatelost));
                                }
                                 originalData = JSON.stringify(getValues_Form());
                                if (status !== 'Open' && status !== '') {//hanya untuk status Add/Edit       
                                    function loadData_byForm(tab, valSearch) {
                                        var gridTbl, gridTbl_pager_id, elGrid, Caption,
                                            urlFKGoods = 'SearchGoodsByForm/?' + win.encodeURIComponent('goods_filter') + '=' + valSearch;
                                        //check jqgrid apakah sudah di buat di dom
                                        var hasGridOutwards = NA.common.getElementID('gbox_NA_GoodsLost_FK_Goods_outwards'),
                                            hasGridLending = NA.common.getElementID('gbox_NA_GoodsLost_FK_Goods_lending'),
                                            hasGridMaintenance = NA.common.getElementID('gbox_NA_GoodsLost_FK_Goods_maintenance'),
                                            hasGridreturn = NA.common.getElementID('gbox_NA_GoodsLost_FK_Goods_return'),
                                            hasGridCreated = false;
                                        if (tab === 'g_outwards') {
                                            if (hasGridOutwards) { hasGridCreated = true; }
                                            Caption = 'Transaction -- Find goods outwards';
                                            gridTbl = $('#NA_GoodsLost_FK_Goods_outwards');
                                            gridTbl_pager_id = '#NA_GoodsLost_FK_Goods_outwards_Pager';
                                            urlFKGoods += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_outwards');
                                        } else if (tab === 'g_lending') {
                                            if (hasGridLending) { hasGridCreated = true; }
                                            Caption = 'Transaction -- Find goods lending';
                                            gridTbl = $('#NA_GoodsLost_FK_Goods_lending');
                                            gridTbl_pager_id = '#NA_GoodsLost_FK_Goods_lending_Pager';
                                            urlFKGoods += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_lending');
                                        }
                                        else if (tab === 'g_return') {
                                            if (hasGridreturn) { hasGridCreated = true; }
                                            Caption = 'Transaction -- Find goods return';
                                            gridTbl = $('#NA_GoodsLost_FK_Goods_return');
                                            gridTbl_pager_id = '#NA_GoodsLost_FK_Goods_return_Pager';
                                            urlFKGoods += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_return');
                                        }
                                        else if (tab === 'g_maintenance') {
                                            if (hasGridMaintenance) { hasGridCreated = true; }
                                            Caption = 'Transaction -- Find goods maintenance';
                                            gridTbl = $('#NA_GoodsLost_FK_Goods_maintenance');
                                            gridTbl_pager_id = '#NA_GoodsLost_FK_Goods_maintenance_Pager';
                                            urlFKGoods += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_maintenance');
                                        }
                                        var gridTbl_pager = $(gridTbl_pager_id);
                                        //jQuery("#list").jqGrid('hideCol',["ColumnName","ColumnName2"]); hide column dynamically
                                        //jQuery("#list").jqGrid('showCol',["colModel1_name","colModel2_name"]); show column dynamically
                                        var col_model = [
                                            { name: 'idapp', hidden: true, align: 'left' },
                                            { name: 'fk_goods', hidden: true, align: 'left' },
                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, key: true, },
                                            { name: 'itemcode', width: 80, align: 'left', sortable: true, editable: false, },
                                            { name: 'goods', index: 'goods', width: 220, sortable: true, editable: false, align: 'left' },
                                            { name: 'serialnumber', index: 'serialnumber', width: 150, sortable: true, editable: false, align: 'left' },
                                            { name: 'fromgoods', hidden: true, align: 'left' },
                                            { name: 'fk_usedemployee', hidden: true, align: 'left' },
                                            { name: 'nik_usedemployee', hidden: true, align: 'left' },
                                            { name: 'used_employee', hidden: true, index: 'used_employee', width: 120, sortable: true, editable: false, align: 'left', },
                                            { name: 'fk_resp', hidden: true, align: 'left' },
                                            { name: 'nik_resp', hidden: true, align: 'left' },
                                            { name: 'emplyee_responsible', hidden: true, align: 'left' },
                                            { name: 'fk_employee', hidden: true, align: 'left' },
                                            { name: 'nik_employee', hidden: true },
                                            { name: 'from_employee', hidden: true, index: 'from_employee', width: 120, sortable: true, editable: false, align: 'left', },
                                            {
                                                 name: 'datereturn', hidden: true, index: 'datereturn', width: 110, sortable: true, editable: false, align: 'left', formatter: 'date',
                                                formatoptions: {
                                                    align: 'left',
                                                    srcformat: 'Y-m-d', newformat: 'd F Y'
                                                }
                                            },
                                            { name: 'iscompleted', hidden: true, index: 'iscompleted', width: 110, sortable: false, editable: false, formatter: 'checkbox', align: 'center' },
                                            { name: 'minusdesc', hidden: true, index: 'minusdesc', sortable: true, editable: false, align: 'left',}
                                        ];
                                        var col_names = ['idapp', 'fk goods', 'NO', 'itemcode', 'goods Description', 'Serial Number', 'from goods',
                                            'fk usedemployee', 'nik esedemployee', 'Last Used By', 'fk resp', 'nik resp', 'employee responsible', 'fk_employee',
                                            'nik_employee', 'Returned By ', 'Date Return', 'Completed', 'Minus desc'];
                                        if (hasGridCreated) {
                                            jQuery(gridTbl).setGridParam({ url: urlFKGoods }).trigger("reloadGrid", [{ page: 1, }]);
                                        }
                                        else {
                                            gridTbl.jqGrid({
                                                url: urlFKGoods,
                                                mtype: "GET",
                                                datatype: "json",//column IDapp, NO,    goods   datereceived suppliername FK_ReceivedBy  receivedby FK_P_R_By pr_by totalpurchase totalreceived
                                                colNames: col_names,
                                                colModel: col_model,
                                                ondblClickRow: function (rowId) {
                                                    //fire button OK
                                                    var btnOK = qs('button#btnOKFindGoods');
                                                    btnOK.click();
                                                },
                                                gridComplete: function () {
                                                    document.body.style.cursor = 'default';
                                                },
                                                cellEdit: false,
                                                viewrecords: true,
                                                height: '170px',
                                                rowNum: 500,
                                                rowList: [20, 50, 100, 200, 300, 500],
                                                sortname: "itemcode",
                                                sortorder: "asc",
                                                multiSort: false,
                                                shrinkToFit: false,
                                                iconSet: "fontAwesome",
                                                //forceFit: true,
                                                //toolbar: true,
                                                scrollrows: true,
                                                //hidegrid: true,
                                                caption: Caption,
                                                pager: gridTbl_pager_id
                                            });
                                            gridTbl.navGrid(gridTbl_pager_id, {
                                                search: false, // show search button on the toolbar
                                                add: false,
                                                edit: false,
                                                del: false,
                                                refresh: true
                                            });
                                        }
                                        var elGrid_lending = qsAll('div#gbox_NA_GoodsLost_FK_Goods_lending,div#gview_NA_GoodsLost_FK_Goods_lending,div#gview_NA_GoodsLost_FK_Goods_lending > div.ui-jqgrid-hdiv,div#gview_NA_GoodsLost_FK_Goods_lending > div.ui-jqgrid-bdiv, div#NA_GoodsLost_FK_Goods_lending_Pager')
                                        if (elGrid_lending) {
                                            Array.prototype.forEach.call(elGrid_lending, function (el) {
                                                el.style.width = 'inherit';
                                            });
                                        }
                                        var elGrid_maintenance = qsAll('div#gbox_NA_GoodsLost_FK_Goods_maintenance,div#gview_NA_GoodsLost_FK_Goods_maintenance,div#gview_NA_GoodsLost_FK_Goods_maintenance > div.ui-jqgrid-hdiv,div#gview_NA_GoodsLost_FK_Goods_maintenance > div.ui-jqgrid-bdiv, div#NA_GoodsLost_FK_Goods_maintenance_Pager')
                                        if (elGrid_maintenance) {
                                            Array.prototype.forEach.call(elGrid_maintenance, function (el) {
                                                el.style.width = 'inherit';
                                            });
                                        }
                                        var elGrid_return = qsAll('div#gbox_NA_GoodsLost_FK_Goods_return,div#gview_NA_GoodsLost_FK_Goods_return,div#gview_NA_GoodsLost_FK_Goods_return > div.ui-jqgrid-hdiv,div#gview_NA_GoodsLost_FK_Goods_return > div.ui-jqgrid-bdiv, div#NA_GoodsLost_FK_Goods_return_Pager')
                                        if (elGrid_return) {
                                            Array.prototype.forEach.call(elGrid_return, function (el) {
                                                el.style.width = 'inherit';
                                            });
                                        }
                                        var allDiv = qsAll('.ui-jqgrid-view,.ui-jqgrid-hdiv ui-state-default,.ui-jqgrid-bdiv');
                                        Array.prototype.forEach.call(allDiv, function (el) {
                                            el.style.width = 'inherit';
                                        });
                                        if (tab === 'g_outwards') {
                                            //show columns
                                            gridTbl.jqGrid('showCol', ["used_employee"]);
                                            //  //hide columns
                                            gridTbl.jqGrid('hideCol', ["from_employee", "datereturn", "iscompleted", "minusdesc"]);
                                        } else if (tab === 'g_lending') {
                                            // //show columns
                                            gridTbl.jqGrid('showCol', ["used_employee"]);
                                            //hide columns
                                            gridTbl.jqGrid('hideCol', ["from_employee", "datereturn", "iscompleted", "minusdesc"]);
                                        }
                                        else if (tab === 'g_return') {
                                            if (hasGridreturn) { hasGridCreated = true; }
                                            //show columns
                                            gridTbl.jqGrid('showCol', ["used_employee", "from_employee", "datereturn", "iscompleted", "minusdesc"]);
                                        }
                                        else if (tab === 'g_maintenance') {
                                            if (hasGridMaintenance) { hasGridCreated = true; }
                                            //hide columns
                                            gridTbl.jqGrid('hideCol', ["used_employee", "from_employee", "datereturn", "iscompleted", "minusdesc"]);
                                        }
                                        restyleBoostrapDialog();
                                    };//end loadData_byForm
                            //============= Search Goods By Form ==============
                                    function searchGoods(event) {
                                        var gridTbl_outwards = $('#NA_GoodsLost_FK_Goods_outwards'),
                                            gridTbl_lending = $('#NA_GoodsLost_FK_Goods_lending'),
                                            gridTbl_maintenance = $('#NA_GoodsLost_FK_Goods_maintenance'),
                                            gridTbl_return = $('#NA_GoodsLost_FK_Goods_return');

                                        BootstrapDialog.show({
                                            draggable: true,
                                            type: BootstrapDialog.TYPE_SUCCESS,
                                            size: BootstrapDialog.SIZE_SMALL,
                                            title: 'Search Goods .. .',
                                            message: function (dialogRef) {
                                                var placeHolder = 'Enter goods or serial number to search for .. .';
                                                containerMessage = NA.common.dialog.createFormContainer('fk_goods', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch                                                  
                                                        if (e.keyCode === 13) {
                                                            NA.NAEvent.preventDefault(e);
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = 'SearchGoodsByForm/?' + win.encodeURIComponent('goods_filter') + '=' + win.encodeURIComponent(e.target.value.trim());
                                                            if (qs('div#tab_g_outwards').getAttribute('aria-hidden') == 'false') {
                                                                url += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_outwards');
                                                                $(gridTbl_outwards).setGridParam({ url: url, search: true }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            else if (qs('div#tab_g_lending').getAttribute('aria-hidden') == 'false') {
                                                                url += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_lending');
                                                                $(gridTbl_lending).setGridParam({ url: url, search: true }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            else if (qs('div#tab_g_maintenance').getAttribute('aria-hidden') == 'false') {
                                                                url += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_maintenance');
                                                                $(gridTbl_maintenance).setGridParam({ url: url, search: true }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            else if (qs('div#tab_g_return').getAttribute('aria-hidden') == 'false') {
                                                                url += '&' + win.encodeURIComponent('tab_section') + '=' + win.encodeURIComponent('g_return');
                                                                $(gridTbl_return).setGridParam({ url: url, search: true }).trigger("reloadGrid", [{ page: 1, }]);
                                                            };
                                                            win.document.body.style.cursor = 'default';
                                                            NA.NAEvent.stopPropagation(e);
                                                        }
                                                    }, function (e) {
                                                        txtSearch = NA.common.getElementID('txtsearch_fk_goods');
                                                        NA.common.triggerKeyboardEvent(txtSearch, 13);
                                                    });
                                                var children = containerMessage.childNodes;
                                                var mainContainer = null, txtSearch = null;
                                                for (var i = 0, len = children.length; i < len; i++) {
                                                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_goods') {
                                                        mainContainer = children[i]; break;
                                                    }
                                                };

                                                //loads Data into JqueryGrid
                                                var cont_tab = NA.common.doc.createElement('div'),

                                                    ul_tab = NA.common.doc.createElement('ul'),
                                                    li_tab_g_outwards = NA.common.doc.createElement('li'),
                                                    a_tab_g_outwards = NA.common.doc.createElement('a'),
                                                    tab_g_outwards = NA.common.doc.createElement('div'),

                                                    li_tab_g_lending = NA.common.doc.createElement('li'),
                                                    a_tab_g_lending = NA.common.doc.createElement('a'),
                                                    tab_g_lending = NA.common.doc.createElement('div'),

                                                    li_tab_g_maintenance = NA.common.doc.createElement('li'),
                                                    a_tab_g_maintenance = NA.common.doc.createElement('a'),
                                                    tab_g_maintenance = NA.common.doc.createElement('div');

                                                li_tab_g_return = NA.common.doc.createElement('li'),
                                                    a_tab_g_return = NA.common.doc.createElement('a'),
                                                    tab_g_return = NA.common.doc.createElement('div');

                                                cont_tab.id = 'cont_tab_goods_lost',

                                                    a_tab_g_outwards.href = '#tab_g_outwards',
                                                    a_tab_g_lending.href = '#tab_g_lending',
                                                    a_tab_g_maintenance.href = '#tab_g_maintenance',
                                                    a_tab_g_return.href = '#tab_g_return',

                                                    tab_g_outwards.id = 'tab_g_outwards',
                                                    tab_g_outwards.style.padding = '4px',

                                                    tab_g_lending.id = 'tab_g_lending',
                                                    tab_g_lending.style.padding = '4px',

                                                    tab_g_maintenance.id = 'tab_g_maintenance',
                                                    tab_g_maintenance.style.padding = '4px',

                                                    tab_g_return.id = 'tab_g_return',
                                                    tab_g_return.style.padding = '4px';

                                                a_tab_g_outwards.textContent = 'Goods Outwards',
                                                    NA.common.NA_setAttr(a_tab_g_outwards, {
                                                        'style': 'padding: 4px;font-size: 13px;'
                                                    });

                                                a_tab_g_lending.textContent = 'Goods Lending',
                                                    NA.common.NA_setAttr(a_tab_g_lending, {
                                                        'style': 'padding: 4px;font-size: 13px;'
                                                    });

                                                a_tab_g_maintenance.textContent = 'Goods Maintenance';
                                                NA.common.NA_setAttr(a_tab_g_maintenance, {
                                                    'style': 'padding: 4px;font-size: 13px;'
                                                });

                                                a_tab_g_return.textContent = 'Goods Return';
                                                NA.common.NA_setAttr(a_tab_g_return, {
                                                    'style': 'padding: 4px;font-size: 13px;'
                                                });


                                                li_tab_g_outwards.appendChild(a_tab_g_outwards);
                                                li_tab_g_lending.appendChild(a_tab_g_lending);
                                                li_tab_g_maintenance.appendChild(a_tab_g_maintenance);
                                                li_tab_g_return.appendChild(a_tab_g_return);

                                                ul_tab.appendChild(li_tab_g_outwards);
                                                ul_tab.appendChild(li_tab_g_lending);
                                                ul_tab.appendChild(li_tab_g_maintenance);
                                                ul_tab.appendChild(li_tab_g_return);

                                                cont_tab.appendChild(ul_tab);

                                                var gridTbl_outwards = NA.common.doc.createElement('table');
                                                gridTbl_outwards.id = 'NA_GoodsLost_FK_Goods_outwards';
                                                var gridPager_outwards = NA.common.doc.createElement('div');
                                                gridPager_outwards.id = 'NA_GoodsLost_FK_Goods_outwards_Pager';
                                                tab_g_outwards.appendChild(gridTbl_outwards);
                                                tab_g_outwards.appendChild(gridPager_outwards);

                                                var gridTbl_lending = NA.common.doc.createElement('table');
                                                gridTbl_lending.id = 'NA_GoodsLost_FK_Goods_lending';
                                                var gridPager_lending = NA.common.doc.createElement('div');
                                                gridPager_lending.id = 'NA_GoodsLost_FK_Goods_lending_Pager';
                                                tab_g_lending.appendChild(gridTbl_lending);
                                                tab_g_lending.appendChild(gridPager_lending);

                                                var gridTbl_maintenance = NA.common.doc.createElement('table');
                                                gridTbl_maintenance.id = 'NA_GoodsLost_FK_Goods_maintenance';
                                                var gridPager_maintenance = NA.common.doc.createElement('div');
                                                gridPager_maintenance.id = 'NA_GoodsLost_FK_Goods_maintenance_Pager';
                                                tab_g_maintenance.appendChild(gridTbl_maintenance);
                                                tab_g_maintenance.appendChild(gridPager_maintenance);

                                                var gridTbl_return = NA.common.doc.createElement('table');
                                                gridTbl_return.id = 'NA_GoodsLost_FK_Goods_return';
                                                var gridPager_return = NA.common.doc.createElement('div');
                                                gridPager_return.id = 'NA_GoodsLost_FK_Goods_return_Pager';
                                                tab_g_return.appendChild(gridTbl_return);
                                                tab_g_return.appendChild(gridPager_return);

                                                cont_tab.appendChild(tab_g_outwards);
                                                cont_tab.appendChild(tab_g_lending);
                                                cont_tab.appendChild(tab_g_maintenance);
                                                cont_tab.appendChild(tab_g_return);

                                                mainContainer.appendChild(cont_tab);
                                                return containerMessage;
                                            },
                                            onshown: function (dialogRef) {
                                                txtSearch = NA.common.getElementID('txtsearch_fk_goods');
                                                var valSearch = '';
                                                if (txtSearch != null) {
                                                    valSearch = win.encodeURIComponent(txtSearch.textContent.trim());
                                                };
                                                loadData_byForm('g_outwards', valSearch);
                                                $('div#cont_tab_goods_lost').tabs({
                                                    activate: function (event, ui) {
                                                        var targetCurrent = event.currentTarget;
                                                        if (targetCurrent.text == 'Goods Outwards') {
                                                            loadData_byForm('g_outwards', valSearch);
                                                        } else if (targetCurrent.text == 'Goods Lending') {
                                                            loadData_byForm('g_lending', valSearch);
                                                        } else if (targetCurrent.text == 'Goods Maintenance') {
                                                            loadData_byForm('g_maintenance', valSearch);
                                                        }
                                                        else if (targetCurrent.text == 'Goods Return') {
                                                            loadData_byForm('g_return', valSearch);
                                                        }
                                                    }
                                                }); // tabs
                                                elGrid_outwards = qsAll('div#gbox_NA_GoodsLost_FK_Goods_outwards,div#gview_NA_GoodsLost_FK_Goods_outwards,div#gview_NA_GoodsLost_FK_Goods_outwards > div.ui-jqgrid-hdiv,div#gview_NA_GoodsLost_FK_Goods_outwards > div.ui-jqgrid-bdiv, div#NA_GoodsLost_FK_Goods_outwards_Pager')
                                                Array.prototype.forEach.call(elGrid_outwards, function (el) {
                                                    el.style.width = 'inherit';
                                                });
                                                //show columns
                                                gridTbl_outwards.jqGrid('showCol', ["used_employee"]);
                                                gridTbl_outwards.jqGrid('hideCol', ["from_employee", "datereturn", "iscompleted", "minusdesc"]);
                                                //restyleBoostrapDialog();
                                            },
                                            closable: false,
                                            animate: false,
                                            closeByBackdrop: false,
                                            closeByKeyboard: false,
                                            buttons: [{
                                                label: 'Cancel',
                                                icon: 'glyphicon glyphicon-remove',
                                                cssClass: 'btn-success',
                                                action: function (dialogRef) {
                                                    dialogRef.close();
                                                },
                                            }, {
                                                label: 'OK',
                                                id: 'btnOKFindGoods',
                                                icon: 'glyphicon glyphicon-ok',
                                                cssClass: 'btn-success',
                                                action: function (dialogRef) {
                                                    var gridTbl;
                                                    if (qs('div#tab_g_lending').getAttribute('aria-hidden') == 'false') {
                                                        gridTbl = $('#NA_GoodsLost_FK_Goods_lending');
                                                    }
                                                    else if (qs('div#tab_g_outwards').getAttribute('aria-hidden') == 'false') {
                                                        gridTbl = $('#NA_GoodsLost_FK_Goods_outwards');
                                                    }
                                                    else if (qs('div#tab_g_maintenance').getAttribute('aria-hidden') == 'false') {
                                                        gridTbl = $('#NA_GoodsLost_FK_Goods_maintenance');
                                                    }
                                                    else if (qs('div#tab_g_return').getAttribute('aria-hidden') == 'false') {
                                                        gridTbl = $('#NA_GoodsLost_FK_Goods_return');
                                                    };
                                                    var rowId = gridTbl.jqGrid('getGridParam', 'selrow'),
                                                        rowData = gridTbl.getRowData(rowId),
                                                        target = NA.NAEvent.getTarget(event),
                                                        from_goods = rowData['fromgoods'];
                                                    fk_goods.value = rowData['fk_goods'];
                                                    fk_fromGoods.value = from_goods;
                                                    itemcode.value = rowData['itemcode'];
                                                    goods.value = rowData['goods'].match(/^\w+\ \w+/);
                                                    typeApp.value = rowData['goods'].match(/\w+$/);
                                                    serialnumber.value = rowData['serialnumber'];
                                                    fk_usedby.value = rowData['fk_usedemployee'];
                                                    nik_used.value = rowData['nik_usedemployee'];
                                                    empl_used.value = rowData['used_employee'];

                                                    fk_responsibleperson.value = rowData['fk_usedemployee'];
                                                    nik_resp.value = rowData['nik_usedemployee'];
                                                    empl_resp.value = rowData['used_employee'];

                                                    fk_lostby.value = rowData['fk_usedemployee'];
                                                    nik_lostby.value = rowData['nik_usedemployee'];
                                                    empl_lostby.value = rowData['used_employee'];

                                                    if (from_goods == 'GO') {
                                                        fk_goods_outwards.value = rowData['idapp']
                                                        // ==== clear other value if data is change by user ====
                                                        fk_goods_lending.value = null;
                                                        fk_maintenance.value = null;
                                                        fk_goods_return.value = null;
                                                        //if (fk_goods_lending.value == ro
                                                    } else if (from_goods == 'GL') {
                                                        fk_goods_lending.value = rowData['idapp'];
                                                        // ==== clear other value if data is change by user ====
                                                        fk_goods_outwards.value = null;
                                                        fk_maintenance.value = null;
                                                        fk_goods_return.value = null;
                                                        //if (fk_goods_outwards.value == ro
                                                    } else if (from_goods == 'GM') {
                                                        fk_maintenance.value = rowData['idapp'];
                                                        // ==== clear other value if data is change by user ====
                                                        fk_goods_outwards.value = null;
                                                        fk_goods_lending.value = null;
                                                        fk_goods_return.value = null;
                                                    }
                                                    else if (from_goods == 'GR') {
                                                        fk_goods_return.value = rowData['idapp'];
                                                        // ==== clear other value if data is change by user ====
                                                        fk_goods_outwards.value = null;
                                                        fk_goods_lending.value = null;
                                                        fk_maintenance.value = null;
                                                    }
                                                    dialogRef.close();
                                                }
                                            }]
                                        });
                                    }
                                    function searchEmployee(event) {
                                        BootstrapDialog.show({
                                            draggable: true,
                                            type: BootstrapDialog.TYPE_SUCCESS,
                                            size: BootstrapDialog.SIZE_SMALL,
                                            title: 'Search Employee .. .',
                                            message: function (dialogRef) {
                                                var placeHolder = 'Enter employee name or NIK to search for.. .';
                                                containerMessage = NA.common.dialog.createFormContainer('fk_employee', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch                                                  
                                                        if (e.keyCode === 13) {
                                                            NA.NAEvent.preventDefault(e);
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = '/NA_Employee/SearchEmployeeByForm/?' + win.encodeURIComponent('employee_filter') + '=' + win.encodeURIComponent(e.target.value.trim());
                                                            if (gridTbl) {
                                                                $(gridTbl).setGridParam({ url: url, search: true }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            win.document.body.style.cursor = 'default';
                                                            NA.NAEvent.stopPropagation(e);
                                                        }
                                                    }, function (e) {
                                                        txtSearch = NA.common.getElementID('txtsearch_fk_employee');
                                                        NA.common.triggerKeyboardEvent(txtSearch, 13);
                                                    });
                                                var children = containerMessage.childNodes;
                                                var mainContainer = null, txtSearch = null;
                                                for (var i = 0, len = children.length; i < len; i++) {
                                                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_employee') {
                                                        mainContainer = children[i]; break;
                                                    }
                                                };

                                                //loads Data into JqueryGrid
                                                gridTbl = NA.common.doc.createElement('table');
                                                gridTbl.id = 'NA_GoodsLost_FK_Employee';
                                                gridPager = NA.common.doc.createElement('div');
                                                gridPager.id = 'NA_GoodsLost_FK_Employee_Pager';
                                                mainContainer.appendChild(gridTbl);
                                                mainContainer.appendChild(gridPager);
                                                return containerMessage;
                                            },
                                            onshown: function (dialogRef) {
                                                txtSearch = NA.common.getElementID('txtsearch_fk_employee');
                                                var valSearch = '';
                                                if (txtSearch != null) {
                                                    valSearch = win.encodeURIComponent(txtSearch.textContent.trim());
                                                }
                                                gridTbl = $('#NA_GoodsLost_FK_Employee');
                                                var urlFKGoods = 'SearchEmployeeByForm/?' + win.encodeURIComponent('employee_filter') + '=' + valSearch;
                                                gridTbl.jqGrid({
                                                    url: urlFKGoods,
                                                    mtype: "GET",
                                                    datatype: "json",//column IDapp, NO,    goods   datereceived suppliername FK_ReceivedBy  receivedby FK_P_R_By pr_by totalpurchase totalreceived
                                                    colNames: ['idapp', 'NO', 'Nik', 'Employee Name'],
                                                    colModel: [
                                                        { name: 'idapp', hidden: true, align: 'left' },
                                                        { name: 'no', width: 40, align: 'right', sortable: false, editable: false, key: true, },
                                                        { name: 'nik', index: 'nik', width: 220, sortable: true, editable: false, align: 'left' },
                                                        { name: 'employee_name', index: 'employee_name', width: 250, align: 'left', sortable: true, editable: false, }
                                                    ],
                                                    ondblClickRow: function (rowId) {
                                                        //fire button OK
                                                        var btnOK = dialogRef.getButton('btnOKFindEmployee');
                                                        btnOK.click();
                                                    },
                                                    gridComplete: function () {
                                                        document.body.style.cursor = 'default';
                                                    },
                                                    cellEdit: false,
                                                    viewrecords: true,
                                                    height: '170px',
                                                    rowNum: 500,
                                                    rowList: [20, 50, 100, 200, 300, 500],
                                                    sortname: "employee_name",
                                                    sortorder: "asc",
                                                    multiSort: true,
                                                    shrinkToFit: false,
                                                    iconSet: "fontAwesome",
                                                    //forceFit: true,
                                                    //toolbar: true,
                                                    scrollrows: true,
                                                    //hidegrid: true,
                                                    //caption: "Transactions ---Find goods",
                                                    pager: "#NA_GoodsLost_FK_Employee_Pager"
                                                });
                                                gridTbl.navGrid('#NA_GoodsLost_FK_Employee_Pager', {
                                                    search: false, // show search button on the toolbar
                                                    add: false,
                                                    edit: false,
                                                    del: false,
                                                    refresh: false
                                                });
                                                restyleBoostrapDialog();
                                                var elGrid = qsAll('div#gbox_NA_GoodsLost_FK_Employee,div#gview_NA_GoodsLost_FK_Employee,div#gview_NA_GoodsLost_FK_Employee > div.ui-jqgrid-hdiv.ui-state-default.ui-corner-top,div#gview_NA_GoodsLost_FK_Employee > div.ui-jqgrid-bdiv, div#NA_GoodsLost_FK_Employee_Pager')
                                                Array.prototype.forEach.call(elGrid, function (el) {
                                                    el.style.width = 'inherit';
                                                });
                                            },
                                            closable: false,
                                            animate: false,
                                            closeByBackdrop: false,
                                            closeByKeyboard: false,
                                            buttons: [{
                                                label: 'Cancel',
                                                icon: 'glyphicon glyphicon-remove',
                                                cssClass: 'btn-success',
                                                action: function (dialogRef) {
                                                    dialogRef.close();
                                                },
                                            }, {
                                                label: 'OK',
                                                id: 'btnOKFindEmployee',
                                                icon: 'glyphicon glyphicon-ok',
                                                cssClass: 'btn-success',
                                                action: function (dialogRef) {
                                                    var rowId = gridTbl.jqGrid('getGridParam', 'selrow'),
                                                        rowData = gridTbl.getRowData(rowId),
                                                        target = NA.NAEvent.getTarget(event);
                                                    switch (target) {
                                                        case btnfindResp: {
                                                            fk_responsibleperson.value = rowData['idapp'];
                                                            nik_resp.value = rowData['nik'];
                                                            empl_resp.value = rowData['employee_name'];
                                                            break;
                                                        }
                                                        case btn_fkLostby: {
                                                            fk_lostby.value = rowData['idapp'];
                                                            nik_lostby.value = rowData['nik'];
                                                            empl_lostby.value = rowData['employee_name'];
                                                            break;
                                                        }
                                                    };
                                                    dialogRef.close();
                                                }
                                            }]
                                        });
                                    }
                                    NA.NAEvent.addHandler(nik_resp, 'keydown', function (event) {
                                        var target = NA.NAEvent.getTarget(event);
                                        if (event.keyCode == 13) {                                                                            //get employee with exact nik
                                            NA.NAEvent.preventDefault(event);//prevent from submit
                                            //jika ada tampilkan data di form employee_Received	NA.NAEvent.preventDefault(event);//prevent from submit
                                            var NAAjax = NA.common.AJAX;
                                            NAAjax.GET('GetEmployeeByNIK/?' + win.encodeURIComponent('nik') + '=' + win.encodeURIComponent(event.target.value),
                                                'application/json',//overrideMimeType returned by the server
                                                function () { window.document.body.style.cursor = 'wait'; },
                                                null,//nggak usah di isi bila tidak perlu
                                                function () {//function executed after data has been returned by server(XHR.onload)
                                                    var data = JSON.parse(this.responseText);
                                                    if (data) {
                                                        empl_resp.value = data['employee_name'] || '';
                                                    }
                                                }, null, function () {//function untuk ajax error
                                                    throw new Error(NAAjax.XHR.responseText + '\nStatus code :' + NAAjax.XHR.statusText);
                                                }, function () { window.document.body.style.cursor = 'default'; },//function ajax complete
                                                null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                                            );
                                        }
                                    });
                                    NA.NAEvent.addHandler(btnfindResp, 'click', function (event) {
                                        searchEmployee(event);
                                    });
                                    NA.NAEvent.addHandler(serialnumber, 'keydown', function (evt) {
                                        if (evt.keyCode === 13) {
                                            //get goods
                                            var NAAjax = NA.common.AJAX;
                                            NA.NAEvent.preventDefault(evt);//prevent from submit
                                            NAAjax.GET('GetGoodsBySN/?' + win.encodeURIComponent('serialno') + '=' + win.encodeURIComponent(evt.target.value),
                                                'application/json',//overrideMimeType returned by the server
                                                function (e) { window.document.body.style.cursor = 'wait'; },
                                                null,//nggak usah di isi bila tidak perlu
                                                function (e) {//function executed after data has been returned by server(XHR.onload)
                                                    var data = JSON.parse(this.responseText);
                                                    if (data) {
                                                        var nik_lostby = qs('input#id_nik_lostby'),
                                                            empl_lostby = qs('input#id_empl_lostby'),
                                                            from_goods = data['tbl_name'];
                                                        fk_goods.value = data['fk_goods'];
                                                        fk_fromGoods.value = from_goods;
                                                        itemcode.value = data['icode'];
                                                        goods.value = data['goods'].match(/^\w+\ \w+/);
                                                        typeApp.value = data['goods'].match(/\w+$/);
                                                        //serialnumber.value = data['serialnumber'];
                                                        fk_usedby.value = data['fk_employee'];
                                                        nik_used.value = data['nik_employee'];
                                                        empl_used.value = data['used_employee'];

                                                        fk_responsibleperson.value = data['fk_employee'];
                                                        nik_resp.value = data['nik_employee'];
                                                        empl_resp.value = data['used_employee'];

                                                        fk_lostby.value = data['fk_employee'];
                                                        nik_lostby.value = data['nik_employee'];
                                                        empl_lostby.value = data['used_employee'];
                                                        if (from_goods == 'GO') {
                                                            fk_goods_outwards.value = data['idapp']
                                                            // ==== clear other value if data is change by user ====
                                                            fk_goods_lending.value = null;
                                                            fk_maintenance.value = null;
                                                            fk_goods_return.value = null;
                                                        } else if (from_goods == 'GL') {
                                                            fk_goods_lending.value = data['idapp'];
                                                            // ==== clear other value if data is change by user ====
                                                            fk_goods_outwards.value = null;
                                                            fk_maintenance.value = null;
                                                            fk_goods_return.value = null;
                                                        } else if (from_goods == 'GM') {
                                                            fk_maintenance.value = data['idapp'];
                                                            // ==== clear other value if data is change by user ====
                                                            fk_goods_outwards.value = null;
                                                            fk_goods_lending.value = null;
                                                            fk_goods_return.value = null;
                                                        }
                                                        else if (from_goods == 'GM') {
                                                            fk_goods_return.value = data['idapp'];
                                                            // ==== clear other value if data is change by user ====
                                                            fk_goods_outwards.value = null;
                                                            fk_goods_lending.value = null;
                                                            fk_maintenance.value = null;
                                                        }
                                                        window.document.body.style.cursor = 'default';
                                                    }
                                                    else {
                                                        XhrError(NAAjax.XHR);
                                                    }
                                                }, null, function (e) {//function untuk ajax error
                                                    window.document.body.style.cursor = 'default'; XhrError(NAAjax.XHR);
                                                }, function (e) { window.document.body.style.cursor = 'default'; },//function ajax complete
                                                null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                                            );
                                        }
                                    });
                                    NA.NAEvent.addHandler(btn_fkGoods, 'click', function (event) {
                                        searchGoods(event);
                                    });
                                    NA.NAEvent.addHandler(btn_fkLostby, 'click', function (event) {
                                        searchEmployee(event);
                                    });
                                    NA.NAEvent.addHandler(id_nik_lostby, 'keydown', function (event) {
                                        //get employee with exact nik
                                        NA.NAEvent.preventDefault(event);//prevent from submit
                                        //jika ada tampilkan data di form employee_Received	NA.NAEvent.preventDefault(event);//prevent from submit
                                        var NAAjax = NA.common.AJAX;
                                        NAAjax.GET('GetEmployeeByNIK/?' + win.encodeURIComponent('nik') + '=' + win.encodeURIComponent(event.target.value),
                                            'application/json',//overrideMimeType returned by the server
                                            function () { window.document.body.style.cursor = 'wait'; },
                                            null,//nggak usah di isi bila tidak perlu
                                            function () {//function executed after data has been returned by server(XHR.onload)
                                                var data = JSON.parse(this.responseText);
                                                if (data) {
                                                    empl_lostby.value = data['employee_name'] || '';
                                                }
                                            }, null, function () {//function untuk ajax error
                                                throw new Error(NAAjax.XHR.responseText + '\nStatus code :' + NAAjax.XHR.statusText);
                                            }, function () { window.document.body.style.cursor = 'default'; },//function ajax complete
                                            null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                                        );
                                    });
                                    //setting Custom Validity
                                    //var initializeForm = NA.common.getElementID('id_initializeForm');// NA.common.getElementID('id_initializeForm');
                                }
                                //simpan original data di initializeForm
                                originalData = JSON.stringify(getValues_Form());
                                var initializeForm = NA.common.getElementID('id_initializeForm');
                                initializeForm.value = originalData;
                                hasLoadDialog = true;
                            }
                            NA.NAEvent.preventDefault(event);
                            if (window.document.body.style.cursor != 'default') { window.document.body.style.cursor = 'default'; }
                        });
                };
                var dialog = qs("div.containerDialog"),
                    btnOkCancel = qsAll('div.dialogButtonOKCancel>a.button'),
                    btnClose = qs('button.ui-button.ui-dialog-titlebar-close');
                Array.prototype.forEach.call(btnOkCancel, function (elem) {
                    NA.NAEvent.addHandler(elem, 'click', function (event) {
                        NA.NAEvent.preventDefault(event);
                        if (!hasLoadDialog) {
                            NA.common.dialog.closeDialog(dialog);
                            win.document.body.style.cursor = 'default'; return false;
                        }
                        var target = NA.NAEvent.getTarget(event);
                        ExecuteHandler(target.innerText.trim());
                        if (event) {
                            NA.NAEvent.stopPropagation(event);
                        }
                    });
                });
                NA.NAEvent.addHandler(btnClose, 'click', function (event) {
                    if (hasLoadDialog) {
                        try {
                            ExecuteHandler('Close');
                        } catch (e) {
                            dialogAlert(e.message);
                        }
                    }
                    if (event) {
                        NA.NAEvent.stopPropagation(event);
                    }
                    win.document.body.style.cursor = 'default';
                    if (!hasLoadDialog) {
                        NA.common.dialog.closeDialog(dialog);
                        return false;
                    }
                });

                win.onbeforeunload = function (e) {
                    var dialog = qs("div.containerDialog");
                    if (!dialog) { return null; }
                    if (!hasLoadDialog) {
                        return null;
                    }
                    //var initializeForm = NA.common.getElementID('id_initializeForm');// NA.common.getElementID('id_initializeForm');
                    //originalData = initializeForm.value
                    var valuesForm = getValues_Form();
                    var retval = false;
                    if (NA.common.detectInputChanges(valuesForm, JSON.parse(originalData))) {
                        return NA.common.message.dataHasChanged;
                    }
                    return null;
                };
            } catch (e) {
                if (window.document.body.style.cursor != 'default') { window.document.body.style.cursor = 'default'; }
                alert(e);
            }
        };
    })();
</script>

{% endblock %}