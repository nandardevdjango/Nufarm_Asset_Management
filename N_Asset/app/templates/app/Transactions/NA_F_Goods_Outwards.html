{% extends "../../app/layout.html" %}
{% block SearchData %}
{% for itemCombo in populateColumn %}
<li><a href="#" data-tipe="{{itemCombo.dataType}}" data-column="{{itemCombo.columnName}}">{{itemCombo.label}}</a></li>
{% endfor %}

{% endblock %}

{% block javascriptAndUI %}
<!--================================Load Script Modules NA ===========================================-->
<script type="text/javascript" src="../../../static/app/scripts/NAJS.js"></script>
<!--=======================================================================================================-->
<script type="text/javascript">
(function () {
	var txtSearchMaster = NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
	    btnSearchMaster = NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default');
	var defPlaceHolder = txtSearchMaster.getAttribute('placeholder');
	if (!NA.common.getElementID('CustomSearch')) {
		var parentC = NA.common.doc.querySelector('ul.dropdown-menu.search');
		lastLi = NA.common.doc.createElement('li'),
		lastLi_a = NA.common.doc.createElement('a');
		lastLi_a.setAttribute('id', 'custSearch');
		lastLi_a.textContent = 'CustomSearch';
		lastLi.appendChild(lastLi_a);
		parentC.appendChild(lastLi);
	}
	//=================add Dynamic Styles=============================
	NA.common.loadStyles("../../../static/app/content/jquery-ui.min.css", "jqueryUI");
	NA.common.loadStyles("../../../static/app/content/ui.jqgrid.css", "UIJqueryGrid");


	var doc = doc || window.document;
	var DivSearch = doc.querySelector('ul.dropdown-menu.search');//return list Element
	(function (elm) {
		var listElem = elm.children;
		var datePlaceHolder = 'yyyy-mm-dd or mm/dd/yyyy';
		var numPlaceHolder = 'enter numeric type';
		var boolPlaceHolder = 'true/false/1/0';
		Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array
			NA.NAEvent.addHandler(item, 'click', function (event) {
				event.preventDefault();
				if (item.firstChild.id === 'custSearch') {
					//=========='show dialog search'==================
					NA.common.dialog.createSearchDialog(event)
					txtSearchMaster.setAttribute('disabled', true);
					txtSearchMaster.setAttribute('placeholder', '');
					txtSearchMaster.value = '';
					btnSearchMaster.setAttribute('disabled', true)
				}
				else {
					txtSearchMaster.removeAttribute('disabled');
					btnSearchMaster.removeAttribute('disabled');
					var textSearch = NA.common.getElementID('bySearch');
					textSearch.firstChild.nodeValue = item.textContent;
					var elSearch = item.firstChild;
					switch (elSearch.dataset.tipe) {
						case "varchar":
						case "nchar":
						case "char":
						case "nvarchar": {
							txtSearchMaster.setAttribute('placeholder', defPlaceHolder);
							break;
						}
						case "boolean": {
							txtSearchMaster.setAttribute('placeholder', boolPlaceHolder);
							break;
						}
						case "int":
						case "integer":
						case "decimal":
						case "floatt":
						case "bigint": {
							txtSearchMaster.setAttribute('placeholder', numPlaceHolder);
							break;
						}
						case "datetime": {
							txtSearchMaster.setAttribute('placeholder', datePlaceHolder);
							break;
						}
					}
				}
				//event.stopImmediatePropagation();
			});
		});

		NA.NAEvent.addHandler(txtSearchMaster, 'blur', function (e) {
			//get textcontent IDbySearch
			//looping dropdown li a textContent
			var SearchByText = NA.common.getElementID('bySearch').textContent;
			var elSearch = null;
			Array.prototype.forEach.call(listElem, function (item) {
				if (item.firstChild.text == SearchByText) {
					elSearch = item.firstChild;
					return;
				}
			});
			if (!elSearch) {
				if (this.value === '') {
					if (this.getAttribute('placeholder') !== defPlaceHolder) {
						this.setAttribute('placeholder', defPlaceHolder);
					}
				}
				e.stopImmediatePropagation();
			}
			else {
				switch (elSearch.dataset.tipe) {
					case "varchar":
					case "nchar":
					case "char":
					case "nvarchar": {
						if (this.value === '') {
							if (this.getAttribute('placeholder') !== defPlaceHolder) {
								this.setAttribute('placeholder', defPlaceHolder);
							}
						}
						e.stopImmediatePropagation();
						break;
					}
					case "int":
					case "integer":
					case "decimal":
					case "floatt":
					case "bigint": {
						if (this.value === '') {
							if (this.getAttribute('placeholder') !== numPlaceHolder) {
								this.setAttribute('placeholder', numPlaceHolder);
							}
						}
						e.stopImmediatePropagation();
						break;
					}
					case "datetime": {
						if (this.value === '') {
							if (this.getAttribute('placeholder') !== datePlaceHolder) {
								this.setAttribute('placeholder', datePlaceHolder);
							}
						}
						e.stopImmediatePropagation();
						break;
					}
				}
			}  
		});
		NA.NAEvent.addHandler(txtSearchMaster, 'focus', function (e) {
			if (this.value === '') {
				if (this.getAttribute('placeholder') !== '') {
					this.setAttribute('placeholder', '');
				}
			}
		});
	})(DivSearch);
})();
</script>
<!--SETUP Jquery grid-->
<!-- The jQuery library is a prerequisite for all jqSuite products -->
<script>window.jQuery || NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/jquery\-1\.11\.1\.js\"\>\<\/script\>');</script>

<!-- This is the localization file of the grid controlling messages, labels, etc. -->
<!-- We support more than 40 localizations -->
<script src="../../../static/app/scripts/grid.locale-en.js"></script>

<!-- This is the Javascript file of jqGrid -->
<script src="../../../static/app/scripts/jquery.jqGrid.min.js"></script>

<!--var head = NA.common.doc.getElementsByTagName("header")[0];
NA.common.loadScript('//cdn.rawgit.com/bpampuch/pdfmake/0.1.26/build/pdfmake.min.js',head,'pdfMakeID');
NA.common.loadScript('//cdn.rawgit.com/bpampuch/pdfmake/0.1.26/build/vfs_fonts.js',head,'pdfMakeFontID');
-->

<!----------------------------Load Jquery UI. JS file-------------------------------->
<script src="../../../static/app/scripts/jquery-ui.js"></script>
<!----------------------------Script for /Printing/Exporting to PDF-------------------------------------------------------->
<script src="../../../static/app/scripts/printThis.js"></script>
<!----------------------------Script for /Printing/Exporting to Excel -------------------------------------------------------->
<script src="../../../static/app/scripts/jszip.min.js "></script>
<script type="text/javascript">if (typeof $.fn.modal == 'undefined') { NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/bootstrap\.js\"\>\<\/script\>'); }</script>
<script src="../../../static/app/scripts/bootstrap-dialog.js"></script>
{% endblock %}

{%block content-0 %}
<style>
    div#content-0 {
        overflow: hidden;
    }
    div#gbox_jqGrid_NA_F_Goods_Outwards, div#gview_jqGrid_NA_F_Goods_Outwards, div#jqGrid_NA_F_Goods_Outwards_Pager, div.ui-jqgrid-titlebar {
        border-radius: 0px;
	}
		div.modal-dialog modal-lg>div.modal-content{
			height: 620px;
		}
	/** iframe.fullScreen { 
    /*width: 100%;
	/*height: 100%;
	/*	position:absolute;
	/*top:0;left:0;z-index:100;
	}
	*/ 
    /**.overlay {
      position: fixed;
      top: 0;
      bottom: 0;
      right: 0;
      left: 0;
      z-index: 1;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, .3);
      display: none;
      cursor: pointer;
	}
	*/
</style>
<table id="jqGrid_NA_F_Goods_Outwards" style="overflow:auto"></table>
<div id="jqGrid_NA_F_Goods_Outwards_Pager" class="scroll" style="text-align:center;"></div>

{% endblock %}

{% block DialogEntry %}
<script type="text/javascript">
	(function () {
		//========================Variable Object untuk ===============================
		var win = win || window,
        grid = $("#jqGrid_NA_F_Goods_Outwards"),
        txtSearchMaster = NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
        btnSearchMaster = NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default'),
        csrftoken = function () { return NA.CookieUtil.get('csrftoken'); },
        //TypeApps = [],
        //settings btn sesuai user access
        //anggap saja sekarang admin
        btnSave = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(4)'),
        btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)'),
        btnExport = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(6)'),
        btnHelp = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(8)'),
        btnPrint = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(7)'),
        containerMenu = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav'),//inistialisasi menu 
        originalData = {};
		//=================================AJAX Setup pake jquery===========================-->
		$.ajaxSetup({
			cache: false,
			error: function (xhr, status, error) {
				try {
					var messageErr = xhr.responseText;
					var contentype = xhr.getResponseHeader('Content-Type')
					if (contentype === 'application/json') {
						messageErr = $.parseJSON(xhr.responseText);
					}
					var message = xhr.responseText;
					if (messageErr) {
						message = messageErr.message;
					}
					if (message) {
						ShowAlert('An error occurred: ' + error + '\n' + xhr.status + ": " + message);
					}

				} catch (e) {
					ShowAlert('An error occurred: ' + error + '\n' + xhr.status + ": " + e.message);
				}
				window.document.body.style.cursor = 'defautl'; return false;
			},
			timeout: 2000000, // Timeout// nanti kalau sudah selesai system timeout ini harus di rubah, jadi maximal 20 detik
			type: 'GET',
			crossDomain: false, // obviates need for sameOrigin test                              
		});

		//===================================END AJAX SetuP===========================--> 
		//csrf token untuk form
		function csrfSafeMethod(method) {
			// these HTTP methods do not require CSRF protection
			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		};
		$.ajaxPrefilter(function (options) {
			// Always add "?debug=1" to every URL
			options.beforeSend = function (xhr, settings) {
				if (!csrfSafeMethod(settings.type)) {
					xhr.setRequestHeader("X-CSRFToken", csrftoken());
				}
			}
		});
		
		var SearchData = NA.common.SearchData;
		SearchData.setDefaultSearchData('goods', 'varchar', 'like');
		var url = 'NA_Goods_Outwards_Search/?' + win.encodeURIComponent('columnName') + '=' + win.encodeURIComponent(NA.common.SearchData.getColumnKey()) +
        '&' + win.encodeURIComponent('valueKey') + '=' + win.encodeURIComponent(NA.common.SearchData.getValueKey()) +
        '&' + win.encodeURIComponent('dataType') + '=' + win.encodeURIComponent(NA.common.SearchData.getDataType()) +
        '&' + win.encodeURIComponent('criteria') + '=' + win.encodeURIComponent(NA.common.SearchData.getCriteria());
		//Load Data grid
		function LoadData(page) {
			var url = 'NA_Goods_Outwards_Search/?' + win.encodeURIComponent('columnName') + '=' + win.encodeURIComponent(NA.common.SearchData.getColumnKey()) +
						'&' + win.encodeURIComponent('valueKey') + '=' + win.encodeURIComponent(NA.common.SearchData.getValueKey()) +
						'&' + win.encodeURIComponent('dataType') + '=' + win.encodeURIComponent(NA.common.SearchData.getDataType()) +
						'&' + win.encodeURIComponent('criteria') + '=' + win.encodeURIComponent(NA.common.SearchData.getCriteria());
			if (arguments.length > 0) {
				grid.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
			}
			else {
				try {
					//			#column idapp,NO,goods,goodstype,serialnumber,daterequest,datereleased,isnew,fk_employee,for_employee,fk_usedemployee,eks_employee,
					//#fk_responsibleperson,responsible_by,fk_sender,senderby,fk_stock,refgoodsfrom,descriptions,createdby,createddate
					grid.jqGrid({
						url: url,
						mtype: "GET",
						datatype: "json",
						colNames: ['idapp', 'NO', 'Goods Name', 'Type', 'Serial Number', 'Date Request', 'Date Released', 'Is New', 'fk_employee', 'For Employee',
							'fk_usedemployee', 'Eks Employee', 'fk_responsibleperson', 'Responsible By', 'fk_sender', 'Employee Sender', 'fk_stock', 'Ref Goods From','Equipment', 'Descriptions', 'Created Date', 'Created By'],
						colModel: [
							{ name: 'idapp', key: true, hidden: true, align: 'left' },
                            { name: 'NO', width: 40, align: 'right', sortable: false, editable: false, },
							{ name: 'goods', width: 100, index: 'goods', align: 'left', sortable: true, editable: false, },
                            { name: 'goodstype', index: 'goodstype', width: 80, sortable: true, editable: false, align: 'left', },
                            { name: 'serialnumber', index: 'serialnumber', sortable: true, editable: false, align: 'left', },
							{ name: 'daterequest', index: 'daterequest', sortable: true, editable: false, width: 110, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
							{ name: 'datereleased', index: 'datereleased', sortable: true, editable: false, width: 110, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
							{ name: 'isnew', index: 'isnew', sortable: true, width: 50, align: 'center', editable: false, formatter: 'checkbox', formatoptions: { readonly: true } },
							{ name: 'fk_employee', index: 'fk_employee', hidden: true, },
							{ name: 'for_employee', index: 'for_employee', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'fk_usedemployee', index: 'fk_usedemployee', hidden: true, },
							{ name: 'eks_employee', index: 'eks_employee', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'fk_responsibleperson', index: 'fk_responsibleperson', hidden: true, },
							{ name: 'responsible_by', index: 'responsible_by', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'fk_sender', index: 'fk_sender', hidden: true, },
							{ name: 'senderby', index: 'senderby', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'fk_stock', index: 'fk_stock', hidden: true, },
							{ name: 'refgoodsfrom', index: 'refgoodsfrom', width: 130, sortable: true, editable: false, align: 'left', },
							{name: 'equipment_desc',index:'equipment_desc',width:150,sortable:true,editable:false,align:'left'},
							{ name: 'descriptions', index: 'descriptions', width: 140, sortable: true, editable: false, align: 'left', },
                            { name: 'createddate', index: 'createddate', sortable: true, editable: false, width: 110, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'createdby', index: 'createdby', sortable: true, width: 110, editable: false, },
						],
						ondblClickRow: function (rowId) {
							var btnOpen = NA.common.doc.querySelector('ul.nav.navbar-nav>li:nth-child(2)>button');
							if (btnOpen) {
								btnOpen.click();
							}
						},
						gridComplete: function () {
							document.body.style.cursor = 'default';
						},
						loadError: function (xhr, st, err) {
							win.document.body.style.cursor = 'default'; XhrError(xhr);
						},

						//cellEdit: false,
						height: $('div.fltlft').height() - ($('div.fltlft').height() * 0.173),
						rowNum: 300,
						rowList: [20, 50, 100, 200, 300, 500],
						sortname: "idapp",
						sortorder: "desc",
						multiSort: true,
						shrinkToFit: false,
						iconSet: "fontAwesome",
						forceFit: true,
						toolbar: true,
						scrollrows: true,
						hidegrid: true,
						caption: "Transactions ---Goods Outwards",
						pager: "#jqGrid_NA_F_Goods_Outwards_Pager"
					});
					grid.navGrid("#jqGrid_NA_F_Goods_Outwards_Pager", {
						search: false, // show search button on the toolbar
						add: false,
						edit: false,
						del: false,
						refresh: true
					});

				} catch (e) {
					ShowAlert(e.message);
					console.log(e);
					win.document.body.style.cursor = 'default';
				}
				$("div#gbox_jqGrid_NA_F_Goods_Outwards, div#gview_jqGrid_NA_F_Goods_Outwards, div.ui-jqgrid-bdiv, div.ui-jqgrid-hdiv").css({
					'width': 'inherit'
				})
			}		
		};

		LoadData();

		NA.common.doc.title = 'Entry Data Goods Outwards';
		//disablekan save dan help karena saat ini tidak di pakai
		btnSave.setAttribute('disable', true);
		btnHelp.setAttribute('disable', true);
		NA.common.loadStyles("../../../static/app/content/Dialog.css", "DialogEntryStyle");//Load Style buat dialog sebelum di pakai
		NA.common.loadStyles("../../../static/app/content/NA_commonEntry.css", "CommonEntry");//Load Style buat form sebelum di pakai
		NA.common.dialog.initDialog(containerMenu, 'Nufarm Entry Goods Outwards - Transactions');//inistialisasi menu

		//==========================GROUP Function Declaration================================
		function GetServerFormatDate(parsedDate) {//dd/mm/yy value -->yyyy-mm-dd
			var d = new Date(parsedDate),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

			if (month.length < 2) month = '0' + month;
			if (day.length < 2) day = '0' + day;

			return [year, month, day].join('-');
		};
		function formatDate(theDate) {//date/month/year
			var date = new Date(theDate),
              year = date.getFullYear(),
              month = (date.getMonth() + 1).toString(),
              formatedMonth = (month.length === 1) ? ("0" + month) : month,
              day = date.getDate().toString(),
              formatedDay = (day.length === 1) ? ("0" + day) : day;
			return formatedDay + "/" + formatedMonth + "/" + year //+ " " + formatedHour + ':' + formatedMinute + ':' + formatedSecond;
		};

		function getGridCellValue(thegrid, CeltoGet) {
			var reccount = thegrid.jqGrid('getGridParam', 'reccount');
			var rowId, rowData, colData;
			if (reccount > 0) {
				rowId = thegrid.jqGrid('getGridParam', 'selrow');
				if (rowId) {
					rowData = thegrid.getRowData(rowId);
					colData = rowData[CeltoGet];
				}
			}
			return colData;
		};
		function showConfirmation(message, title, callbackYess, calBackNO) {
			BootstrapDialog.confirm({
				title: title || NA.common.message.titleInfo,
				message: message,
				type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
				size: BootstrapDialog.SIZE_SMALL,
				animate: false,
				cssClass: 'login-dialog',
				closeByBackdrop: false,
				closeByKeyboard: false,
				closable: false, // <-- Default value is false
				draggable: true, // <-- Default value is false
				btnCancelLabel: 'NO.', // <-- Default value is 'Cancel',
				btnOKLabel: 'Yes.', // <-- Default value is 'OK',
				btnOKClass: 'btn-success', // <-- If you didn't specify it, dialog type will be used,
				callback: function (result) {
					// result will be true if button was click, while it will be false if users close the dialog directly.
					if (result) {
						if (callbackYess) {
							callbackYess();
						}
						return true;
					}
					else {
						if (calBackNO) {
							calBackNO();
						}
					}
				},
				onshown: function (dialogRef) {
					NA.common.doc.querySelector('div.bootstrap-dialog-footer-buttons button.btn.btn-success').focus();
				}
			});
		};
		function ShowAlert(message, title, callbackFunc, calbackOnHide) {
			return BootstrapDialog.alert({
				title: title || NA.common.message.titleInfo,
				message: message,
				size: (message.length > 200) ? BootstrapDialog.SIZE_NORMAL : BootstrapDialog.SIZE_SMALL,
				//animate:false,
				cssClass: 'login-dialog',
				closeByBackdrop: false,
				closeByKeyboard: false,
				type: BootstrapDialog.TYPE_INFO, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
				closable: false, // <-- Default value is false
				draggable: true, // <-- Default value is false
				buttonLabel: 'OK', // <-- Default value is 'OK',
				callback: function (result) {
					// result will be true if button was click, while it will be false if users close the dialog directly.
					if (result) {
						if (callbackFunc) {
							callbackFunc();
						}
						return true;
					}
				},
				onhidden: function (dialogRef) {
					if (calbackOnHide) {
						calbackOnHide();
					}
				}
			});
		};
		function XhrError(xhr) {
			try {
				var messageErr = xhr.responseText;
				var contentype = xhr.getResponseHeader('Content-Type')
				if (contentype === 'application/json') {
					messageErr = JSON.parse(xhr.responseText);
				}
				var message = xhr.responseText;
				if (messageErr) {
					message = messageErr.message;
					if (message.indexOf('\!DOCTYPE html') > 0) {
						//error bawaan dari python django
						//redirect to error web
						//untuk sekarang tampilkan saja error codenya saja
						ShowAlert('Unknown Server error occurred: ' + '\nstatus = ' + xhr.status.toString() + '\nPlease tell system administrator');
						document.body.style.cursor = 'default';
						return false;
					}
					else if (xhr.status >= 500) {
						ShowAlert('Unknown Server error occurred: ' + '\n' + message + '\nstatus = ' + xhr.status.toString() + '\nPlease tell system administrator');
						document.body.style.cursor = 'default';
						return false;
					}
					else if (message) {
						ShowAlert('An error occurred: ' + message);
					}
					else {
						ShowAlert('An error occurred: ' + messageErr);
					}
				}
				else if (message) {
					ShowAlert('An error occurred: ' + message);
				}
				document.body.style.cursor = 'default';
			} catch (e) {
				ShowAlert('An error occurred: ' + e + '\n' + e.message);
				document.body.style.cursor = 'default';
			}
			return false;
		};
		function EraseElHidden() {
			var UlHiddenAuto = NA.common.doc.querySelector('ul.ui-menu.ui-widget.ui-widget-content.ui-autocomplete.ui-front');
			var divAutoComplete = NA.common.doc.querySelector('div.ui-helper-hidden-accessible');
			if (UlHiddenAuto) { UlHiddenAuto.parentNode.removeChild(UlHiddenAuto); }
			if (divAutoComplete) { divAutoComplete.parentNode.removeChild(divAutoComplete); }
		};
		function ExecuteHandler(textElement) {
			if (win.document.body.style.cursor != 'wait') { win.document.body.style.cursor = 'wait'; }
			var frmEntry = NA.common.getElementID('frm-NA-Entry-Goods-Outwards');
			var retval = false;
			//cek validity.valid id_daterequest
			//cek validity.valid id_datereleased
			var elDateReq = NA.common.getElementID('id_daterequest');
			var elDateRel = NA.common.getElementID('id_datereleased');
			var validDate = true;
			if (!elDateReq.validity.valid) {
				validDate = false;
			}
			else if (!elDateRel.validity.valid) {
				validDate = false;
			}
			if (!validDate) {
				var valid = false;
				var elpat = elDateReq.getAttribute('patern');
				var patern = new RegExp(elpat, 'i');
				var valuePatReq = elDateReq.value;
				if (valuePatReq === null || valuePatReq === '') {
					valuePatReq = elDateReq.textContent;
				}
				if (patern.test(valuePatReq)) {
					elDateReq.setCustomValidity('');
					elDateReq.validity.valid = true;
					valid = true;
				}
				if (valid) {
					elpat = elDateRel.getAttribute('patern');
					var valuePatRel = elDateRel.value;
					if (valuePatRel === null || valuePatRel === '') {
						valuePatRel = elDateRel.textContent;
					}
					if (patern.test(valuePatRel)) {
						elDateRel.setCustomValidity('');
						elDateRel.validity.valid = true;
						valid = true;
					}
				}
				validDate = valid;
			}

			switch (textElement) {
				case 'OK': {
					if (!frmEntry.checkValidity()) {
						//NA.NAEvent.preventDefault(event); 
						if (validDate) {
							var inputbtn = NA.common.getElementID('inputButton');
							inputbtn.click();
						}
					}
					else {
						//check exists
						//barang dan serial number dan lenddate
						var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods');
						var elserialnumber = NA.common.getElementID('id_serialnumber');
						var fk_employee = NA.common.getElementID('id_idapp_fk_employee').value;
						dateRequest = GetServerFormatDate($.datepicker.parseDate('dd/mm/yy', elDateReq.value));
						dateReleased = GetServerFormatDate($.datepicker.parseDate('dd/mm/yy', elDateRel.value));
						var NAAjax = NA.common.AJAX;
						if (win.status === 'Add') {
							NAAjax.POST('HasExists/',
                                JSON.stringify({ 'idapp_fk_goods': elidapp_fk_goods.value, 'daterequest': dateRequest, 'datereleased': dateReleased, 'serialnumber': elserialnumber.value, 'fk_employee': fk_employee }),
                                'application/x-www-form-urlencoded', 'application/json',
                                function () {
                                	window.document.body.style.cursor = 'wait';
                                }, null,
                                function () {
                                	if (this.status === 200) {
                                		var confirmText = JSON.parse(this.responseText);
                                		if (confirmText) {
                                			confirmText = confirmText.message;
											if (!confirmText) {
                                				ShowAlert('unknown error', 'uncaught error'); win.document.body.style.cursor = 'default'; throw Error('');
                                			}
                                		}
                                		else {
                                			win.document.body.style.cursor = 'default'; XhrError(NAAjax.XHR); throw Error('');
                                		}
                                		if (confirmText === 'OK') {
                                			win.document.body.style.cursor = 'wait';
                                			valuesForm = getValuesForm();
                                			submitForm(valuesForm);
                                			win.document.body.style.cursor = 'default';
                                		}
                                		else {//ada confirmasi data yang mungkin sama, tapi inputan terserah user
                                			return showConfirmation(confirmText, NA.common.message.confirmInfo, function () {
                                				win.document.body.style.cursor = 'wait';
                                				valuesForm = getValuesForm();
                                				submitForm(valuesForm);
                                				win.document.body.style.cursor = 'default';
                                			});
                                		}
                                	}
                                	else {
                                		XhrError(NAAjax.XHR); win.document.body.style.cursor = 'default'; throw new Error('');
                                	}
                                }, null, function () { XhrError(NAAjax.XHR); win.document.body.style.cursor = 'default'; throw new Error(''); },
                                function () { win.document.body.style.cursor = 'default'; }
                            );
						}
						else if (win.status == 'Edit') {
							win.document.body.style.cursor = 'wait';
							valuesForm = getValuesForm();
							submitForm(valuesForm);
							win.document.body.style.cursor = 'default';
						}
					}
					break;
				}
				case 'Cancel':
				case 'Close': {
					if (win.status != 'Open') {
						var valuesForm = getValuesForm(); var retval = false;
						if (NA.common.detectInputChanges(valuesForm, JSON.parse(originalData))) {
							showConfirmation(NA.common.message.dataHasChanged, 'Confirmation', function () {
								if (!frmEntry.checkValidity()) {
									var inputbtn = NA.common.getElementID('inputButton');
									inputbtn.click();
								}
								else {
									submitForm(valuesForm);
								}
								win.document.body.style.cursor = 'default';
							}, function () {
								closeDialog();
								win.document.body.style.cursor = 'default';
							});
						}
						else {
							closeDialog();
						}
					} else {
						closeDialog(); win.document.body.style.cursor = 'default';
					}
					break;
				}
			};
		};
		function disabledAllEntry(){
			var elements = NA.common.doc.querySelectorAll("#frm-NA-Entry-Goods-Outwards input[type='text'],textarea,button.btn.btn-success");
			for (var i = 0, element; element = elements[i++];) {
				if (!element.getAttribute('disabled')){
					element.setAttribute('disabled',true);
				}					
			}
		};
		function EnabledAllEntry() {
			var elements = NA.common.doc.querySelectorAll("#frm-NA-Entry-Goods-Outwards input[type='text'],textarea,button.btn.btn-success");
			for (var i = 0, element; element = elements[i++];) {
				if (element.getAttribute('disabled')) {
					element.removeAttribute('disabled');
				}
			}
		};
		function submitForm(valuesForm) {
			valuesForm['csrfmiddlewaretoken'] = (function () {
				var el = document.getElementsByName("csrfmiddlewaretoken");
				return el[0].getAttribute("value");
			})();
			var FDate = $('#id_daterequest').val(); FDate = $.datepicker.parseDate('dd/mm/yy', FDate);
			CDate = GetServerFormatDate(FDate);
			valuesForm['daterequest'] = CDate;

			FDate = $('#id_datereleased').val(); FDate = $.datepicker.parseDate('dd/mm/yy', FDate);
			CDate = GetServerFormatDate(FDate);
			valuesForm['datereleased'] = CDate;
			var NAAjax = NA.common.AJAX;
			//POST: function (url, data, dataType, MIMEType, OnAJAXStart, OnBeforeSend, OnLoad, OnProgress, OnError, OnLoadEnd, customRequestHeader) {
			NAAjax.POST('ShowEntry_Outwards', JSON.stringify(valuesForm), 'application/x-www-form-urlencoded', 'application/json',
				function () {
					win.document.body.style.cursor = 'wait';
				},
				null,
				function (e) {
					var Data = JSON.parse(this.responseText);
					if (Data.message === "success" || parseInt(Data.message) > 0) {
						SuccesTrans = true;
						switch (win.status) {
							case 'Add': {
								//update IDApp Value
								var elidapp = NA.common.getElementID('id_idapp');
								elidapp.value = Data.message;
								win.document.body.style.cursor = 'wait';
								grid.trigger("reloadGrid", [{ page: 1 }]);
								//disabled kan form entry
								disabledAllEntry();
								//Save state to window
								NA.common.dialog.hasSavedAction = true;
								originalData = JSON.stringify(getValuesForm());
								if (NA.common.dialog.hasOwnProperty('IsPrintingPDF')){
									if(NA.common.dialog.IsPrintingPDF){
										printToPDF();
									}
								}
								win.document.body.style.cursor = 'default';
								break;
							}
							case 'Edit': {
								win.document.body.style.cursor = 'wait';
								if (NA.common.dialog.hasOwnProperty('IsPrintingPDF')) {
									if (NA.common.dialog.IsPrintingPDF) {
										printToPDF();
									}
								}
								if (NA.common.dialog.hasOwnProperty('mustCloseDialog')) {
									if (NA.common.dialog.mustCloseDialog ) {
										closeDialog();
									}
								}
								grid.trigger("reloadGrid", [{ page: 1 }]);
								win.document.body.style.cursor = 'default';
								break;					
							}
						}
						//reloadJquery$("#jqGrid_NA_F_Goods").trigger("reloadGrid", [{ page: 1 }]);
					}
					else {//error berarti
						XhrError(NAAjax.XHR); win.document.body.style.cursor = 'default'; throw new Error('');
					}
					win.document.body.style.cursor = 'default';
				}, null,
				function (e) { XhrError(NAAjax.XHR); win.document.body.style.cursor = 'default'; throw new Error(''); },
				function (e) {
					win.document.body.style.cursor = 'default';
				});
		};
		function clearEntry() {
			//idapp,fk_goods,isnew,goods,idapp_fk_goods,fk_employee,idapp_fk_employee,fk_employee_employee,daterequest,datereleased,
			//fk_responsibleperson,idapp_fk_responsibleperson,fk_responsibleperson_employee,fk_sender,idapp_fk_sender,fk_sender_employee,equipment_desc,descriptions,
			//lastinfo,serialnumber,fk_frommaintenance,fk_return,fk_lending,
			//fk_receive
			var elidapp = NA.common.getElementID('id_idapp');
			elidapp.value = originalData.idapp || null;
			var elfk_goods = NA.common.getElementID('fk_goodsValue');
			elfk_goods.textContent = originalData.fk_goods || '';
			var elisnew = NA.common.getElementID('id_isnew');
			elisnew.value = originalData.isnew || false;
			//goods tidak usah
			var elgoods = NA.common.getElementID('id_goods');
			elgoods.value = '';
			var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods');
			elidapp_fk_goods.value = originalData.idapp_fk_goods;
			var elfk_employee = NA.common.getElementID('id_fk_employee');
			elfk_employee.value = originalData.fk_employee || '';
			var elidapp_fk_employee = NA.common.getElementID('id_idapp_fk_employee');
			elidapp_fk_employee.value = originalData.idapp_fk_employee;
			//fk_employee_employee nggak usah
			var elfk_employee_employee = NA.common.getElementID('id_fk_employee_employee');
			elfk_employee_employee.value = originalData.fk_employee_employee || '';
			var eldaterequest = NA.common.getElementID('id_daterequest');
			eldaterequest.value = originalData.daterequest || '';
			//fk_stock gak usah, fk_stock diambil bersamaan di bussinesrules query
			var eldatereleased = NA.common.getElementID('id_datereleased');
			eldatereleased.value = originalData.datereleased || '';

			var elfk_responsibleperson = NA.common.getElementID('id_fk_responsibleperson');
			elfk_responsibleperson.value = originalData.fk_responsibleperson || '';

			var elfk_responsiblepersonEmpl = NA.common.getElementID('id_fk_responsibleperson_employee');
			elfk_responsiblepersonEmpl.value = originalData.fk_responsibleperson_employee || '';

			var elidapp_fk_responsibleperson = NA.common.getElementID('id_idapp_fk_responsibleperson');
			elidapp_fk_responsibleperson.value = originalData.idapp_fk_responsibleperson||null;

			var elfk_sender = NA.common.getElementID('id_fk_sender');
			elfk_sender.value = originalData.fk_sender || '';
			var elidapp_fk_sender = NA.common.getElementID('id_idapp_fk_sender');
			elidapp_fk_sender.value = originalData.fk_sender||null;
			var elfk_sender_employee = NA.common.getElementID('id_fk_sender_employee');
			elfk_sender_employee.value = originalData.fk_sender_employee || '';

			//interests, fk_sender, idapp_fk_sender, fk_sender_employee, statuslent, descriptions, typeapp, serialnumber,
			//brandvalue, fk_maintenance, fk_return, fk_currentapp, fk_receive, fk_disposal, fk_lost, lastinfo, initializeForm, hasRefData
			//fk_sender_employee nggak usah

			//equipment desc
			var equipDesc = NA.common.getElementID('id_equipment_desc');
			equipDesc.value = originalData.equipment_desc||'';
			var eldescriptions = NA.common.getElementID('id_descriptions');
			eldescriptions.value = originalData.descriptions || '';
			var eltypeapp = NA.common.getElementID('TypeValue');
			eltypeapp.textContent = originalData.typeapp || '';
			var elserialnumber = NA.common.getElementID('id_serialnumber');
			elserialnumber.value = originalData.serialnumber || '';
			//brandvalue nggak usah
			var elbrandvalue = NA.common.getElementID('BrandValue');
			elbrandvalue.textContent = '';

			var elfk_frommaintenance = NA.common.getElementID('id_fk_frommaintenance');
			elfk_frommaintenance.value = originalData.fk_frommaintenance||null;

			var elfk_return = NA.common.getElementID('id_fk_return');
			elfk_return.value = originalData.fk_return||null;
			var elfk_lending = NA.common.getElementID('id_fk_lending');
			elfk_lending.value = originalData.fk_lending||null;
			var elfk_receive = NA.common.getElementID('id_fk_receive');
			elfk_receive.value = originalData.fK_receive||null;

			var ellastUsedInfo = NA.common.getElementID('lastUsedInfo'),
			lastUsedInfo = ellastUsedInfo.textContent
			//var elfk_lost = NA.common.getElementID('id_fk_lost');
			//elfk_lost.value = originalData.fk_lost;
			var ellastinfo = NA.common.getElementID('LastInfoValue');
			ellastinfo.textContent = '';
			NA.common.getElementID('difInfo').style.display = 'none';

		};
		function getValuesForm() {
			var elidapp = NA.common.getElementID('id_idapp'),
			idapp = elidapp.value;
			var elfk_goods = NA.common.getElementID('fk_goodsValue'),
                fk_goods = elfk_goods.textContent;
			var elisnew = NA.common.getElementID('id_isnew'),
				isnew = elisnew.value;
			//goods tidak usah
			var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods'),
				idapp_fk_goods = elidapp_fk_goods.value;
			var elfk_employee = NA.common.getElementID('id_fk_employee'),
				fk_employee = elfk_employee.value;
			var elidapp_fk_employee = NA.common.getElementID('id_idapp_fk_employee'),
				idapp_fk_employee = elidapp_fk_employee.value;
			//fk_employee_employee nggak usah
			var eldaterequest = NA.common.getElementID('id_daterequest'),
				daterequest = eldaterequest.value;
			var eldatereleased = NA.common.getElementID('id_datereleased'),
				datereleased = eldatereleased.value;
			//fk_stock gak usah, fk_stock diambil bersamaan di bussinesrules query
			var elfk_responsibleperson = NA.common.getElementID('id_fk_responsibleperson'),
				fk_responsibleperson = elfk_responsibleperson.value;
			var elidapp_fk_responsibleperson = NA.common.getElementID('id_idapp_fk_responsibleperson'),
				idapp_fk_responsibleperson = elidapp_fk_responsibleperson.value;
			//fk_responsibleperson_employee nggak usah
			var elfk_sender = NA.common.getElementID('id_fk_sender'),
				fk_sender = elfk_sender.value;
			var elidapp_fk_sender = NA.common.getElementID('id_idapp_fk_sender'),
				idapp_fk_sender = elidapp_fk_sender.value;
			var elEquipDesc = NA.common.getElementID('id_equipment_desc'),
				equipDesc = elEquipDesc.value;
			var eldescriptions = NA.common.getElementID('id_descriptions'),
				descriptions = eldescriptions.value;
			var eltypeapp = NA.common.getElementID('TypeValue'),
               typeapp = eltypeapp.textContent;
			var elserialnumber = NA.common.getElementID('id_serialnumber'),
            serialnumber = elserialnumber.value;
			//brandvalue nggak usah
			var elfk_frommaintenance = NA.common.getElementID('id_fk_frommaintenance'),
                fk_frommaintenance = elfk_frommaintenance.value||0;
			var elfk_return = NA.common.getElementID('id_fk_return'),
                fk_return = elfk_return.value||0;
			var elfk_lending = NA.common.getElementID('id_fk_lending'),
                fk_lending = elfk_lending.value||0;
			var elfk_receive = NA.common.getElementID('id_fk_receive'),
                fk_receive = elfk_receive.value||0;
			//var elfk_disposal = NA.common.getElementID('id_fk_disposal'),
			//    fk_disposal = elfk_disposal.value;
			//var elfk_lost = NA.common.getElementID('id_fk_lost'),
			//    fk_lost = elfk_lost.value;
			var ellastinfo = NA.common.getElementID('LastInfoValue'),
                lastinfo = ellastinfo.textContent
			var elfk_usedemployeeValue = NA.common.getElementID('id_idapp_fk_usedemployee')
			//UsedEmployee= elfk_usedemployeeValue.textContent.split('|') ;			
			var idapp_fk_usedemployee = elfk_usedemployeeValue.value||0;
			//if(UsedEmployee.length > 0){
			//	fk_usedemployee = UsedEmployee[0];
			//}
			//idapp,fk_goods,isnew,goods,idapp_fk_goods,fk_employee,idapp_fk_employee,daterequest,datereleased,
			//fk_responsibleperson,idapp_fk_responsibleperson,fk_responsibleperson_employee,fk_sender,idapp_fk_sender,fk_sender_employee,descriptions,
			//lastinfo,serialnumber,fk_frommaintenance,fk_return,fk_lending
			//fk_receive
			return {
				idapp: idapp, fk_goods: fk_goods, isnew: isnew, idapp_fk_goods: idapp_fk_goods, fk_employee: fk_employee, idapp_fk_employee: idapp_fk_employee,
				idapp_fk_usedemployee: idapp_fk_usedemployee,
				daterequest: daterequest, datereleased : datereleased,fk_responsibleperson: fk_responsibleperson, idapp_fk_responsibleperson: idapp_fk_responsibleperson,
				fk_sender: fk_sender, idapp_fk_sender: idapp_fk_sender,equipment_desc:equipDesc,descriptions: descriptions, typeapp: typeapp, serialnumber: serialnumber,
				fk_frommaintenance: fk_frommaintenance, fk_return: fk_return, fk_lending: fk_lending, fk_receive: fk_receive, lastinfo: lastinfo,
				status: win.status
			}
		};
		function closeDialog() {
			EraseElHidden();
			var dialog = dialog || NA.common.dialog.doc.querySelector("div.containerDialog");
			if (dialog) {
				NA.common.dialog.closeDialog(dialog);
			}
		};
		//function restyleBoostrapDialog() {
		//	var BSDialogContent = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content');
		//	BSDialogContent.style.cssText = 'width: 425px; height: 330px;';
		//	var ContentBody = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-body');
		//	ContentBody.style.cssText = 'padding:0px;';
		//	var contentFooter = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-footer');
		//	contentFooter.style.cssText = 'padding-bottom:0px;padding-top:0px;';
		//	var mHeader = NA.common.doc.querySelector('div.bootstrap-dialog .modal-header.bootstrap-dialog-draggable');
		//	mHeader.style.cssText = 'height:30px;padding:0px;';
		//	var footerButton = NA.common.doc.querySelector('div.bootstrap-dialog-footer-buttons');
		//	footerButton.style.cssText = 'padding-top:8px;';
		//};
		function fillGoodsInfo(rowData, serialnumber, IsFromTextBox) {
		    var containerDialog = NA.common.doc.querySelector('div.containerDialog');
		    var pkfrom = 'fk_return';
		    var pkkey = '';
		    var viewportSize = NA.common.dialog.getViewportSize();
		    containerDialog.style.maxHeight = viewportSize[1].toString() + 'px';
		    containerDialog.style.overflowY = 'auto';
		    containerDialog.style.overflowX = 'hidden';
		    //containerDialog.style.top = '0';
			 //form.idapp_fk_goods 
			 //form.fk_frommaintenance 
			 //form.fk_return 
			 //form.fk_lending 
			 //form.fk_receive 
			 //
			//form.idapp di status edit/open

			//  	form.idapp_fk_goods
			var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods');
			elidapp_fk_goods.value = rowData['idapp'] || null;//idapp di grid adalah idapp_fkgoods

			//    form.fk_frommaintenance 
			var elfk_maintenance = NA.common.getElementID('id_fk_frommaintenance');
			elfk_maintenance.value = rowData['fk_maintenance'] || null;
	
			//      form.fk_return 
			var elfk_return = NA.common.getElementID('id_fk_return');
			elfk_return.value = rowData['fk_return'] || null;

			//    form.fk_currentapp
			var elfk_lending = NA.common.getElementID('id_fk_lending');
			elfk_lending.value = rowData['fk_lending'] || null;
			if (elfk_maintenance.value) {
				pkfrom = 'fk_maintenance';
				pkkey = elfk_maintenance.value;
			}
			else if (elfk_return.value) {
				pkfrom = 'fk_return';
				pkkey = elfk_return.value;
			}
			else if (elfk_lending.value) {
				pkfrom = 'fk_lending';
				pkkey = elfk_return.value;
			}
			//     form.fk_receive 
			var elfk_receive = NA.common.getElementID('id_fk_receive');
			elfk_receive.value = rowData['fk_receive'] || null;

			if (elfk_receive.value) {
				if (parseInt(elfk_receive.value) > 0) {
					var elisNew = NA.common.getElementID('id_isnew');
					elisNew.value = true;
				}
			}
			//form.brandvalue
			var elbrandvalue = NA.common.getElementID('BrandValue');
			elbrandvalue.textContent = rowData['brandname'] || '';

			//form.typeapp
			var elTypeValue = NA.common.getElementID('TypeValue');
			elTypeValue.textContent = rowData['type'] || '';

			//form.fk_goods
			var elfk_goodsValue = NA.common.getElementID('fk_goodsValue');
			elfk_goodsValue.textContent = rowData['fk_goods'] || '';

			//lastInfoValue
			var ellastinfo = NA.common.getElementID('LastInfoValue');
			ellastinfo.textContent = rowData['lastinfo'] || '';

			//fk_usedemployee & fk_usedemployee_employee
			var elfk_usedemployeeValue = NA.common.getElementID('fk_usedemployeeValue');
			elfk_usedemployeeValue.textContent = rowData['fk_usedemployee'] + '|' + rowData['usedemployee'];

			////form.serialnumber
			//var elserialnumber = NA.common.getElementID('id_serialnumber');
			//elserialnumber.value = rowData['serialnumber'];
			//elserialnumber.attributes['placeholder'] = '';

			//form.goods
			var elgoods = NA.common.getElementID('id_goods');
			elgoods.value = rowData['goodsname'] || '';

			if (!serialnumber) {
				var elserialnumber = NA.common.getElementID('id_serialnumber');
				elserialnumber.value = rowData['serialnumber'] || '';
			}
			elgoods.attributes['placeholder'] = '';			
			if (IsFromTextBox) {
				NA.common.getElementID('lastUsedInfo').style.display = 'block';
			}
			else {
				if (rowData['fk_usedemployee']) {
					NA.common.getElementID('lastUsedInfo').style.display = 'block';
				}
				else {
					NA.common.getElementID('lastUsedInfo').style.display = 'none';
				}
			}
			NA.common.getElementID('difInfo').style.display = 'block';
			if (pkkey) {
				var NAAjax = NA.common.AJAX;
				var url = 'getLastDateTrans/?' + win.encodeURIComponent('pkkey') + '=' + win.encodeURIComponent(pkkey) + '&' + win.encodeURIComponent('pkfrom') + '=' + win.encodeURIComponent(pkfrom);
				NAAjax.GET(url,
                        'application/json',//overrideMimeType returned by the server
                        function () { window.document.body.style.cursor = 'wait'; },
                        null,//nggak usah di isi bila tidak perlu
                        function () {//function executed after data has been returned by server(XHR.onload)
                        	var data = JSON.parse(this.responseText);
                        	if (data && data.message) {
                        		$('#id_datereleased').datepicker({
                        			dateFormat: 'dd/mm/yy',
                        			changeMonth: true,
                        			changeYear: true,
                        			beforeShowDay: $.datepicker.noWeekends,
                        			minDate: (function (g) {
                        				return new Date(data);
                        			})(win),
                        			//maxDate: 0,
                        			//showOn: "button",
                        			//showButtonPanel: true,
                        			closeText: "Close",
                        			currentText: 'Now',
                        		});
                        	}
                        }, null, function () {//function untuk ajax error
                        	window.document.body.style.cursor = 'default'; XhrError(NAAjax.XHR);
                        }, function () { window.document.body.style.cursor = 'default'; },//function ajax complete
                        null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                        );

			}
		};
		function fillEmployeeName(event, elmID) {
			var NAAjax = NA.common.AJAX;
			var url = 'getEmployee/?' + win.encodeURIComponent('nik') + '=' + win.encodeURIComponent(event.target.value)
			NAAjax.GET(url,
                        'application/json',//overrideMimeType returned by the server
                        function () { window.document.body.style.cursor = 'wait'; },
                        null,//nggak usah di isi bila tidak perlu
                        function () {//function executed after data has been returned by server(XHR.onload)
                        	var data = JSON.parse(this.responseText);
                        	if (data) {
                        		var mainID = elmID.substring(3);
                        		//set employee_name
                        		var elempname = NA.common.getElementID('id_' + mainID + '_employee');
                        		var elidapp = NA.common.getElementID('id_idapp_' + mainID);
                        		//var elFKEmp = NA.common.getElementID('id_' + mainID);
                        		//elFKEmp.value = data['nik']||'';
                        		elempname.value = data['employee_name'] || '';
                        		elidapp.value = data['idapp'] || '';
                        	}
                        }, null, function () {//function untuk ajax error
                        	window.document.body.style.cursor = 'default'; XhrError(NAAjax.XHR);
                        }, function () { window.document.body.style.cursor = 'default'; },//function ajax complete
                        null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                        );
		};
		//==========================End GROUP Function Declaration================================

		//=======================GROUP FUNCTION EVENT=============================================
		function AddNew(event){
			EnabledAllEntry();
			//disablekan text button
			var listDisabled = NA.common.doc.querySelectorAll('input[id="id_goods"],[id="id_fk_employee_employee"],[id="id_fk_sender_employee"],[id="id_fk_responsibleperson_employee"]');			
			Array.prototype.forEach.call(listDisabled, function (item) {
				item.setAttribute('disabled',true)
			});
			clearEntry();
			originalData = JSON.stringify(getValuesForm());
			var initializeForm = NA.common.getElementID('id_initializeForm');
			initializeForm.value = originalData;
			//    //focus langsung ke 				    		
			var elserialnumber = NA.common.getElementID('id_serialnumber');
			elserialnumber.focus();
			NA.common.dialog.hasSavedAction = false;
			NA.common.dialog.mustCloseDialog = false;
			NA.common.dialog.IsPrintingPDF = false;
		}
		function handlerSearchInput(event) {
			event = NA.NAEvent.getEvent(event);
			if (event.keyCode === 13 || event.target == btnSearchMaster) {
				NA.NAEvent.preventDefault(event);
				var elSearch = NA.common.doc.querySelector('li.dropdown>a#bySearch'),
                SearchBy = NA.common.doc.querySelector('li.dropdown>a#bySearch').textContent.trim();
				if (SearchBy.trim() == 'By') {
					SearchData.setDefaultSearchData('goods', 'varchar', 'like');
					//var curPage = parseInt(grid.getGridParam('page'));
					window.document.body.style.cursor = 'wait';
					if (event.target.value !== '') {
						NA.common.SearchData.setValue(event.target.value);
					}
					LoadData(1);
				}
				else {
					//submit search
					submitSearch(event);
				}
				NA.NAEvent.stopPropagation(event);
			}
			window.document.body.style.cursor = '';
		};
		function PrintGrid() {
			// attach print container style and div to DOM.
			var gridID = $(".ui-jqgrid").attr("id")
			$('head').append('<style type="text/css">.prt-hide {display:none;}</style>');
			$('body').append('<div id="prt-container" class="prt-hide"></div>');


			// copy and append grid view to print div container.
			$('#gview_jqGrid_NA_F_Goods_Outwards').clone().appendTo('#prt-container').css({ 'page-break-after': 'auto' });

			// remove navigation divs.
			$('#prt-container div').remove('.ui-jqgrid-toppager,.ui-jqgrid-titlebar,.ui-jqgrid-pager');

			// print the contents of the print container.    
			$('#prt-container').printThis({
				removeScripts:true,
				header:'\<img src="..\/..\/..\/static\/app\/images\/NufarmLogo.jpg" width="112.5" height="54.75"\/\>',
				afterPrint:function(){
					$('head style').remove();
					$('body #prt-container').remove();	
				}
			});

			// remove print container style and div from DOM after printing is done.

		};
		function printToPDF() {
			urlReport = 'getReportAdHoc/';
			var elidapp = NA.common.getElementID('id_idapp'), idapp = elidapp.value;
		        var NAAjax = NA.common.AJAX;

		        NAAjax.POST(urlReport, JSON.stringify({ 'idapp': idapp }), 'application/json','application/pdf',//'arraybuffer',
                    function () { window.document.body.style.cursor = 'wait'; },
                        null,//nggak usah di isi bila tidak perlu
                        function () {
                            var contentDisposition = NAAjax.XHR.getResponseHeader('Content-Disposition');
                            var startIndex = contentDisposition.indexOf("filename=") + 10; // Adjust '+ 10' if filename is not the right one.
                            var endIndex = contentDisposition.length ; //Check if '- 1' is necessary
                            var filename = contentDisposition.substring(startIndex, endIndex);            
							var response = NAAjax.XHR.response;
							//var downloadLink = document.createElement('a');
							//downloadLink.target = '_blank';
							//downloadLink.title = filename;

							// convert downloaded data to a Blob
							var blob = new Blob([response], { type: 'application/pdf' });

							// create an object URL from the Blob
							var URL = window.URL || window.webkitURL;
							var downloadUrl = URL.createObjectURL(blob);
							BootstrapDialog.show({
								draggable: true,
								title: "Printing Goods Outwards",
								type: BootstrapDialog.TYPE_INFO,
								size: BootstrapDialog.SIZE_WIDE,
								message: function (dialogRef) {
									var cFrame = NA.common.doc.createElement("iframe");
									cFrame.setAttribute('id','CFrame');
									cFrame.setAttribute('scrolling','auto');
									cFrame.setAttribute('title',filename);
									cFrame.setAttribute('height','520px');
									cFrame.setAttribute('width','855px');
									cFrame.setAttribute('src',downloadUrl);
									return cFrame;
									//return "<iframe id="fred" style="border: 1px solid #666CCC" title="PDF in an i - Frame" src="PDFData.pdf" frameborder="1" scrolling="auto" height="1100" width="850" ></iframe>";
								},
								closable: true,
								animate: false,
								closeByBackdrop: false,
								closeByKeyboard: false								
							});
						},null,
						function () {//function untuk ajax error
                            window.document.body.style.cursor = 'default'; XhrError(NAAjax.XHR);
                        }, function () { window.document.body.style.cursor = 'default'; },//function ajax complete
                        null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                        );
		};
		function JSONToCSVConvertor(JSONData, ReportTitle, ShowLabel, columnsHidden) {
			//If JSONData is not an object then JSON.parse will parse the JSON string in an Object
			var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;

			var CSV = '';
			//Set Report title in first row or line

			CSV += ReportTitle + '\r\n';

			//This condition will generate the Label/Header
			if (ShowLabel) {
				var row = "";

				//This loop will extract the label from 1st index of on array
				for (var index in arrData[0]) {

					//Now convert each value to string and comma-seprated
					if (columnsHidden.indexOf(index) <= -1) {
						row += index + ',';
					}
				}

				row = row.slice(0, -1);

				//append Label row with line break
				CSV += row + '\r\n';
			}

			//1st loop is to extract each row
			for (var i = 0; i < arrData.length; i++) {
				var row = "";

				//2nd loop will extract each column and convert it in string comma-seprated
				for (var index in arrData[i]) {
					if (index == "descriptions") {
						insertChars = "'";
						row += insertChars;
						row += '"' + arrData[i][index] + '",';
						continue;
					}
					if (columnsHidden.indexOf(index) <= -1) {
						row += '"' + arrData[i][index] + '",';
					}
				}

				row.slice(0, row.length - 1);

				//add a line break after each row
				CSV += row + '\r\n';
			}

			if (CSV == '') {
				alert("Invalid data");
				return;
			}

			//Generate a file name
			var fileName = "MyReport_";
			//this will remove the blank-spaces from the title and replace it with an underscore
			fileName += ReportTitle.replace(/ /g, "_");

			//Initialize file format you want csv or xls
			var uri = 'data:text/csv;charset=utf-8,' + escape(CSV);

			// Now the little tricky part.
			// you can use either>> window.open(uri);
			// but this will not work in some browsers
			// or you will not get the correct file extension    

			//this trick will generate a temp <a /> tag
			var link = document.createElement("a");
			link.href = uri;

			//set the visibility hidden so it will not effect on your web-layout
			link.style = "visibility:hidden";
			link.download = fileName + ".csv";

			//this part will append the anchor tag and remove it after automatic click
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
		};
		//sumber dari http://www.guriddo.net/demo/guriddojs/export/exporttoexcel/index.html
		function ExporttoExcel(event) {
			if (event) {
				NA.NAEvent.preventDefault(event);
				//grid.jqGrid("exportToExcel", {
				//	includeLabels: true,
				//	includeGroupHeader: true,
				//	includeFooter: true,
				//	fileName: "goods_Outwards.xlsx",
				//	maxlength: 40 // maxlength for visible string data 
				//});
				//grid.jqGrid.exportToExcel({
				//	includeLabels: true,
				//	includeGroupHeader: true,
				//	includeFooter: true,
				//	fileName: "goods_Outwards.xlsx",
				//	maxlength: 40 // maxlength for visible string data
				//	});
				//get hidden column
				var columnsHiddend = [];
				$("#jqGrid_NA_F_Goods_Outwards").jqGrid('getGridParam', 'colModel').forEach(function (objCol) {
					if (objCol.hasOwnProperty('hidden')) {
						if (objCol['hidden']) {
							columnsHiddend.push(objCol['name']);
						}
					}
				});

				JSONToCSVConvertor(JSON.stringify(grid.jqGrid('getRowData')), 'Goods_Outwards', true, columnsHiddend);
			}
		};
		//function untuk Reset
		function submitReset(event) {
			window.document.body.style.cursor = 'wait';
			SearchData.setDefaultSearchData('goods', 'varchar', 'like');
			SearchData.setValue('');
			LoadData(1);
			win.document.body.style.cursor = 'default';
		};
		window.showDialogCustomSearch = function (event) {
			$('div.containerDialog').load("customFilter", function (responseTxt, statusTxt, xhr) {
				if (statusTxt == "success") {
					$(this).html(responseTxt);
					var dialog = NA.common.doc.querySelector('div.containerDialog');
					NA.common.getElementID('searchmodfbox').style.display = 'block';
					var btnClose = NA.common.doc.querySelector('div#searchhdfbo a.ui-jqdialog-titlebar-close.ui-corner-all'),
                    txtSearchCustom = NA.common.getElementID('jqg1');
					NA.NAEvent.addHandler(btnClose, 'click', function (event) {
						closeDialog();
					});
					var btnFind = NA.common.getElementID('fbox_jqGrid_search');
					NA.NAEvent.addHandler(btnFind, 'click', function (event) {
						submitSearch(event);
						if (event) {
							NA.NAEvent.stopPropagation(event);
						}
					});
					var btnReset = NA.common.getElementID('fbox_jqGrid_reset');
					NA.NAEvent.addHandler(btnReset, 'click', function (event) {
						submitReset(event);
						if (event) {
							NA.NAEvent.stopPropagation(event);
						}
					});
					NA.NAEvent.addHandler(txtSearchCustom, 'keydown', function (event) {
						event = NA.NAEvent.getEvent(event);
						if (event.keyCode === 13) {
							submitSearch(event);
						}
						if (event) {
							NA.NAEvent.stopPropagation(event);
						}
					});
				}
			});
		};
		function submitSearch(event) {
			window.document.body.style.cursor = 'wait';
			if (event)
				NA.NAEvent.preventDefault(event);

			var elementOption = null, columnKey = '', valueKey = '',
            elCriteria = null,//NA.common.doc.querySelector('td.columns select.selectopts.NA-Form-Control option:checked');
            valCriteria = '',//elCriteria.nodeValue;
            elDataType = '';//elementOption.dataset.dataType;
			criteria = 'like'
			//get  ajax with querystring search
			//valueKey : valueKey,
			//columnKey :columnKey,
			//dataType : dataType,
			//criteria : criteria,
			if (event.target.getAttribute('id') === 'fbox_jqGrid_search' || event.target.getAttribute('id') === 'jqg1' || event.target.nodeName === 'SPAN') {//fbox_jqGrid_search == button search,jqg1 = txtSearch nya
				elementOption = NA.common.doc.querySelector('td.columns select.NA-Form-Control option:checked');
				columnKey = elementOption.getAttribute('name'), valueKey = NA.common.getElementID('jqg1').value;
				elCriteria = NA.common.doc.querySelector('td.operators select.selectopts.NA-Form-Control option:checked');
				valCriteria = elCriteria.value;
				elDataType = elementOption.dataset.tipe;
				switch (valCriteria) {
					case "eq": { criteria = 'equal'; break; }
					case "ne": { criteria = 'notequal'; break; }
					case "bw": { criteria = 'beginwith'; break; }
					case "ew": { criteria = "endwith"; break; }
					case "cn": { criteria = "contains"; break; }
					case "in": { criteria = "in"; break; }
					case "ni": { criteria = "notin"; break; }
					case "gt": {
						criteria = "greater";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, NA.common.message.titleInfo + "(expr for only numeric or date data)");
							win.document.body.style.cursor = 'default';
							return false;
						}
						break;
					}
					case "le": {
						criteria = "less";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
					case "leq": {
						criteria = "lessorequal";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
					case "gtq": {
						criteria = "greaterorequal";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
					case "blg": {
						criteria = "between";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, NA.common.message.titleInfo + "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
				};
			}
			else if (event.target == txtSearchMaster || event.target == btnSearchMaster) {
				var elSearch = null;
				valueKey = txtSearchMaster.value.trim();
				var listElem = NA.common.doc.querySelector('ul.dropdown-menu.search').children;//return list Element
				var textToSearch = NA.common.getElementID('bySearch').firstChild.nodeValue;
				if (textToSearch === "CustomSearch") {
					ShowAlert("please define column to search"); win.document.body.style.cursor = "default"; return false;
				}
				Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array                   
					if (item.firstChild.textContent === textToSearch) {
						elSearch = item.firstChild;
					}
				});
				columnKey = elSearch.dataset.column
				elDataType = elSearch.dataset.tipe;
				switch (elDataType) {
					case "bigint":
					case "integer":
					case "int":
					case "money":
					case "float":
					case "decimal":
					case "boolean":
					case "datetime": {
						if (valueKey.toString().indexOf(',') > -1) {
							criteria = 'in'
						} else {
							criteria = 'equal';
						}
						break;
					}
				};
			};

			SearchData.setValue(valueKey);
			SearchData.setColumnName(columnKey);
			SearchData.setDataType(elDataType)
			SearchData.setCriteria(criteria);
			win.document.body.style.cursor = 'wait';
			LoadData(1);
			win.document.body.style.cursor = 'default';
			//grid.setGridParam.trigger("reloadGrid",[{page:1}]);//karena searching harus di set ke page 1
		};
		//======================= END GROUP FUNCTION EVENT=============================================


		//=======================GROUP ASSINGED HANDLER ========================================= 
		//assign delete key event
		grid.on("keyup", "tr", function (e) {
			//var rowid = parseInt($(this).attr("id"));
			var rowId = grid.jqGrid('getGridParam', 'selrow');
			if (e.keyCode == 46) {
				var btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)')
				btnDelete.click();
				return false;
			}
		});
		//handler txt & button Search master keyboard event and click       
		NA.NAEvent.addHandler(txtSearchMaster, 'keydown', handlerSearchInput);
		NA.NAEvent.addHandler(btnSearchMaster, 'click', handlerSearchInput);

		NA.NAEvent.addHandler(btnDelete, 'click', function (event) {
			win.document.body.style.cursor = 'wait';
			var idapp = getGridCellValue(grid, 'idapp');
			if (idapp) {
				NA.NAEvent.preventDefault(event);
				showConfirmation(NA.common.message.confirmDelete, NA.common.message.confirmInfo, function () {
					try {
						//delete data di server 
						//var url = NA.common.addURLParam('Delete/', 'idapp', idapp);
						var NAAjax = NA.common.AJAX;
						NAAjax.POST('Delete/', JSON.stringify({ 'idapp': idapp }), 'application/x-www-form-urlencoded',
							'application/json',
							null, null,
							function () {
								var textStatus = JSON.parse(this.responseText);
								if (textStatus.message === 'success') {
									var rowNum = grid.getGridParam('rowNum'),
									allRecords = grid.getGridParam('records'),
									totalPages = parseInt((allRecords / rowNum) + 1),
									curPage = grid.getGridParam('page'),
									rowId = grid.jqGrid('getGridParam', 'selrow'),
									curRecount = grid.jqGrid('getGridParam', 'reccount');
									mustReload = true;
									if (parseInt(curRecount) === 1) {
										if (totalPages > 1) {
											curPage--;
										}
										else {
											mustReload = false;
											grid.delRowData(rowId);
										}
									}
									else if (parseInt(totalPages) === 1) {
										mustReload = false;
										grid.delRowData(rowId);
									}
									else if (parseInt(curRecount) > 1) {
										mustReload = false;
										grid.delRowData(rowId);
									}
									if (mustReload) {
										win.document.body.style.cursor = 'wait';
										grid.trigger("reloadGrid", [{ page: curPage }]); win.document.body.style.cursor = 'default';
									}
								}
								else if (this.status == 203) {
									ShowAlert(textStatus.message, NA.common.message.titleInfo);
								}
							}, null,
							function () { XhrError(NAAjax.XHR); },
							function () { window.document.body.style.cursor = 'default'; });
						//$.post(url, {}, function (data, textStatus, jqXHR) {
						NA.NAEvent.stopPropagation(event);
						//});
					} catch (e) {
						win.document.body.style.cursor = 'default';
						console.log(e);
						if (JSON.parse(e.message)) {
							ShowAlert(e.name + ': ' + JSON.parse(e.message));
						}
						else {
							ShowAlert(e);
						}
					}
				});
			}
			else {
				win.document.body.style.cursor = 'default';
				ShowAlert('Please select data you want to delete');
			}
			win.document.body.style.cursor = 'default';
			return false;
		});
		NA.NAEvent.addHandler(btnExport, 'click', ExporttoExcel);
		NA.NAEvent.addHandler(btnPrint, 'click', PrintGrid);

		//=======================END GROUP ASSINGED HANDLER ========================================= 

		//======================GROUP DIALOG ENTRY==================================================


		window.showDialogEntry = function (event) {//function ini akan di panggil oleh NAJS.common.dialog,setiap menu add/edit/delete,etc di clik 
			var hasLoadDialog = false;
			var dialog = NA.common.dialog.doc.querySelector("div.containerDialog"),
        	   btnOKCancel = NA.NAEvent.doc.querySelectorAll('div.dialogButtonOKCancel>a.button'),
			   btnClose = NA.common.dialog.doc.querySelector('button.ui-button.ui-dialog-titlebar-close');
			//rubah dialog top nya jadi 10px saja
			dialog.style.top = "10px";
			Array.prototype.forEach.call(btnOKCancel, function (item) {//buat jadi foreach mesti convert dulu ke array
				NA.NAEvent.addHandler(item, 'click', function (evt) {
					NA.NAEvent.preventDefault(evt);
					//==============uncommment this after debugging=============
					//comment this after debugging
					//NA.common.dialog.closeDialog(dialog);
					if (!hasLoadDialog) {
						closeDialog(); win.document.body.style.cursor = 'default'; return false;
					}
					try {
						if (win.status !== 'Open') {
							var textElem = evt.target.innerText;
							if (textElem === 'OK') {
								NA.common.dialog.mustCloseDialog = true;
								NA.common.dialog.IsPrintingPDF = false;
								ExecuteHandler('OK');
							} else {
								ExecuteHandler('Close');
							}
						}
					} catch (e) {
						ShowAlert(e.message);
					}				
					if (evt) {
						NA.NAEvent.stopPropagation(evt);
					}
					win.document.body.style.cursor = 'default';
					return false;
				});
			});
			var btnPrintAddHoc = NA.common.doc.querySelector('div.dialogButtonRightOther>a:first-child');
			NA.NAEvent.addHandler(btnPrintAddHoc, 'click', function(event){				
				NA.NAEvent.preventDefault(event);
				if (win.status != 'Open'){
					var valuesForm = getValuesForm();
					if(NA.common.detectInputChanges(valuesForm, JSON.parse(originalData))){//jika ada perubahan
						if (win.status == "Edit") {
							NA.common.dialog.mustCloseDialog = false;
						}
						showConfirmation(NA.common.message.dataHasChanged, NA.common.message.titleInfo, function () {
							NA.common.dialog.IsPrintingPDF = true;
							ExecuteHandler('OK');
							return;
						});
					}else{//jika tidak ada perubahan 
						//status Edit
						if(win.status == "Edit"){ printToPDF();return;}
						//status Add
						else{
							if(NA.common.dialog.hasOwnProperty('hasSavedAction')){
								if(NA.common.dialog.hasSavedAction){
									printToPDF(); 
								}								
							}
							return;							
						}
					}
				}else{printToPDF();}								
			});
			var btnNew = NA.common.doc.querySelector('div.dialogButtonRightOther>a:nth-child(2)');
			btnNew.classList.remove('btn-link');
			btnNew.style.cursor = "pointer";// .cssText = "cursor:not-allowed;pointer - events: none;"
			btnNew.style.removeProperty('pointerEvents')
			btnNew.textContent = "Add New";
			NA.NAEvent.addHandler(btnNew,'click',AddNew);
			//var FrameDoc = NA.common.doc.createElement('iframe')
			//FrameDoc.setAttribute('id', 'IDFrameDoc');
//
			////<div id='withIframe'>	
			////	<iframe id='if' src=''></iframe>
			////</div>
			//dialog.appendChild(FrameDoc);
			//$("#IDFrameDoc").dialog({
			//	autoOpen: false,
			//	open: function (ev, ui) {
			//		$('#IDFrameDoc').attr('src', downloadUrl);
			//		$(this).dialog("moveToTop");
			//	}
			//});
			//$(".link_iframe").click(function () {
			//	$("#withIframe").dialog("open");
			//});
			NA.NAEvent.addHandler(btnClose, 'click', function (evt) {
				NA.NAEvent.preventDefault(evt);
				//==============uncommment this after debugging=============
				if (hasLoadDialog) {
					try {
						ExecuteHandler('Close');
					} catch (e) {
						ShowAlert(e.message);
					}					
				}
				if (evt) {
					NA.NAEvent.stopPropagation(evt);
				}
				win.document.body.style.cursor = 'default';
				if (!hasLoadDialog) {
					closeDialog();
				}
				//==============End uncommment this after debugging=============
				//comment this after debugging
				//closeDialog();
				return false;
			});

			try {
				var target = NA.NAEvent.getTarget(event);
				if (target.innerText === ' Add' || target.innerText === ' Edit' || target.innerText === ' Open') {
					var idapp = 0;
					if (target.innerText.trim() !== 'Add') {
						idapp = getGridCellValue(grid, 'idapp');
						if (typeof idapp == 'undefined' || idapp === '') {
							ShowAlert('Please select data to edit');
							closeDialog();
							if (win.document.body.style.cursor != 'default') { win.document.body.style.cursor = 'default'; }
							return false;
						}
						else if (target.innerText.trim() === 'Open') {
							Array.prototype.forEach.call(NA.common.doc.querySelectorAll('div.dialogButtonEntry>a.button'), function (item) {
								if (!item.hasAttribute('disabled')) {
									item.setAttribute('disabled', true);
								}
							});
						}
					}
					$('div.maindialogContent').load("ShowEntry_Outwards?" + win.encodeURIComponent('idapp') + '=' + win.encodeURIComponent(idapp) + '&' + win.encodeURIComponent('status') + '=' + win.encodeURIComponent(target.innerText.trim()),
					function (responseTxt, statusTxt, xhr) {//load /tampilkan form entry data  
						if (statusTxt == "success") {
							$(this).html(responseTxt);
							switch (win.status.trim()) {
								case 'Add': {
									Array.prototype.forEach.call(NA.common.doc.querySelectorAll('div.dialogButtonEntry>a.button'), function (item) {
										if (item.hasAttribute('disabled')) {
											item.removeAttribute('disabled');
										}//remove attribute disable untuk button OK dan cancel bila statusnya Add
									});
									NA.common.getElementID('difInfo').style.display = 'none';
									break;
								}
								case 'Edit': {
									var hasref = NA.common.getElementID('id_hasRefData').value
									//NA.common.getElementID('id_fk_sender').setAttribute('disabled', true);
									NA.common.getElementID('id_serialnumber').setAttribute('disabled', true);
									NA.common.getElementID('FE_fk_goods').setAttribute('disabled', true);
									if (hasref.valueOf === true) {
										NA.common.getElementID('id_fk_employee').setAttribute('disabled', true);
										NA.common.getElementID('id_fk_responsibleperson').setAttribute('disabled', true);
										NA.common.getElementID('FE_fk_employee').setAttribute('disabled', true);
										NA.common.getElementID('FE_fk_sender').setAttribute('disabled', true);
										NA.common.getElementID('FE_fk_responsibleperson').setAttribute('disabled', true);
										NA.common.getElementID('id_daterequest').setAttribute('disabled', true);
										NA.common.getElementID('id_datereleased').setAttribute('disabled', true);
										NA.common.getElementID('lastUsedInfo').style.display = 'block';
									}
									break;
								}
								case 'Open': {
									NA.common.getElementID('FE_fk_goods').setAttribute('disabled', true);
									NA.common.getElementID('id_serialnumber').setAttribute('disabled', true);
									NA.common.getElementID('id_fk_employee').setAttribute('disabled', true);
									NA.common.getElementID('id_fk_sender').setAttribute('disabled', true);
									NA.common.getElementID('id_fk_responsibleperson').setAttribute('disabled', true);
									NA.common.getElementID('FE_fk_employee').setAttribute('disabled', true);
									NA.common.getElementID('FE_fk_sender').setAttribute('disabled', true);
									NA.common.getElementID('FE_fk_responsibleperson').setAttribute('disabled', true);
									NA.common.getElementID('id_daterequest').setAttribute('disabled', true);
									NA.common.getElementID('id_datereleased').setAttribute('disabled', true);
									NA.common.getElementID('id_descriptions').setAttribute('disabled', true);
									NA.common.getElementID('id_equipment_desc').setAttribute('disabled', true);
									NA.common.getElementID('lastUsedInfo').style.display = 'block';
									break;
								}
							};
							if (win.status !== 'Open' && win.status !== '') {//hanya untuk status Add/Edit   
								Array.prototype.forEach.call(NA.common.doc.querySelectorAll('input[type="text"]'), function (item) {
									var valPlaceHolder = item.dataset.value;
									NA.NAEvent.addHandler(item, 'focus', function (evt) {
										if (this.value === '') {
											if (this.getAttribute('placeholder') === valPlaceHolder) {
												this.setAttribute('placeholder', '');
											}
										}
										NA.NAEvent.stopPropagation(evt);
									});
									//============blur event================================
									NA.NAEvent.addHandler(item, 'blur', function (evt) {
										if (this.value === '') {
											if (this.getAttribute('placeholder') === '') {
												this.setAttribute('placeholder', valPlaceHolder);
											}
										}
										NA.NAEvent.stopPropagation(evt);
									});
								});

								var listFK = NA.common.doc.querySelectorAll('input[id="id_serialnumber"],[id="id_fk_employee"],[id="id_fk_sender"],[id="id_fk_responsibleperson"]');
								Array.prototype.forEach.call(listFK, function (item) {
									NA.NAEvent.addHandler(item, 'keydown', function (evt) {
										if (item.getAttribute('readonly') || item.getAttribute('disabled')) {
											NA.NAEvent.preventDefault(evt);//prevent from submit
											evt.stopImmediatePropagation();
											return false;
										}
										if (evt.keyCode === 13) {//kalau menekan tombol enter
											var NAAjax = NA.common.AJAX;
											switch (item.id) {
												case 'id_serialnumber': {
													//ambil data terakhir transaksi
													//jika tidak ada ambil di n_a_goods_receive_detail
													//prevent default
													NA.NAEvent.preventDefault(evt);//prevent from submit
													NAAjax.GET('getLastTransGoods/?' + win.encodeURIComponent('serialno') + '=' + win.encodeURIComponent(evt.target.value),
                                                        'application/json',//overrideMimeType returned by the server
                                                        function (e) { window.document.body.style.cursor = 'wait'; },
                                                        null,//nggak usah di isi bila tidak perlu
                                                        function (e) {//function executed after data has been returned by server(XHR.onload)
                                                        	var data = JSON.parse(this.responseText);
                                                        	if (data.message) {
                                                        		window.document.body.style.cursor = 'default'; XhrError(NAAjax.XHR);
                                                        	}
                                                        	else {
                                                        		//idapp, itemcode, goodsname, brandname, typeapp, lastInfo, fkreturn, fklending, fkoutwards, fkmaintenance, fkdisposal, fklost
                                                        		fillGoodsInfo(data, item.id, true);
                                                        	}
                                                        }, null, function (e) {//function untuk ajax error
                                                        	window.document.body.style.cursor = 'default'; XhrError(NAAjax.XHR);
                                                        }, function (e) { window.document.body.style.cursor = 'default'; },//function ajax complete
                                                        null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                                                        );
													break;
												}
												case 'id_fk_employee':
												case 'id_fk_sender':
												case 'id_fk_responsibleperson': {
													NA.NAEvent.preventDefault(evt);//prevent from submit
													fillEmployeeName(evt, item.id);
													break;
												}
											};//end switch
											evt.stopImmediatePropagation();
										}//end if (evt.keyCode === 13)
									});//end NA.NAEvent.addHandler(item, 'keydown', function (evt)
								});//end Array.prototype.forEach.call(listFK, function (item)
								originalData = JSON.stringify(getValuesForm());

								//==============date request=============
								if (win.status !== 'Add') {
									var eloriginalData = JSON.parse(originalData);
									var valDaterequest = new Date(eloriginalData.daterequest);
									$("#id_daterequest").datepicker("setDate", valDaterequest);
									//format value jadi dd//mm/yyy
									$("#id_daterequest").val(formatDate(valDaterequest));
									//$("id_daterequest").val(valDaterequest.getDate())
									var valDatereleased = new Date(eloriginalData.datereleased);
									$("#id_datereleased").datepicker("setDate", valDatereleased);
									$("#id_datereleased").val(formatDate(valDatereleased));
								}
								$('#id_daterequest').datepicker({
									dateFormat: 'dd/mm/yy',
									changeMonth: true,
									changeYear: true,
									beforeShowDay: $.datepicker.noWeekends,
									minDate: (function (g) {
										if (g.status === 'Edit') {
											var eloriginalData = JSON.parse(originalData),
                                                hasRef = eloriginalData['hasRefData'];
											if (hasRef) { return 1; }
											var valDateReq = new Date(eloriginalData.daterequest);
											return valDateReq;
										}
									})(win),
									//maxDate: 0,
									//showOn: "button",
									//showButtonPanel: true,
									closeText: "Close",
									currentText: 'Now',
								});
								$('#id_datereleased').datepicker({
									dateFormat: 'dd/mm/yy',
									changeMonth: true,
									changeYear: true,
									beforeShowDay: $.datepicker.noWeekends,
									minDate: (function (g) {
										if (g.status === 'Edit') {
											var eloriginalData = JSON.parse(originalData),
                                                hasRef = eloriginalData['hasRefData'];
											if (hasRef) { return 1; }
											var valDateRel = new Date(eloriginalData.datereleased);
											return valDateRel;
										}
									})(win),
									//maxDate: 0,
									//showOn: "button",
									//showButtonPanel: true,
									closeText: "Close",
									currentText: 'Now',
								});

								//setting Custom Validity
								var elm = NA.common.doc.querySelector('#id_daterequest');
								NA.NAEvent.addHandler(elm, 'input', function (event) {
									var elpat = this.getAttribute('patern');
									var patern = new RegExp(elpat, 'i');
									var valuePat = this.value;
									if (valuePat === null || valuePat === '') {
										valuePat = this.textcontent;
									}
									if (!patern.test(valuePat)) {
										this.setCustomValidity('Invalid date value');
										this.validity.valid = false;
									}
									else {
										this.setCustomValidity(''); //clearkan error custom validity
									}
								});
								
								var elm = NA.common.doc.querySelector('#id_datereleased');
								NA.NAEvent.addHandler(elm, 'input', function (event) {
									var elpat = this.getAttribute('patern');
									var patern = new RegExp(elpat, 'i');
									var valuePat = this.value;
									if (valuePat === null || valuePat === '') {
										valuePat = this.textcontent;
									}
									if (!patern.test(valuePat)) {
										this.setCustomValidity('Invalid date value');
										this.validity.valid = false;
									}
									else {
										this.setCustomValidity(''); //clearkan error custom validity
									}
								});

								$.datepicker._gotoToday = function (id) {
									$(id).datepicker('setDate', new Date()).datepicker('hide').blur();
								};
								originalData = JSON.stringify(getValuesForm());

								var initializeForm = NA.common.getElementID('id_initializeForm');
								initializeForm.value = originalData;
							
								//======================event handler BUTTONS Search================================================ 
								var btnFindGoods = NA.common.getElementID('FE_fk_goods');
								NA.NAEvent.addHandler(btnFindGoods, 'click', function (e) {
									BootstrapDialog.show({
										draggable: true,
										title: 'Find goods',
										type: BootstrapDialog.TYPE_INFO,
										size: BootstrapDialog.SIZE_WIDE,
										message: function (dialogRef) {
											var placeHolder = 'Enter goods name or brandname or Type of goods or (exact serialnumber) to search for';
											containerMessage = NA.common.dialog.createFormContainer('fk_goods', placeHolder,
											function (e) {//event for blur
												if (this.value === '') {
													if (this.getAttribute('placeholder') === '') {
														this.setAttribute('placeholder', placeHolder);
													}
												}
											},
											function (e) {//event for focus
												if (this.value === '') {
													if (this.getAttribute('placeholder') === placeHolder) {
														this.setAttribute('placeholder', '');
													}
												}
											},
											function (e) {//even for keydown txtSearch													
												if (e.keyCode === 13) {
													NA.NAEvent.preventDefault(e);
													win.document.body.style.cursor = 'wait';
													//cek posisi keur dina tab mana
													//cari data ke database
													var url = 'getGoodsWithHistory/?' + win.encodeURIComponent('searchData') + '=' + win.encodeURIComponent(e.target.value.trim());
													if (gridTbl) {
														jQuery(gridTbl).setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
													}
													win.document.body.style.cursor = 'default';
													NA.NAEvent.stopPropagation(e);
												}
											}, function (e) {
												txtSearch = NA.common.getElementID('txtsearch_fk_goods');
												NA.common.triggerKeyboardEvent(txtSearch, 13);
											});
											var children = containerMessage.childNodes;
											var mainContainer = null, txtSearch = null;
											for (var i = 0, len = children.length; i < len; i++) {
												if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_goods') {
													mainContainer = children[i]; break;
												}
											};
											//loads Data into JqueryGrid
											gridTbl = NA.common.doc.createElement('table');
											gridTbl.id = 'jqGrid_NA_F_Goods_Outwards_FK_Goods';
											gridPager = NA.common.doc.createElement('div');
											gridPager.id = 'jqGrid_NA_F_Goods_Outwards_FK_Goods_Pager';
											mainContainer.appendChild(gridTbl);
											mainContainer.appendChild(gridPager);
											return containerMessage;
										},
										onshown: function (dialogRef) {
											var txtSearch = NA.common.getElementID('txtsearch_fk_goods');
											gridTbl = $('#jqGrid_NA_F_Goods_Outwards_FK_Goods');
											gridPager = $('#jqGrid_NA_F_Goods_Outwards_FK_Goods_Pager');
											var urlGoods = 'getGoodsWithHistory/?' + win.encodeURIComponent('searchData') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
											gridTbl.jqGrid({
												url: urlGoods,
												mtype: "GET",
												datatype: "json",//idapp,NO,fk_goods,goodsname,brandName,type,serialnumber,fk_usedemployee,usedemployee,lastinfo,fk_lending,fk_return,fk_maintenance,
												colNames: ['idapp', 'NO', 'fk_goods', 'Goods Name', 'Brand Name', 'Type of goods', 'Serial Number', 'fk_usedemployee', 'usedemployee', 'Last Info', 'fk_receive', 'fk_outwards', 'fk_lending', 'fk_return', 'fk_maintenance', ],
												colModel: [
														{ name: 'idapp', index: 'idapp', hidden: true, },
														{ name: 'NO', key: true, width: 40, align: 'right', sortable: false, editable: false, },
														{ name: 'fk_goods', index: 'fk_goods', hidden: true, },
														{ name: 'goodsname', index: 'goodsname', width: 120, sortable: true, editable: false, align: 'left', },
														{ name: 'brandname', index: 'brandname', width: 120, sortable: true, editable: false, align: 'left', },
														{ name: 'type', index: 'type', width: 130, sortable: true, editable: false, align: 'left', },
														{ name: 'serialnumber', index: 'serialnumber', width: 195, sortable: true, editable: false, align: 'left', },
														{ name: 'fk_usedemployee', index: 'fk_usedemployee', hidden: true },
														{ name: 'usedemployee', index: 'usedemployee', hidden: true },
														{ name: 'lastinfo', index: 'lastinfo', width: 240, sortable: false, editable: false, align: 'left', },
														{ name: 'fk_receive', index: 'fk_receive', hidden: true, },
														{ name: 'fk_outwards', index: 'fk_outwards', hidden: true, },
														{ name: 'fk_lending', index: 'fk_lending', hidden: true, },
														{ name: 'fk_return', index: 'fk_return', hidden: true, },
														{ name: 'fk_maintenance', index: 'fk_maintenance', hidden: true, },
												],
												ondblClickRow: function (rowId) {
													//fire button OK
													var btnOK = dialogRef.getButton('btnOKFindGoods');
													btnOK.click();
												},
												gridComplete: function () {
													document.body.style.cursor = 'default';
												},
												loadError: function (xhr, textStatus, errorThrown) {
													var error_msg = xhr.responseText
													var msg = "Some errors occurred during processing:"
													msg += '\n\n' + error_msg
													ShowAlert(msg)
												},
												cellEdit: false,
												height: '200px',
												rowNum: 500,
												rowList: [20, 50, 100, 200, 300, 500],
												sortname: "brandname",
												sortorder: "asc",
												multiSort: true,
												//shrinkToFit: false,
												iconSet: "fontAwesome",
												//forceFit: true,
												//toolbar: true,
												scrollrows: true,
												//hidegrid: true,
												pager: "#jqGrid_NA_F_Goods_Outwards_FK_Goods_Pager"
											});
											gridTbl.navGrid(gridPager, {
												search: false, // show search button on the toolbar
												add: false,
												edit: false,
												del: false,
												refresh: false
											});
										},
										closable: false,
										animate: false,
										closeByBackdrop: false,
										closeByKeyboard: false,
										buttons: [{
											label: 'Cancel',
											icon: 'glyphicon glyphicon-remove',
											cssClass: 'btn-success',
											action: function (dialogRef) {
												dialogRef.close();
											},
										}, {
											label: 'OK',
											id: 'btnOKFindGoods',
											icon: 'glyphicon glyphicon-ok',
											cssClass: 'btn-success',
											action: function (dialogRef) {
												var idapp = getGridCellValue(gridTbl, 'idapp');
												if (idapp) {//cell di select sama user
													//tempelkan data row di fk_goods, dan valuenya di goods_desc;
													var rowId = gridTbl.jqGrid('getGridParam', 'selrow'), rowData = gridTbl.getRowData(rowId);
													var lastinfo = rowData['lastinfo'] // goods is able to use
													var validInfo = ['goods is able to use', 'not yet used'];
													if (validInfo.indexOf(lastinfo) >= 0) {
														fillGoodsInfo(rowData);
														dialogRef.close();
													}
													else {
														ShowAlert(lastinfo, 'Please choose other one'); win.document.body.style.cursor = 'default';
														return false;
													}

												}
											}
										}]
									});
									$("div#gbox_jqGrid_NA_F_Goods_Outwards_FK_Goods, div#gview_jqGrid_NA_F_Goods_Outwards_FK_Goods, div.ui-jqgrid-bdiv, div.ui-jqgrid-hdiv").css({
										'width': 'inherit'
									})
								});
								var listFK = NA.common.doc.querySelectorAll('button[id="FE_fk_employee"],[id="FE_fk_sender"],[id="FE_fk_responsibleperson"]');
								Array.prototype.forEach.call(listFK, function (item) {
									if (item.getAttribute('readonly') || item.getAttribute('disabled')) {
										return false;
									}
									else {
										NA.NAEvent.addHandler(item, 'click', function (evt) {
											BootstrapDialog.show({
												draggable: true,
												title: 'Find Employee',
												type: BootstrapDialog.TYPE_INFO,
												size: BootstrapDialog.SIZE_NORMAL,
												message: function (dialogRef) {
													var placeHolder = 'Enter Employee name to search for';
													//var gridTbl = null, gridPager = null;
													var containerMessage = NA.common.dialog.createFormContainer('fk_employee', placeHolder,
                                                    function (e) {//event for blur
                                                    	if (this.value === '') {
                                                    		if (this.getAttribute('placeholder') === '') {
                                                    			this.setAttribute('placeholder', placeHolder);
                                                    		}
                                                    	}
                                                    },
                                                    function (e) {//event for focus
                                                    	if (this.value === '') {
                                                    		if (this.getAttribute('placeholder') === placeHolder) {
                                                    			this.setAttribute('placeholder', '');
                                                    		}
                                                    	}
                                                    },
                                                    function (e) {//even for keydown txtSearch
                                                    	if (e.keyCode === 13) {
                                                    		win.document.body.style.cursor = 'wait';
                                                    		//cari data ke database
                                                    		var url = 'SearchEmployeebyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(e.target.value.trim());

                                                    		if (gridTbl) {
                                                    			gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
                                                    		}
                                                    		win.document.body.style.cursor = 'default';
                                                    	}
                                                    }, function (e) {
                                                    	var txtSearch = NA.common.getElementID('txtsearch_fk_employee');
                                                    	NA.common.triggerKeyboardEvent(txtSearch, 13);
                                                    });
													var children = containerMessage.childNodes;
													var mainContainer = null;
													for (var i = 0, len = children.length; i < len; i++) {
														if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_employee') {
															mainContainer = children[i]; break;
														}
													};
													//loads Data into JqueryGrid
													gridTbl = NA.common.doc.createElement('table');
													gridTbl.id = 'jqGrid_NA_F_Goods_Out_fk_employee';
													gridPager = NA.common.doc.createElement('div');
													gridPager.id = 'jqGrid_NA_F_Goods_Out_fk_employee_Pager';
													mainContainer.appendChild(gridTbl);
													mainContainer.appendChild(gridPager);
													return containerMessage;
												},
												onshown: function (dialogRef) {
													var txtSearch = NA.common.getElementID('txtsearch_fk_employee');
													//loads Data into JqueryGrid
													gridTbl = $('#jqGrid_NA_F_Goods_Out_fk_employee');
													gridPager = $('#jqGrid_NA_F_Goods_Out_fk_employee_Pager');
													var urlPR = 'SearchEmployeebyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
													gridTbl.jqGrid({
														url: urlPR,
														mtype: "GET",
														datatype: "json",
														colNames: ['idapp', 'NO', 'NIK', 'Employee Name', ],
														colModel: [
                                                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
                                                            { name: 'nik', width: 130, align: 'left', sortable: true, editable: false, },
                                                            { name: 'employee_name', index: 'employee_name', width: 290, sortable: true, editable: false, align: 'left', },
														],
														ondblClickRow: function (rowId) {
															//fire button OK
															var btnOK = dialogRef.getButton('btnOK');
															btnOK.click();
														},
														gridComplete: function () {
															document.body.style.cursor = 'default';
														},
														cellEdit: false,
														height: '150px',
														rowNum: 500,
														rowList: [20, 50, 100, 200, 300, 500],
														sortname: "employee_name",
														sortorder: "asc",
														multiSort: true,
														//shrinkToFit: false,
														iconSet: "fontAwesome",
														//forceFit: true,
														//toolbar: true,
														scrollrows: true,
														pager: "#jqGrid_NA_F_Goods_Out_fk_employee_Pager"
													});
													gridTbl.navGrid(gridPager, {
														search: false, // show search button on the toolbar
														add: false,
														edit: false,
														del: false,
														refresh: false
													});
													$("div#gbox_jqGrid_NA_F_Goods_Out_fk_employee, div#gview_jqGrid_NA_F_Goods_Out_fk_employee, div.ui-jqgrid-bdiv, div.ui-jqgrid-hdiv").css({
														'width': 'inherit'
													})
													$("div.modal-content").css({ 'width': '511px' });
												},
												animate: false,
												closable: false,
												closeByBackdrop: false,
												closeByKeyboard: false,
												buttons: [{
													label: 'Cancel',
													icon: 'glyphicon glyphicon-remove',
													cssClass: 'btn-success',
													action: function (dialogRef) {
														dialogRef.close();
													},
												}, {
													label: 'OK',
													id: 'btnOK',
													icon: 'glyphicon glyphicon-ok',
													cssClass: 'btn-success',
													action: function (dialogRef) {
														var nik = getGridCellValue(gridTbl, 'nik');
														if (nik) {
															var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
															var rowData = gridTbl.getRowData(rowId);
															var employeeName = rowData['employee_name'];
															var idapp = rowData['idapp'];
															var mainIDbtn = item.getAttribute('id').substring(3);
															//set nik
															var elfk_employee = NA.common.getElementID('id_' + mainIDbtn);
															//set employee_name
															elfk_employee.value = rowData['nik'];
															var elempname = NA.common.getElementID('id_' + mainIDbtn + '_employee');
															elempname.value = employeeName;
															var elidapp = NA.common.getElementID('id_idapp_' + mainIDbtn);
															elidapp.value = idapp;
															dialogRef.close();
														}
													}
												}]
											});
											//restyleBoostrapDialog();
											//var gbox = NA.common.doc.querySelector('div#gbox_jqGrid_NA_F_Goods_Receive_fk_p_r_by');
											//gbox.style.width = '432px';
											//var gview = NA.common.doc.querySelector('div#gview_jqGrid_NA_F_Goods_Receive_fk_p_r_by');
											//gview.style.width = '432px';
											//var tdInfo = NA.common.doc.getElementById('jqGrid_NA_F_Goods_Receive_fk_p_r_by_Pager_right');
											//tdInfo.style.width = '110px';
											//var pager = NA.common.getElementID('jqGrid_NA_F_Goods_Receive_fk_p_r_by_Pager');
											//pager.style.width = '430px';
											evt.stopImmediatePropagation();
										});
									}

								});
								hasLoadDialog = true;
								win.onbeforeunload = function (e) {							
									var valuesForm = getValuesForm(); var retval = false;
									if (NA.common.detectInputChanges(valuesForm, JSON.parse(originalData))) {
										return NA.common.message.dataHasChanged;
									}
									//NA.common.dialog.mustCloseDialog = true;
									if(NA.common.dialog.hasOwnProperty('mustCloseDialog')){
									delete NA.common.dialog.mustCloseDialog;
									}
									//NA.common.dialog.hasSavedAction = true;
									if(NA.common.dialog.hasOwnProperty('hasSavedAction')){
										delete NA.common.dialog.hasSavedAction;
									}
									if (NA.common.dialog.hasOwnProperty('IsPrintingPDF')) {
										delete NA.common.dialog.IsPrintingPDF;
									}									
								}
								//====================== End event handler BUTTONS Search================================================ 

							}//end if (win.status !== 'Open' && win.status !== '')
						}
					});
				}
			} catch (e) {
				BootstrapDialog.closeAll();
				closeDialog();
				if (win.document.body.style.cursor != 'default') { win.document.body.style.cursor = 'default'; }
				ShowAlert(e);
			}
		};

		//======================END GROUP DIALOG ENTRY==================================================
	})();
</script>
{% endblock %}