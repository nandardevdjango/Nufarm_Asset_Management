{% extends "../../app/layout.html" %}
{% block SearchData %}
{% for itemCombo in populateColumn %}
<li><a href="#" data-tipe="{{itemCombo.dataType}}" data-column="{{itemCombo.columnName}}">{{itemCombo.label}}</a></li>
{% endfor %}

{% endblock %}

{% block javascriptAndUI %}
<!--================================Load Script Modules NA ===========================================-->
<script type="text/javascript" src="../../../static/app/scripts/NAJS.js"></script>
<!--=======================================================================================================-->
<script type="text/javascript">
(function () {
	var txtSearchMaster = NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
	    btnSearchMaster = NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default');
	var defPlaceHolder = txtSearchMaster.getAttribute('placeholder');
	if (!NA.common.getElementID('CustomSearch')) {
		var parentC = NA.common.doc.querySelector('ul.dropdown-menu.search');
		lastLi = NA.common.doc.createElement('li'),
		lastLi_a = NA.common.doc.createElement('a');
		lastLi_a.setAttribute('id', 'custSearch');
		lastLi_a.textContent = 'CustomSearch';
		lastLi.appendChild(lastLi_a);
		parentC.appendChild(lastLi);
	}
	//=================add Dynamic Styles=============================
	NA.common.loadStyles("../../../static/app/content/jquery-ui.min.css", "jqueryUI");
	NA.common.loadStyles("../../../static/app/content/ui.jqgrid.css", "UIJqueryGrid");
	var doc = doc || window.document;
	var DivSearch = doc.querySelector('ul.dropdown-menu.search');//return list Element
	(function (elm) {
		var listElem = elm.children;
		var datePlaceHolder = 'yyyy-mm-dd or mm/dd/yyyy';
		var numPlaceHolder = 'enter numeric type';
		var boolPlaceHolder = 'true/false/1/0';
		Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array
			NA.NAEvent.addHandler(item, 'click', function (event) {
				event.preventDefault();
				if (item.firstChild.id === 'custSearch') {
					//=========='show dialog search'==================
					NA.common.dialog.createSearchDialog(event)
					txtSearchMaster.setAttribute('disabled', true);
					txtSearchMaster.setAttribute('placeholder', '');
					txtSearchMaster.value = '';
					btnSearchMaster.setAttribute('disabled', true)
				}
				else {
					txtSearchMaster.removeAttribute('disabled');
					btnSearchMaster.removeAttribute('disabled');
					var textSearch = NA.common.getElementID('bySearch');
					textSearch.firstChild.nodeValue = item.textContent;
					var elSearch = item.firstChild;
					switch (elSearch.dataset.tipe) {
						case "varchar":
						case "nchar":
						case "char":
						case "nvarchar": {
							txtSearchMaster.setAttribute('placeholder', defPlaceHolder);
							break;
						}
						case "boolean": {
							txtSearchMaster.setAttribute('placeholder', boolPlaceHolder);
							break;
						}
						case "int":
						case "integer":
						case "decimal":
						case "floatt":
						case "bigint": {
							txtSearchMaster.setAttribute('placeholder', numPlaceHolder);
							break;
						}
						case "datetime": {
							txtSearchMaster.setAttribute('placeholder', datePlaceHolder);
							break;
						}
					}
				}
				//event.stopImmediatePropagation();
			});
		});

		NA.NAEvent.addHandler(txtSearchMaster, 'blur', function (e) {
			//get textcontent IDbySearch
			//looping dropdown li a textContent
			var SearchByText = NA.common.getElementID('bySearch').textContent;
			var elSearch = null;
			Array.prototype.forEach.call(listElem, function (item) {
				if (item.firstChild.text == SearchByText) {
					elSearch = item.firstChild;
					return;
				}
			});
			switch (elSearch.dataset.tipe) {
				case "varchar":
				case "nchar":
				case "char":
				case "nvarchar": {
					if (this.value === '') {
						if (this.getAttribute('placeholder') !== defPlaceHolder) {
							this.setAttribute('placeholder', defPlaceHolder);
						}
					}
					e.stopImmediatePropagation();
					break;
				}
				case "boolean": {
					if (this.value === '') {
						if (this.getAttribute('placeholder') !== boolPlaceHolder) {
							this.setAttribute('placeholder', boolPlaceHolder);
						}
					}
					e.stopImmediatePropagation();
					break;
				}
				case "int":
				case "integer":
				case "decimal":
				case "floatt":
				case "bigint": {
					if (this.value === '') {
						if (this.getAttribute('placeholder') !== numPlaceHolder) {
							this.setAttribute('placeholder', numPlaceHolder);
						}
					}
					e.stopImmediatePropagation();
					break;
				}
				case "datetime": {
					if (this.value === '') {
						if (this.getAttribute('placeholder') !== datePlaceHolder) {
							this.setAttribute('placeholder', datePlaceHolder);
						}
					}
					e.stopImmediatePropagation();
					break;
				}
			}
		});
		NA.NAEvent.addHandler(txtSearchMaster, 'focus', function (e) {
			if (this.value === '') {
				if (this.getAttribute('placeholder') !== '') {
					this.setAttribute('placeholder', '');
				}
			}
		});
	})(DivSearch);
})();
</script>
<!--SETUP Jquery grid-->
<!-- The jQuery library is a prerequisite for all jqSuite products -->
<script>window.jQuery || NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/jquery\-1\.11\.1\.js\"\>\<\/script\>');</script>

<!-- This is the Javascript file of jqGrid -->
<script src="../../../static/app/scripts/jquery.jqGrid.min.js"></script>

<!-- This is the localization file of the grid controlling messages, labels, etc. -->
<!-- We support more than 40 localizations -->
<script src="../../../static/app/scripts/grid.locale-en.js"></script>
<!----------------------------Load Jquery UI. JS file-------------------------------->
<script src="../../../static/app/scripts/jquery-ui.js"></script>
<script type="text/javascript">if (typeof $.fn.modal == 'undefined') { NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/bootstrap\.js\"\>\<\/script\>'); }</script>
<script src="../../../static/app/scripts/bootstrap-dialog.js"></script>
{% endblock %}

{%block content-0 %}
<style>
    div#content-0 {
        overflow: hidden;
    }
    div#gbox_jqGrid_NA_F_Goods_Disposal, div#gview_jqGrid_NA_F_Goods_Disposal, div#jqGrid_NA_F_Goods_Disposal_Pager, div.ui-jqgrid-titlebar {
        border-radius: 0px;
    }
</style>
<table id="jqGrid_NA_F_Goods_Disposal" style="overflow:auto"></table>
<div id="jqGrid_NA_F_Goods_Disposal_Pager" class="scroll" style="text-align:center;"></div>

{% endblock %}

{% block DialogEntry %}
<script type="text/javascript">
	(function () {
		//========================Variable Object untuk ===============================
		var win = win || window,
        grid = $("#jqGrid_NA_F_Goods_Disposal"),
        txtSearchMaster = NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
        btnSearchMaster = NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default'),
        csrftoken = function () { return NA.CookieUtil.get('csrftoken'); },
        //TypeApps = [],
        //settings btn sesuai user access
        //anggap saja sekarang admin
        btnSave = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(4)'),
        btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)'),
        btnExport = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(6)'),
        btnPrint = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(7)'),
        btnHelp = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(8)'),
        containerMenu = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav'),//inistialisasi menu 
        originalData = {};
		//=================================AJAX Setup pake jquery===========================-->
		$.ajaxSetup({
			cache: false,
			error: function (xhr, status, error) {
				try {
					var messageErr = xhr.responseText;
					var contentype = xhr.getResponseHeader('Content-Type')
					if (contentype === 'application/json') {
						messageErr = $.parseJSON(xhr.responseText);
					}
					var message = xhr.responseText;
					if (messageErr) {
						message = messageErr.message;
					}
					if (message) {
						ShowAlert('An error occurred: ' + error + '\n' + xhr.status + ": " + message);
					}

				} catch (e) {
					ShowAlert('An error occurred: ' + error + '\n' + xhr.status + ": " + e.message);
				}
				window.document.body.style.cursor = 'defautl'; return false;
			},
			timeout: 2000000, // Timeout// nanti kalau sudah selesai system timeout ini harus di rubah, jadi maximal 20 detik
			type: 'GET',
			crossDomain: false, // obviates need for sameOrigin test                              
		});

		//===================================END AJAX SetuP===========================--> 
		//csrf token untuk form
		function csrfSafeMethod(method) {
			// these HTTP methods do not require CSRF protection
			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		};
		$.ajaxPrefilter(function (options) {
			// Always add "?debug=1" to every URL
			options.beforeSend = function (xhr, settings) {
				if (!csrfSafeMethod(settings.type)) {
					xhr.setRequestHeader("X-CSRFToken", csrftoken());
				}
			}
		});
		//Load Data grid
		function LoadData(page) {
			var url = 'NA_Goods_Disposal_Search/?' + win.encodeURIComponent('columnName') + '=' + win.encodeURIComponent(NA.common.SearchData.getColumnKey()) +
                   '&' + win.encodeURIComponent('valueKey') + '=' + win.encodeURIComponent(NA.common.SearchData.getValueKey()) +
                   '&' + win.encodeURIComponent('dataType') + '=' + win.encodeURIComponent(NA.common.SearchData.getDataType()) +
                   '&' + win.encodeURIComponent('criteria') + '=' + win.encodeURIComponent(NA.common.SearchData.getCriteria());
			if (arguments.length > 0) {
				grid.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
			}
			else {
				try {
					//			#column idapp,NO,goods,goodstype,serialnumber,    <-->
					//idapp,goods,type,serialnumber,bookvalue,datedisposal,afterrepair,lastrepairFrom,issold,sellingprice,proposedby,acknowledgeby,approvedby,descriptions,createdby,createddate									
					grid.jqGrid({
						url: url,
						mtype: "GET",
						datatype: "json",
						colNames: ['idapp', 'NO', 'Goods Name', 'Type', 'Serial Number', 'Book Value','Date Removal', 'Has Repaired', 'Last Repaired From', 'Is Sold','Selling Price',
							'Proposed By', 'Acknowledged By', 'Approved By','Descriptions', 'Created Date', 'Created By'],
						colModel: [
							{ name: 'idapp', key: true, hidden: true, align: 'left' },
                            { name: 'NO', width: 40, align: 'right', sortable: false, editable: false, },
							{ name: 'goods', width: 100, index: 'goods', align: 'left', sortable: true, editable: false, },
                            { name: 'goodstype', index: 'goodstype', width: 80, sortable: true, editable: false, align: 'left', },
                            { name: 'serialnumber', index: 'serialnumber', sortable: true, editable: false, align: 'left', },
                            {name :'bookvalue',index:'bookvalue',sortable: true, align: 'right', formatter: 'currency', formatoptions: {
                                decimalSeparator: ",", thousandsSeparator: ".",
                                decimalPlaces: 2, prefix: "Rp "}
                            },
							{ name: 'datedisposal', index: 'datedisposal', sortable: true, editable: false, width: 110, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
							{ name: 'isrepaired', index: 'isrepaired', sortable: true, editable: false, width: 60, align: 'center', editable: false, formatter: 'checkbox', formatoptions: { readonly: true } },
							{ name: 'lastrepairedfrom',index:'lastrepairedfrom', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'issold', index: 'issold', sortable: true, width: 50, align: 'center', editable: false, formatter: 'checkbox', formatoptions: { readonly: true } },
							{
								name: 'sellingprice', index: 'sellingprice', sortable: true, align: 'right', formatter: 'currency', formatoptions: {
									decimalSeparator: ",", thousandsSeparator: ".",
									decimalPlaces: 2, prefix: "Rp "
								}
							},
							{ name: 'proposedby', index: 'proposedby', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'acknowledgedby', index: 'acknowledgedby', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'approvedby', index: 'approvedby', width: 110, sortable: true, editable: false, align: 'left', },
							{ name: 'descriptions', index: 'descriptions', width: 140, sortable: true, editable: false, align: 'left', },
                            { name: 'createddate', index: 'createddate', sortable: true, editable: false, width: 110, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'createdby', index: 'createdby', sortable: true, width: 110, editable: false, },
						],
						ondblClickRow: function (rowId) {
							//var btnOpen = NA.common.doc.querySelector('ul.nav.navbar-nav>li:nth-child(2)>button');
							//if (btnOpen) {
							//	btnOpen.click();
							//}
						},
						gridComplete: function () {
							document.body.style.cursor = 'default';
						},
						loadError: function (xhr, st, err) {
							win.document.body.style.cursor = 'default'; XhrError(xhr);
						},
						//cellEdit: false,
						height: $('div.fltlft').height() - ($('div.fltlft').height() * 0.173),
						rowNum: 300,
						rowList: [20, 50, 100, 200, 300, 500],
						sortname: "idapp",
						sortorder: "desc",
						multiSort: true,
						shrinkToFit: false,
						iconSet: "fontAwesome",
						forceFit: true,
						toolbar: true,
						scrollrows: true,
						hidegrid: true,
						caption: "Transactions ---Goods Disposal/Removal",
						pager: "#jqGrid_NA_F_Goods_Disposal_Pager"
					});
					grid.navGrid("#jqGrid_NA_F_Goods_Disposal_Pager", {
						search: false, // show search button on the toolbar
						add: false,
						edit: false,
						del: false,
						refresh: true
					});

				} catch (e) {
					ShowAlert(e.message);
					console.log(e);
					win.document.body.style.cursor = 'default';
				}
				$("div#gbox_jqGrid_NA_F_Goods_Disposal, div#gview_jqGrid_NA_F_Goods_Disposal, div.ui-jqgrid-bdiv, div.ui-jqgrid-hdiv").css({
					'width': 'inherit'
				})
			}
		};

		var SearchData = NA.common.SearchData;
		SearchData.setDefaultSearchData('goods', 'varchar', 'like');
		LoadData();

		NA.common.doc.title = 'Entry Data Goods Disposal/Removal';
		//disablekan save dan help karena saat ini tidak di pakai
		btnSave.setAttribute('disable', true);
		btnHelp.setAttribute('disable', true);
		NA.common.loadStyles("../../../static/app/content/Dialog.css", "DialogEntryStyle");//Load Style buat dialog sebelum di pakai
		NA.common.loadStyles("../../../static/app/content/NA_commonEntry.css", "CommonEntry");//Load Style buat form sebelum di pakai
		NA.common.dialog.initDialog(containerMenu, 'Nufarm Entry Goods Disposal/Removal - Transactions');//inistialisasi menu

		//==========================GROUP Function Declaration================================
		function GetServerFormatDate(parsedDate) {//dd/mm/yy value -->yyyy-mm-dd
			var d = new Date(parsedDate),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

			if (month.length < 2) month = '0' + month;
			if (day.length < 2) day = '0' + day;

			return [year, month, day].join('-');
		};
		function formatDate(theDate) {//date/month/year
			var date = new Date(theDate),
              year = date.getFullYear(),
              month = (date.getMonth() + 1).toString(),
              formatedMonth = (month.length === 1) ? ("0" + month) : month,
              day = date.getDate().toString(),
              formatedDay = (day.length === 1) ? ("0" + day) : day;
			return formatedDay + "/" + formatedMonth + "/" + year //+ " " + formatedHour + ':' + formatedMinute + ':' + formatedSecond;
		};

		function getGridCellValue(thegrid, CeltoGet) {
			var reccount = thegrid.jqGrid('getGridParam', 'reccount');
			var rowId, rowData, colData;
			if (reccount > 0) {
				rowId = thegrid.jqGrid('getGridParam', 'selrow');
				if (rowId) {
					rowData = thegrid.getRowData(rowId);
					colData = rowData[CeltoGet];
				}
			}
			return colData;
		};
		function showConfirmation(message, title, callbackYess, calBackNO) {
			BootstrapDialog.confirm({
				title: title || NA.common.message.titleInfo,
				message: message,
				type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
				size: BootstrapDialog.SIZE_SMALL,
				animate: false,
				cssClass: 'login-dialog',
				closeByBackdrop: false,
				closeByKeyboard: false,
				closable: false, // <-- Default value is false
				draggable: true, // <-- Default value is false
				btnCancelLabel: 'NO.', // <-- Default value is 'Cancel',
				btnOKLabel: 'Yes.', // <-- Default value is 'OK',
				btnOKClass: 'btn-success', // <-- If you didn't specify it, dialog type will be used,
				callback: function (result) {
					// result will be true if button was click, while it will be false if users close the dialog directly.
					if (result) {
						if (callbackYess) {
							callbackYess();
						}
						return true;
					}
					else {
						if (calBackNO) {
							calBackNO();
						}
					}
				},
				onshown: function (dialogRef) {
					NA.common.doc.querySelector('div.bootstrap-dialog-footer-buttons button.btn.btn-success').focus();
				}
			});
		};
		function ShowAlert(message, title, callbackFunc, calbackOnHide) {
			return BootstrapDialog.alert({
				title: title || NA.common.message.titleInfo,
				message: message,
				size: (message.length > 200) ? BootstrapDialog.SIZE_NORMAL : BootstrapDialog.SIZE_SMALL,
				//animate:false,
				cssClass: 'login-dialog',
				closeByBackdrop: false,
				closeByKeyboard: false,
				type: BootstrapDialog.TYPE_INFO, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
				closable: false, // <-- Default value is false
				draggable: true, // <-- Default value is false
				buttonLabel: 'OK', // <-- Default value is 'OK',
				callback: function (result) {
					// result will be true if button was click, while it will be false if users close the dialog directly.
					if (result) {
						if (callbackFunc) {
							callbackFunc();
						}
						return true;
					}
				},
				onhidden: function (dialogRef) {
					if (calbackOnHide) {
						calbackOnHide();
					}
				}
			});
		};
		function XhrError(xhr) {
			try {
				var messageErr = xhr.responseText;
				var contentype = xhr.getResponseHeader('Content-Type')
				if (contentype === 'application/json') {
					messageErr = JSON.parse(xhr.responseText);
				}
				var message = xhr.responseText;
				if (messageErr) {
					message = messageErr.message;
					if (message.indexOf('!DOCTYPE html') > 0) {
						//error bawaan dari python django
						//redirect to error web
						//untuk sekarang tampilkan saja error codenya saja
						ShowAlert('Unknown Server error occurred: ' + '\nstatus = ' + xhr.status.toString() + '\nPlease tell system administrator');
						document.body.style.cursor = 'default';
						return false;
					}
					else if (xhr.status >= 500) {
						ShowAlert('Unknown Server error occurred: ' + '\n' + message + '\nstatus = ' + xhr.status.toString() + '\nPlease tell system administrator');
						document.body.style.cursor = 'default';
						return false;
					}
					else if (message) {
						ShowAlert('An error occurred: ' + message);
					}
					else {
						ShowAlert('An error occurred: ' + messageErr);
					}
				}
				else if (message) {
					ShowAlert('An error occurred: ' + message);
				}
				document.body.style.cursor = 'default';
			} catch (e) {
				ShowAlert('An error occurred: ' + e + '\n' + e.message);
				document.body.style.cursor = 'default';
			}
			return false;
		};
		function EraseElHidden() {
			var UlHiddenAuto = NA.common.doc.querySelector('ul.ui-menu.ui-widget.ui-widget-content.ui-autocomplete.ui-front');
			var divAutoComplete = NA.common.doc.querySelector('div.ui-helper-hidden-accessible');
			if (UlHiddenAuto) { UlHiddenAuto.parentNode.removeChild(UlHiddenAuto); }
			if (divAutoComplete) { divAutoComplete.parentNode.removeChild(divAutoComplete); }
		};
		function ExecuteHandler(textElement) {
			if (win.document.body.style.cursor != 'wait') { win.document.body.style.cursor = 'wait'; }
			//var frmEntry = NA.common.getElementID('frm-NA-Entry-Goods-Outwards');
			switch (textElement) {
				case 'OK': {
					if (!frmEntry.checkValidity()) {                                   
						var inputbtn = NA.common.getElementID('inputButton');
						inputbtn.click();
					}
					else {
						//check exists
						//barang dan serial number dan lenddate
						var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods');
						var elserialnumber = NA.common.getElementID('id_serialnumber');
						//dateRequest = GetServerFormatDate($.datepicker.parseDate('dd/mm/yy', elDateReq));
						//dateReleased = GetServerFormatDate($.datepicker.parseDate('dd/mm/yy', elDateRel));
						var NAAjax = NA.common.AJAX;
						if (win.status === 'Add') {
							NAAjax.POST('HasExists/',
                                JSON.stringify({ 'idapp_fk_goods': elidapp_fk_goods.value,  'serialnumber': elserialnumber.value }),
                                'application/x-www-form-urlencoded', 'application/json',
                                function () {
                                	window.document.body.style.cursor = 'wait';
                                }, null,
                                function () {
                                	if (this.status === 200) {
                                		var confirmText = JSON.parse(this.responseText);
                                		if (confirmText) {
                                			confirmText = confirmText.message;
                                			if (!confirmText) {
                                				ShowAlert('unknown error', 'uncaught error'); win.document.body.style.cursor = 'default'; throw Error('');
                                			}
                                		}
                                		else {
                                			win.document.body.style.cursor = 'default'; XhrError(this); throw Error('');
                                		}
                                		if (confirmText === 'OK') {
                                			win.document.body.style.cursor = 'wait';
                                			valuesForm = getValuesForm();
                                			submitForm(valuesForm);
                                			win.document.body.style.cursor = 'default';
                                		}
                                		else {//ada confirmasi data yang mungkin sama, tapi inputan terserah user
                                			return showConfirmation(confirmText, NA.common.message.confirmInfo, function () {
                                				win.document.body.style.cursor = 'wait';
                                				valuesForm = getValuesForm();
                                				submitForm(valuesForm);
                                				win.document.body.style.cursor = 'default';
                                			});
                                		}
                                	}
                                	else {
                                		XhrError(this); win.document.body.style.cursor = 'default'; throw new Error('');
                                	}
                                }, null, function () { XhrError(this); win.document.body.style.cursor = 'default'; throw new Error(''); },
                                function () { win.document.body.style.cursor = 'default'; }
                            );
						}
						else if (win.status == 'Edit') {
							win.document.body.style.cursor = 'wait';
							valuesForm = getValuesForm();
							submitForm(valuesForm);
							closeDialog();
							win.document.body.style.cursor = 'default';
						}
					}
					break;
				}
				case 'Cancel':
				case 'Close': {
					if (win.status != 'Open') {
						var valuesForm = getValuesForm();
						var retval = false;
						if (NA.common.detectInputChanges(valuesForm, JSON.parse(originalData))) {
							showConfirmation(NA.common.message.dataHasChanged, 'Confirmation', function () {
								if (!frmEntry.checkValidity()) {
									var inputbtn = NA.common.getElementID('inputButton');
									inputbtn.click();
								}
								else {
									submitForm(valuesForm);
								}
								win.document.body.style.cursor = 'default';
							}, function () {
								closeDialog();
								win.document.body.style.cursor = 'default';
							});
						}
						else {
							closeDialog();
						}
					} else {
						closeDialog(); win.document.body.style.cursor = 'default';
					}
					break;
				}
			};
		};
		function submitForm(valuesForm) {
			valuesForm['csrfmiddlewaretoken'] = (function () {
				var el = document.getElementsByName("csrfmiddlewaretoken");
				return el[0].getAttribute("value");
			})();
			var FDate = $('#id_daterequest').val(); FDate = $.datepicker.parseDate('dd/mm/yy', FDate);
			CDate = GetServerFormatDate(FDate);
			valuesForm['daterequest'] = CDate;

			FDate = $('#id_datereleased').val(); FDate = $.datepicker.parseDate('dd/mm/yy', FDate);
			CDate = GetServerFormatDate(FDate);
			valuesForm['datereleased'] = CDate;
			SuccesTrans = false;

			var NAAjax = NA.common.AJAX;
			//POST: function (url, data, dataType, MIMEType, OnAJAXStart, OnBeforeSend, OnLoad, OnProgress, OnError, OnLoadEnd, customRequestHeader) {
			NAAjax.POST('ShowEntry_Outwards', JSON.stringify(valuesForm), 'application/x-www-form-urlencoded', 'application/json',
				function () {
					win.document.body.style.cursor = 'wait';
				},
				null,
				function (e) {
					var Data = JSON.parse(this.responseText);
					if (Data.message === "success") {
						SuccesTrans = true;
						switch (win.status) {
							case 'Add': {
								//    //clear kan semua data
								//    //reloadGridMaster
								win.document.body.style.cursor = 'wait';
								grid.trigger("reloadGrid", [{ page: 1 }]);
								clearEntry();
								originalData = JSON.stringify(getValuesForm());
								var initializeForm = NA.common.getElementID('id_initializeForm');
								initializeForm.value = originalData;
								//    //focus langsung ke 				    		
								var elserialnumber = NA.common.getElementID('id_serialnumber');
								elserialnumber.focus();
								win.document.body.style.cursor = 'default';
								break;
							}
							case 'Edit': {
								win.document.body.style.cursor = 'wait';
								closeDialog();
								grid.trigger("reloadGrid", [{ page: 1 }]);
								win.document.body.style.cursor = 'default';
								break;
							}
						}
						//reloadJquery$("#jqGrid_NA_F_Goods").trigger("reloadGrid", [{ page: 1 }]);
					}
					else {//error berarti
						XhrError(this); win.document.body.style.cursor = 'default'; throw new Error('');
					}
					win.document.body.style.cursor = 'default';
				}, null,
				function (e) { XhrError(this); win.document.body.style.cursor = 'default'; throw new Error(''); },
				function (e) {
					win.document.body.style.cursor = 'default';
				});
			return SuccesTrans;
		};
		function clearEntry() {
			//idapp,fk_goods,isnew,goods,idapp_fk_goods,fk_employee,idapp_fk_employee,fk_employee_employee,daterequest,datereleased,
			//fk_responsibleperson,idapp_fk_responsibleperson,fk_responsibleperson_employee,fk_sender,idapp_fk_sender,fk_sender_employee,descriptions,
			//lastinfo,serialnumber,fk_frommaintenance,fk_return,fk_lending,
			//fk_receive
			//var elidapp = NA.common.getElementID('id_idapp');
			//elidapp.value = originalData.idapp || null;
			//var elfk_goods = NA.common.getElementID('fk_goodsValue');
			//elfk_goods.textContent = originalData.fk_goods || '';
			//var elisnew = NA.common.getElementID('id_isnew');
			//elisnew.value = originalData.isnew || false;
			////goods tidak usah
			//var elgoods = NA.common.getElementID('id_goods');
			//elgoods.value = '';
			//var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods');
			//elidapp_fk_goods.value = originalData.idapp_fk_goods;
			
			//var eldaterequest = NA.common.getElementID('id_daterequest');
			//eldaterequest.value = originalData.daterequest || '';
			////fk_stock gak usah, fk_stock diambil bersamaan di bussinesrules query
			//var eldatereleased = NA.common.getElementID('id_datereleased');
			//eldatereleased.value = originalData.datereleased || '';

			//var elfk_responsibleperson = NA.common.getElementID('id_fk_responsibleperson');
			//elfk_responsibleperson.value = originalData.fk_responsibleperson || '';

			//var elfk_responsiblepersonEmpl = NA.common.getElementID('id_fk_responsibleperson_employee');
			//elfk_responsiblepersonEmpl.value = originalData.fk_responsibleperson_employee || '';

			//var elidapp_fk_responsibleperson = NA.common.getElementID('id_idapp_fk_responsibleperson');
			//elidapp_fk_responsibleperson.value = originalData.idapp_fk_responsibleperson;

			//var elfk_sender = NA.common.getElementID('id_fk_sender');
			//elfk_sender.value = originalData.fk_sender || '';
			//var elidapp_fk_sender = NA.common.getElementID('id_idapp_fk_sender');
			//elidapp_fk_sender.value = originalData.fk_sender;
			//var elfk_sender_employee = NA.common.getElementID('id_fk_sender_employee');
			//elfk_sender_employee.value = originalData.fk_sender_employee || '';

			//interests, fk_sender, idapp_fk_sender, fk_sender_employee, statuslent, descriptions, typeapp, serialnumber,
			//brandvalue, fk_maintenance, fk_return, fk_currentapp, fk_receive, fk_disposal, fk_lost, lastinfo, initializeForm, hasRefData
			//fk_sender_employee nggak usah

			//var eldescriptions = NA.common.getElementID('id_descriptions');
			//eldescriptions.value = originalData.descriptions || '';
			//var eltypeapp = NA.common.getElementID('TypeValue');
			//eltypeapp.textContent = originalData.typeapp || '';
			//var elserialnumber = NA.common.getElementID('id_serialnumber');
			//elserialnumber.value = originalData.serialnumber || '';
			////brandvalue nggak usah
			//var elbrandvalue = NA.common.getElementID('BrandValue');
			//elbrandvalue.textContent = '';

			//var elfk_frommaintenance = NA.common.getElementID('id_fk_frommaintenance');
			//elfk_frommaintenance.value = originalData.fk_frommaintenance;

			//var elfk_return = NA.common.getElementID('id_fk_return');
			//elfk_return.value = originalData.fk_return;
			//var elfk_lending = NA.common.getElementID('id_fk_lending');
			//elfk_lending.value = originalData.fk_lending;
			//var elfk_receive = NA.common.getElementID('id_fk_receive');
			//elfk_receive.value = originalData.fK_receive;

			//var ellastUsedInfo = NA.common.getElementID('lastUsedInfo'),
			//			lastUsedInfo = ellastUsedInfo.textContent			//elfk_disposal.value = originalData.fk_disposal;
			////var elfk_lost = NA.common.getElementID('id_fk_lost');
			////elfk_lost.value = originalData.fk_lost;
			//var ellastinfo = NA.common.getElementID('LastInfoValue');
			//ellastinfo.textContent = '';
			NA.common.getElementID('difInfo').style.display = 'none';

		};
		function getValuesForm() {
			//var elidapp = NA.common.getElementID('id_idapp'),
			//idapp = elidapp.value;
			//var elfk_goods = NA.common.getElementID('fk_goodsValue'),
            //    fk_goods = elfk_goods.textContent;
			//var elisnew = NA.common.getElementID('id_isnew'),
			//	isnew = elisnew.value;
			////goods tidak usah
			//var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods'),
			//	idapp_fk_goods = elidapp_fk_goods.value;
			
			//var eldatereleased = NA.common.getElementID('id_datereleased'),
			//	datereleased = eldatereleased.value;
			////fk_stock gak usah, fk_stock diambil bersamaan di bussinesrules query
			//var elfk_responsibleperson = NA.common.getElementID('id_fk_responsibleperson'),
			//	fk_responsibleperson = elfk_responsibleperson.value;
			//var elidapp_fk_responsibleperson = NA.common.getElementID('id_idapp_fk_responsibleperson'),
			//	idapp_fk_responsibleperson = elidapp_fk_responsibleperson.value;
			////fk_responsibleperson_employee nggak usah
			//var elfk_sender = NA.common.getElementID('id_fk_sender'),
			//	fk_sender = elfk_sender.value;
			//var elidapp_fk_sender = NA.common.getElementID('id_idapp_fk_sender'),
			//	idapp_fk_sender = elidapp_fk_sender.value;

			//var eldescriptions = NA.common.getElementID('id_descriptions'),
			//	descriptions = eldescriptions.value;
			//var eltypeapp = NA.common.getElementID('TypeValue'),
            //   typeapp = eltypeapp.textContent;
			//var elserialnumber = NA.common.getElementID('id_serialnumber'),
            //serialnumber = elserialnumber.value;
			////brandvalue nggak usah
			//var elfk_frommaintenance = NA.common.getElementID('id_fk_frommaintenance'),
            //    fk_frommaintenance = elfk_frommaintenance.value | 0;
			//var elfk_return = NA.common.getElementID('id_fk_return'),
            //    fk_return = elfk_return.value | 0;
			//var elfk_lending = NA.common.getElementID('id_fk_lending'),
            //    fk_lending = elfk_lending.value | 0;
			//var elfk_receive = NA.common.getElementID('id_fk_receive'),
            //    fk_receive = elfk_receive.value | 0;
			////var elfk_disposal = NA.common.getElementID('id_fk_disposal'),
			////    fk_disposal = elfk_disposal.value;
			////var elfk_lost = NA.common.getElementID('id_fk_lost'),
			////    fk_lost = elfk_lost.value;
			//var ellastinfo = NA.common.getElementID('LastInfoValue'),
            //    lastinfo = ellastinfo.textContent
			//var elfk_usedemployeeValue = NA.common.getElementID('id_idapp_fk_usedemployee')
			////UsedEmployee= elfk_usedemployeeValue.textContent.split('|') ;			
			//var idapp_fk_usedemployee = elfk_usedemployeeValue.value | 0;

			//return {
			//	idapp: idapp, fk_goods: fk_goods, isnew: isnew, idapp_fk_goods: idapp_fk_goods, fk_employee: fk_employee, idapp_fk_employee: idapp_fk_employee,
			//	idapp_fk_usedemployee: idapp_fk_usedemployee,
			//	daterequest: daterequest, datereleased: datereleased, fk_responsibleperson: fk_responsibleperson, idapp_fk_responsibleperson: idapp_fk_responsibleperson,
			//	fk_sender: fk_sender, idapp_fk_sender: idapp_fk_sender, descriptions: descriptions, typeapp: typeapp, serialnumber: serialnumber,
			//	fk_frommaintenance: fk_frommaintenance, fk_return: fk_return, fk_lending: fk_lending, fk_receive: fk_receive, lastinfo: lastinfo,
			//	status: win.status
			//}
		};
		function closeDialog() {
			EraseElHidden();
			var dialog = dialog || NA.common.dialog.doc.querySelector("div.containerDialog");
			if (dialog) {
				NA.common.dialog.closeDialog(dialog);
			}
		};
		function restyleBoostrapDialog() {
			var BSDialogContent = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content');
			BSDialogContent.style.cssText = 'width: 425px; height: 330px;';
			var ContentBody = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-body');
			ContentBody.style.cssText = 'padding:0px;';
			var contentFooter = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-footer');
			contentFooter.style.cssText = 'padding-bottom:0px;padding-top:0px;';
			var mHeader = NA.common.doc.querySelector('div.bootstrap-dialog .modal-header.bootstrap-dialog-draggable');
			mHeader.style.cssText = 'height:30px;padding:0px;';
			var footerButton = NA.common.doc.querySelector('div.bootstrap-dialog-footer-buttons');
			footerButton.style.cssText = 'padding-top:8px;';
		};
		function fillGoodsInfo(rowData, serialnumber, IsFromTextBox) {
			//form.idapp_fk_goods 

			//form.fk_frommaintenance 
			//form.fk_return 
			//form.fk_lending 
			//form.fk_receive 

			//form.idapp di status edit/open

			//  	form.idapp_fk_goods
			//var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods');
			//elidapp_fk_goods.value = rowData['idapp'] || null;//idapp di grid adalah idapp_fkgoods

			////    form.fk_frommaintenance 
			//var elfk_maintenance = NA.common.getElementID('id_fk_frommaintenance');
			//elfk_maintenance.value = rowData['fk_maintenance'] || null;

			////      form.fk_return 
			//var elfk_return = NA.common.getElementID('id_fk_return');
			//elfk_return.value = rowData['fk_return'] || null;

			////    form.fk_currentapp
			//var elfk_receive = NA.common.getElementID('id_fk_lending');
			//elfk_receive.value = rowData['fk_lending'] || null;

			////     form.fk_receive 
			//var elfk_receive = NA.common.getElementID('id_fk_receive');
			//elfk_receive.value = rowData['fk_receive'] || null;

			//if (elfk_receive.value) {
			//	if (parseInt(elfk_receive.value) > 0) {
			//		var elisNew = NA.common.getElementID('id_isnew');
			//		elisNew.value = true;
			//	}
			//}
			////form.brandvalue
			//var elbrandvalue = NA.common.getElementID('BrandValue');
			//elbrandvalue.textContent = rowData['brandname'] || '';

			////form.typeapp
			//var elTypeValue = NA.common.getElementID('TypeValue');
			//elTypeValue.textContent = rowData['type'] || '';

			////form.fk_goods
			//var elfk_goodsValue = NA.common.getElementID('fk_goodsValue');
			//elfk_goodsValue.textContent = rowData['fk_goods'] || '';

			////form.LastInfo')
			//var ellastinfo = NA.common.getElementID('LastInfoValue');
			//ellastinfo.textContent = rowData['lastinfo'] || '';

			////fk_usedemployee & fk_usedemployee_employee
			//var elfk_usedemployeeValue = NA.common.getElementID('fk_usedemployeeValue');
			//elfk_usedemployeeValue.textContent = rowData['fk_usedemployee'] + '|' + rowData['usedemployee'];

			////form.serialnumber
			//var elserialnumber = NA.common.getElementID('id_serialnumber');
			//elserialnumber.value = rowData['serialnumber'];
			//elserialnumber.attributes['placeholder'] = '';

			//form.goods
			//var elgoods = NA.common.getElementID('id_goods');
			//elgoods.value = rowData['goodsname'] || '';

			//if (!serialnumber) {
			//	var elserialnumber = NA.common.getElementID('id_serialnumber');
			//	elserialnumber.value = rowData['serialnumber'] || '';
			//}
			//elgoods.attributes['placeholder'] = '';
			//if (IsFromTextBox) {
			//	NA.common.getElementID('lastUsedInfo').style.display = 'none';
			//}
			//else {
			//	NA.common.getElementID('lastUsedInfo').style.display = 'block';
			//}
			//NA.common.getElementID('difInfo').style.display = 'block';
		};
		function fillEmployeeName(event, elmID) {
			var NAAjax = NA.common.AJAX;
			var url = 'getEmployee/?' + win.encodeURIComponent('nik') + '=' + win.encodeURIComponent(event.target.value)
			NAAjax.GET(url,
                        'application/json',//overrideMimeType returned by the server
                        function () { window.document.body.style.cursor = 'wait'; },
                        null,//nggak usah di isi bila tidak perlu
                        function () {//function executed after data has been returned by server(XHR.onload)
                        	var data = JSON.parse(this.responseText);
                        	if (data) {
                        		var mainID = elmID.substring(3);
                        		//set employee_name
                        		var elempname = NA.common.getElementID('id_' + mainID + '_employee');
                        		var elidapp = NA.common.getElementID('id_idapp_' + mainID);
                        		//var elFKEmp = NA.common.getElementID('id_' + mainID);
                        		//elFKEmp.value = data['nik']||'';
                        		elempname.value = data['employee_name'] || '';
                        		elidapp.value = data['idapp'] || '';
                        	}
                        }, null, function () {//function untuk ajax error
                        	window.document.body.style.cursor = 'default'; XhrError(this);
                        }, function () { window.document.body.style.cursor = 'default'; },//function ajax complete
                        null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
                        );
		};

		//==========================End GROUP Function Declaration================================

		//=======================GROUP FUNCTION EVENT=============================================
		function handlerSearchInput(event) {
			event = NA.NAEvent.getEvent(event);
			if (event.keyCode === 13 || event.target == btnSearchMaster) {
				NA.NAEvent.preventDefault(event);
				var elSearch = NA.common.doc.querySelector('li.dropdown>a#bySearch'),
                SearchBy = NA.common.doc.querySelector('li.dropdown>a#bySearch').textContent.trim();
				if (SearchBy.trim() == 'By') {
					SearchData.setDefaultSearchData('goods', 'varchar', 'like');
					//var curPage = parseInt(grid.getGridParam('page'));
					window.document.body.style.cursor = 'wait';
					if (event.target.value !== '') {
						NA.common.SearchData.setValue(event.target.value);
					}
					LoadData(1);
				}
				else {
					//submit search
					submitSearch(event);
				}
				NA.NAEvent.stopPropagation(event);
			}
			window.document.body.style.cursor = '';
		};
		function printToPDF(event) {
			if (event) {
				NA.NAEvent.preventDefault(event);
				var target = NA.NAEvent.getTarget(event);
				grid.jqGrid("exportToPdf", {
					title: 'Transactions -- goods Disposal/Removal',
					orientation: 'portrait',
					pageSize: 'A4',
					description: 'description of the exported document',
					customSettings: null,
					download: 'download',
					includeLabels: true,
					includeGroupHeader: true,
					includeFooter: true,
					fileName: "goods_DisposalOrRemoval.pdf"
					//langsung print by pdf file
				});
			}
		};

		//sumber dari http://www.guriddo.net/demo/guriddojs/export/exporttoexcel/index.html
		function ExporttoExcel(event) {
			if (event) {
				NA.NAEvent.preventDefault(event);
				grid.jqGrid("exportToExcel", {
					includeLabels: true,
					includeGroupHeader: true,
					includeFooter: true,
					fileName: "goods_DisposalOrRemoval.xlsx",
					maxlength: 40 // maxlength for visible string data 
				});
				NA.NAEvent.stopPropagation(event);
			}
		};
		//function untuk Reset
		function submitReset(event) {
			window.document.body.style.cursor = 'wait';
			SearchData.setDefaultSearchData('goods', 'varchar', 'like');
			SearchData.setValue('');
			LoadData(1);
			win.document.body.style.cursor = 'default';
		};
		window.showDialogCustomSearch = function (event) {
			$('div.containerDialog').load("customFilter", function (responseTxt, statusTxt, xhr) {
				if (statusTxt == "success") {
					$(this).html(responseTxt);
					var dialog = NA.common.doc.querySelector('div.containerDialog');
					NA.common.getElementID('searchmodfbox').style.display = 'block';
					var btnClose = NA.common.doc.querySelector('div#searchhdfbo a.ui-jqdialog-titlebar-close.ui-corner-all'),
                    txtSearchCustom = NA.common.getElementID('jqg1');
					NA.NAEvent.addHandler(btnClose, 'click', function (event) {
						closeDialog();
					});
					var btnFind = NA.common.getElementID('fbox_jqGrid_search');
					NA.NAEvent.addHandler(btnFind, 'click', function (event) {
						submitSearch(event);
						if (event) {
							NA.NAEvent.stopPropagation(event);
						}
					});
					var btnReset = NA.common.getElementID('fbox_jqGrid_reset');
					NA.NAEvent.addHandler(btnReset, 'click', function (event) {
						submitReset(event);
						if (event) {
							NA.NAEvent.stopPropagation(event);
						}
					});
					NA.NAEvent.addHandler(txtSearchCustom, 'keydown', function (event) {
						event = NA.NAEvent.getEvent(event);
						if (event.keyCode === 13) {
							submitSearch(event);
						}
						if (event) {
							NA.NAEvent.stopPropagation(event);
						}
					});
				}
			});
		};
		function submitSearch(event) {
			window.document.body.style.cursor = 'wait';
			if (event)
				NA.NAEvent.preventDefault(event);

			var elementOption = null, columnKey = '', valueKey = '',
            elCriteria = null,//NA.common.doc.querySelector('td.columns select.selectopts.NA-Form-Control option:checked');
            valCriteria = '',//elCriteria.nodeValue;
            elDataType = '';//elementOption.dataset.dataType;
			criteria = 'like'
			//get  ajax with querystring search
			//valueKey : valueKey,
			//columnKey :columnKey,
			//dataType : dataType,
			//criteria : criteria,
			if (event.target.getAttribute('id') === 'fbox_jqGrid_search' || event.target.getAttribute('id') === 'jqg1' || event.target.nodeName === 'SPAN') {//fbox_jqGrid_search == button search,jqg1 = txtSearch nya
				elementOption = NA.common.doc.querySelector('td.columns select.NA-Form-Control option:checked');
				columnKey = elementOption.getAttribute('name'), valueKey = NA.common.getElementID('jqg1').value;
				elCriteria = NA.common.doc.querySelector('td.operators select.selectopts.NA-Form-Control option:checked');
				valCriteria = elCriteria.value;
				elDataType = elementOption.dataset.tipe;
				switch (valCriteria) {
					case "eq": { criteria = 'equal'; break; }
					case "ne": { criteria = 'notequal'; break; }
					case "bw": { criteria = 'beginwith'; break; }
					case "ew": { criteria = "endwith"; break; }
					case "cn": { criteria = "contains"; break; }
					case "in": { criteria = "in"; break; }
					case "ni": { criteria = "notin"; break; }
					case "gt": {
						criteria = "greater";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, NA.common.message.titleInfo + "(expr for only numeric or date data)");
							win.document.body.style.cursor = 'default';
							return false;
						}
						break;
					}
					case "le": {
						criteria = "less";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
					case "leq": {
						criteria = "lessorequal";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
					case "gtq": {
						criteria = "greaterorequal";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
					case "blg": {
						criteria = "between";
						var expr = /char/;  // no quotes here
						if (expr.test(elDataType)) {
							ShowAlert(NA.common.message.unsupportedCriteria, NA.common.message.titleInfo + "expr for only numeric or date data");
							win.document.body.style.cursor = 'default'; return false;
						}
						break;
					}
				};
			}
			else if (event.target == txtSearchMaster || event.target == btnSearchMaster) {
				var elSearch = null;
				valueKey = txtSearchMaster.value.trim();
				var listElem = NA.common.doc.querySelector('ul.dropdown-menu.search').children;//return list Element
				var textToSearch = NA.common.getElementID('bySearch').firstChild.nodeValue;
				if (textToSearch === "CustomSearch") {
					ShowAlert("please define column to search"); win.document.body.style.cursor = "default"; return false;
				}
				Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array                   
					if (item.firstChild.textContent === textToSearch) {
						elSearch = item.firstChild;
					}
				});
				columnKey = elSearch.dataset.column
				elDataType = elSearch.dataset.tipe;
				switch (elDataType) {
					case "bigint":
					case "integer":
					case "int":
					case "money":
					case "float":
					case "decimal":
					case "boolean":
					case "datetime": {
						if (valueKey.toString().indexOf(',') > -1) {
							criteria = 'in'
						} else {
							criteria = 'equal';
						}
						break;
					}
				};
			};

			SearchData.setValue(valueKey);
			SearchData.setColumnName(columnKey);
			SearchData.setDataType(elDataType)
			SearchData.setCriteria(criteria);
			win.document.body.style.cursor = 'wait';
			LoadData(1);
			win.document.body.style.cursor = 'default';
			//grid.setGridParam.trigger("reloadGrid",[{page:1}]);//karena searching harus di set ke page 1
		};
		//======================= END GROUP FUNCTION EVENT=============================================

		//=======================GROUP ASSINGED HANDLER ========================================= 
		//assign delete key event
		grid.on("keyup", "tr", function (e) {
			//var rowid = parseInt($(this).attr("id"));
			var rowId = grid.jqGrid('getGridParam', 'selrow');
			if (e.keyCode == 46) {
				var btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)')
				btnDelete.click();
				return false;
			}
		});
		//handler txt & button Search master keyboard event and click       
		NA.NAEvent.addHandler(txtSearchMaster, 'keydown', handlerSearchInput);
		NA.NAEvent.addHandler(btnSearchMaster, 'click', handlerSearchInput);
		NA.NAEvent.addHandler(btnDelete, 'click', function (event) {
			win.document.body.style.cursor = 'wait';
			var idapp = getGridCellValue(grid, 'idapp');
			if (idapp) {
				NA.NAEvent.preventDefault(event);
				showConfirmation(NA.common.message.confirmDelete, NA.common.message.confirmInfo, function () {
					try {
						//delete data di server 
						//var url = NA.common.addURLParam('Delete/', 'idapp', idapp);
						var NAAjax = NA.common.AJAX;
						NAAjax.POST('Delete/', JSON.stringify({ 'idapp': idapp }), 'application/x-www-form-urlencoded',
							'application/json',
							null, null,
							function () {
								var textStatus = JSON.parse(this.responseText);
								if (textStatus.message === 'success') {
									var rowNum = grid.getGridParam('rowNum'),
									allRecords = grid.getGridParam('records'),
									totalPages = parseInt((allRecords / rowNum) + 1),
									curPage = grid.getGridParam('page'),
									rowId = grid.jqGrid('getGridParam', 'selrow'),
									curRecount = grid.jqGrid('getGridParam', 'reccount');
									mustReload = true;
									if (parseInt(curRecount) === 1) {
										if (totalPages > 1) {
											curPage--;
										}
										else {
											mustReload = true;
											grid.delRowData(rowId);
										}
									}
									else if (parseInt(totalPages) === 1) {
										mustReload = false;
										grid.delRowData(rowId);
									}
									else if (parseInt(curRecount) > 1) {
										mustReload = false;
										grid.delRowData(rowId);
									}
									if (mustReload) {
										win.document.body.style.cursor = 'wait';
										grid.trigger("reloadGrid", [{ page: curPage }]); win.document.body.style.cursor = 'default';
									}
								}
								else if (this.status == 203) {
									ShowAlert(textStatus.message, NA.common.message.titleInfo);
								}
							}, null,
							function () { XhrError(this); },
							function () { window.document.body.style.cursor = 'default'; });
						//$.post(url, {}, function (data, textStatus, jqXHR) {
						NA.NAEvent.stopPropagation(event);
						//});
					} catch (e) {
						win.document.body.style.cursor = 'default';
						console.log(e);
						if (JSON.parse(e.message)) {
							ShowAlert(e.name + ': ' + JSON.parse(e.message));
						}
						else {
							ShowAlert(e);
						}
					}
				});
			}
			else {
				win.document.body.style.cursor = 'default';
				ShowAlert('Please select data you want to delete');
			}
			win.document.body.style.cursor = 'default';
			return false;
		});
		NA.NAEvent.addHandler(btnExport, 'click', ExporttoExcel);
		NA.NAEvent.addHandler(btnPrint, 'click', printToPDF);

		//=======================END GROUP ASSINGED HANDLER ========================================= 

		//======================GROUP DIALOG ENTRY===============================================
		window.showDialogEntry = function (event) {
			var hasLoadDialog = false;
			var dialog = NA.common.dialog.doc.querySelector("div.containerDialog"),
        	   btnOKCancel = NA.NAEvent.doc.querySelectorAll('div.dialogButtonOKCancel>a.button'),
			   btnClose = NA.common.dialog.doc.querySelector('button.ui-button.ui-dialog-titlebar-close');
			//rubah dialog top nya jadi 10px saja
			dialog.style.top = "10px";
			Array.prototype.forEach.call(btnOKCancel, function (item) {//buat jadi foreach mesti convert dulu ke array
				NA.NAEvent.addHandler(item, 'click', function (evt) {
					NA.NAEvent.preventDefault(evt);
					//==============uncommment this after debugging=============
					//comment this after debugging
					NA.common.dialog.closeDialog(dialog);
					//if (!hasLoadDialog) {
					//	closeDialog(); win.document.body.style.cursor = 'default'; return false;
					//}
					//try {
					//	if (win.status !== 'Open') {
					//		var textElem = evt.target.innerText;
					//		if (textElem === 'OK') {
					//			//ExecuteHandler('OK');
					//		} else {
					//			//ExecuteHandler('Close');
					//		}
					//	}
					//} catch (e) {
					//	ShowAlert(e.message);
					//}
					//if (evt) {
					//	NA.NAEvent.stopPropagation(evt);
					//}
					win.document.body.style.cursor = 'default';
					return false;
				});
			});
			NA.NAEvent.addHandler(btnClose, 'click', function (evt) {
				NA.NAEvent.preventDefault(evt);
				//==============uncommment this after debugging=============
				if (hasLoadDialog) {
					try {
						ExecuteHandler('Close');
					} catch (e) {
						ShowAlert(e.message);
					}
				}
				if (evt) {
					NA.NAEvent.stopPropagation(evt);
				}
				win.document.body.style.cursor = 'default';
				if (!hasLoadDialog) {
					closeDialog();
				}
				//==============End uncommment this after debugging=============
				//comment this after debugging
				//closeDialog();
				return false;
			});
			try {
				var target = NA.NAEvent.getTarget(event);
				if (target.innerText === ' Add' || target.innerText === ' Edit' || target.innerText === ' Open') {
				}
			} catch (e) {
				BootstrapDialog.closeAll();
				closeDialog();
				if (win.document.body.style.cursor != 'default') { win.document.body.style.cursor = 'default'; }
				ShowAlert(e);
			}
		};

		//======================END GROUP DIALOG ENTRY===============================================
	})();
</script>

{% endblock %}
